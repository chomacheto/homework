(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{378:function(t,e,n){(function(t,e){!function(n){"use strict";try{(function(){function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=r(n),c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function l(t,s,a,u){return new(a=a||Promise)((function(e,n){function r(t){try{o(u.next(t))}catch(t){n(t)}}function i(t){try{o(u.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?e(t.value):((n=t.value)instanceof a?n:new a((function(t){t(n)}))).then(r,i)}o((u=u.apply(t,s||[])).next())}))}function g(t,e){var i,n,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},r={next:o(0),throw:o(1),return:o(2)};return"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,(r=s?[2&r[0],s.value]:r)[0]){case 0:case 1:s=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){a.label=r[1];break}if(6===r[0]&&a.label<s[1]){a.label=s[1],s=r;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(r);break}s[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],n=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}}function s(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}function i(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function u(t){return function(t){return t=i(t),f.encodeByteArray(t,!0)}(t).replace(/\./g,"")}var f={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=(15&a)<<2|(h=u?t[i+2]:0)>>6,h=63&h;u||(h=64,s||(c=64)),r.push(n[o>>2],n[(3&o)<<4|a>>4],n[c],n[h])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(i(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i,o,s,a=t[n++];a<128?e[r++]=String.fromCharCode(a):191<a&&a<224?(o=t[n++],e[r++]=String.fromCharCode((31&a)<<6|63&o)):239<a&&a<365?(i=((7&a)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536,e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))):(o=t[n++],s=t[n++],e[r++]=String.fromCharCode((15&a)<<12|(63&o)<<6|63&s))}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();r.push(o<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==u&&r.push(a<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function y(){return!function(){try{return"[object process]"===Object.prototype.toString.call(t.process)}catch(t){return}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var m,v="FirebaseError",w=(h(p,m=Error),p);function p(t,e,n){return(e=m.call(this,e)||this).code=t,e.customData=n,e.name=v,Object.setPrototypeOf(e,p.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,E.prototype.create),e}var E=(T.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t;return t=(t=this.errors[t])?(r=i,t.replace(b,(function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"}))):"Error",t=this.serviceName+": "+t+" ("+o+").",new w(o,t,i)},T);function T(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var I,b=/\{\$([^}]+)}/g;function _(t){return t&&t._delegate?t._delegate:t}function S(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=N[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(O=I=I||{})[O.DEBUG=0]="DEBUG",O[O.VERBOSE=1]="VERBOSE",O[O.INFO=2]="INFO",O[O.WARN=3]="WARN",O[O.ERROR=4]="ERROR",O[O.SILENT=5]="SILENT";var A={debug:I.DEBUG,verbose:I.VERBOSE,info:I.INFO,warn:I.WARN,error:I.ERROR,silent:I.SILENT},D=I.INFO,N=((Ae={})[I.DEBUG]="log",Ae[I.VERBOSE]="log",Ae[I.INFO]="info",Ae[I.WARN]="warn",Ae[I.ERROR]="error",Ae),C=(Object.defineProperty(k.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in I))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),k.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?A[t]:t},Object.defineProperty(k.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),k.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,I.DEBUG],t)),this._logHandler.apply(this,s([this,I.DEBUG],t))},k.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,I.VERBOSE],t)),this._logHandler.apply(this,s([this,I.VERBOSE],t))},k.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,I.INFO],t)),this._logHandler.apply(this,s([this,I.INFO],t))},k.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,I.WARN],t)),this._logHandler.apply(this,s([this,I.WARN],t))},k.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,I.ERROR],t)),this._logHandler.apply(this,s([this,I.ERROR],t))},k);function k(t){this.name=t,this._logLevel=D,this._logHandler=S,this._userLogHandler=null}var R=function(t,e){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function x(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var O,L="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},P={},M=L||self;function F(){}function V(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function U(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var B="closure_uid_"+(1e9*Math.random()>>>0),j=0;function K(t,e,n){return t.call.apply(t.bind,arguments)}function q(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function G(t,e,n){return(G=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?K:q).apply(null,arguments)}function Q(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=e.slice();return n.push.apply(n,arguments),t.apply(this,n)}}function H(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,(t.prototype.constructor=t).Vb=function(t,n,r){for(var o=Array(arguments.length-2),i=2;i<arguments.length;i++)o[i-2]=arguments[i];return e.prototype[n].apply(t,o)}}function z(){this.s=this.s,this.o=this.o}var W={};z.prototype.s=!1,z.prototype.na=function(){var t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,t=Object.prototype.hasOwnProperty.call(t,B)&&t[B]||(t[B]=++j),delete W[t])},z.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Y=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},X=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function $(){return Array.prototype.concat.apply([],arguments)}function J(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Z(t){return/^[\s\xa0]*$/.test(t)}var tt,et=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function nt(t,e){return-1!=t.indexOf(e)}function it(t,e){return t<e?-1:e<t?1:0}var ot=M.navigator;function st(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function rt(t){var e,n={};for(e in t)n[e]=t[e];return n}tt=ot&&(ot=ot.userAgent)?ot:"";var at="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ut(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<at.length;i++)e=at[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function ct(t){return ct[" "](t),t}ct[" "]=F;var ht,lt=nt(tt,"Opera"),ft=nt(tt,"Trident")||nt(tt,"MSIE"),pt=nt(tt,"Edge"),yt=pt||ft,gt=nt(tt,"Gecko")&&!(nt(tt.toLowerCase(),"webkit")&&!nt(tt,"Edge"))&&!(nt(tt,"Trident")||nt(tt,"MSIE"))&&!nt(tt,"Edge"),dt=nt(tt.toLowerCase(),"webkit")&&!nt(tt,"Edge");function mt(){var t=M.document;return t?t.documentMode:void 0}var vt="",wt=(wt=tt,gt?/rv:([^\);]+)(\)|;)/.exec(wt):pt?/Edge\/([\d\.]+)/.exec(wt):ft?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(wt):dt?/WebKit\/(\S+)/.exec(wt):lt?/(?:Version)[ \/]?(\S+)/.exec(wt):void 0);wt&&(vt=wt?wt[1]:""),ht=ft&&null!=(wt=mt())&&wt>parseFloat(vt)?String(wt):vt;var bt={};function Et(){return t=function(){for(var t=0,e=et(String(ht)).split("."),n=et("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=it(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||it(0==o[2].length,0==s[2].length)||it(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},e=bt,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9);var t,e}var Tt=M.document&&ft&&(mt()||parseInt(ht,10))||void 0,It=function(){if(!M.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{M.addEventListener("test",F,e),M.removeEventListener("test",F,e)}catch(t){}return t}();function _t(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function St(t,e){if(_t.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(gt){t:{try{ct(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:At[t.pointerType]||"",this.state=t.state,(this.i=t).defaultPrevented&&St.Z.h.call(this)}}_t.prototype.h=function(){this.defaultPrevented=!0},H(St,_t);var At={2:"touch",3:"pen",4:"mouse"};St.prototype.h=function(){St.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Dt="closure_listenable_"+(1e6*Math.random()|0),Nt=0;function Ct(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++Nt,this.ca=this.fa=!1}function kt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Rt(t){this.src=t,this.g={},this.h=0}function xt(t,e){var n,r,i,o=e.type;o in t.g&&(n=t.g[o],(i=0<=(r=Y(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(kt(e),0==t.g[o].length&&(delete t.g[o],t.h--)))}function Ot(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}Rt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=Ot(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new Ct(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var Lt="closure_lm_"+(1e6*Math.random()|0),Pt={};function Mt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Kt(r),e&&e[Dt]?e.O(n,r,U(i)?!!i.capture:!!i,o):Ft(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Mt(t,e[o],n,r,i);return null}return n=Kt(n),t&&t[Dt]?t.N(e,n,U(r)?!!r.capture:!!r,i):Ft(t,e,n,!1,r,i)}function Ft(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s,a=U(i)?!!i.capture:!!i,u=Bt(t);if(u||(t[Lt]=u=new Rt(t)),(n=u.add(e,n,r,a,o)).proxy)return n;if(s=qt,(n.proxy=r=function t(e){return s.call(t.src,t.listener,e)}).src=t,r.listener=n,t.addEventListener)void 0===(i=It?i:a)&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ut(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vt(t){var e,n,r;"number"!=typeof t&&t&&!t.ca&&((e=t.src)&&e[Dt]?xt(e.i,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ut(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Bt(e))?(xt(n,t),0==n.h&&(n.src=null,e[Lt]=null)):kt(t)))}function Ut(t){return t in Pt?Pt[t]:Pt[t]="on"+t}function qt(t,e){var n,r;return!!t.ca||(e=new St(e,this),n=t.listener,r=t.ia||t.src,t.fa&&Vt(t),n.call(r,e))}function Bt(t){return(t=t[Lt])instanceof Rt?t:null}var jt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Kt(t){return"function"==typeof t?t:(t[jt]||(t[jt]=function(e){return t.handleEvent(e)}),t[jt])}function Gt(){z.call(this),this.i=new Rt(this),(this.P=this).I=null}function Qt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e?e=new _t(e,t):e instanceof _t?e.target=e.target||t:(s=e,ut(e=new _t(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.g=n[i],s=Ht(o,r,!0,e)&&s;if(s=Ht(o=e.g=t,r,!0,e)&&s,s=Ht(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Ht(o=e.g=n[i],r,!1,e)&&s}function Ht(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,a,u=e[o];u&&!u.ca&&u.capture==n&&(s=u.listener,a=u.ia||u.src,u.fa&&xt(t.i,u),i=!1!==s.call(a,r)&&i)}return i&&!r.defaultPrevented}H(Gt,z),Gt.prototype[Dt]=!0,Gt.prototype.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=U(i)?!!i.capture:!!i,r=Kt(r),e&&e[Dt]?(e=e.i,(n=String(n).toString())in e.g&&-1<(r=Ot(s=e.g[n],r,i,o))&&(kt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.g[n],e.h--))):(e=e&&Bt(e))&&(n=e.g[n.toString()],(r=(e=-1)<(e=n?Ot(n,r,i,o):e)?n[e]:null)&&Vt(r))}(this,t,e,n,r)},Gt.prototype.M=function(){if(Gt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)kt(n[r]);delete e.g[t],e.h--}}this.I=null},Gt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Gt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var zt=M.JSON.stringify,Wt=(Yt.prototype.add=function(t,e){var n=Xt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},Yt);function Yt(){this.h=this.g=null}var Xt=($t.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},new $t((function(){return new Zt}),(function(t){return t.reset()})));function $t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}var Jt,Zt=(te.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},te.prototype.reset=function(){this.next=this.g=this.h=null},te);function te(){this.next=this.g=this.h=null}function ee(t,e){var n;Jt||(n=M.Promise.resolve(void 0),Jt=function(){n.then(ie)}),ne||(Jt(),ne=!0),re.add(t,e)}var ne=!1,re=new Wt;function ie(){for(var t;e=t=void 0,e=null,(t=re).g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(t){!function(t){M.setTimeout((function(){throw t}),0)}(t)}var e=Xt;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}ne=!1}function oe(t,e){Gt.call(this),this.h=t||1,this.g=e||M,this.j=G(this.kb,this),this.l=Date.now()}function se(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function ae(t,e,n){if("function"==typeof t)n&&(t=G(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=G(t.handleEvent,t)}return 2147483647<Number(e)?-1:M.setTimeout(t,e||0)}H(oe,Gt),(O=oe.prototype).da=!1,O.S=null,O.kb=function(){var t;this.da&&(0<(t=Date.now()-this.l)&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Qt(this,"tick"),this.da&&(se(this),this.start())))},O.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},O.M=function(){oe.Z.M.call(this),se(this),delete this.g};var ue,ce=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}R(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(he,ue=z),he.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:function t(e){e.g=ae((function(){e.g=null,e.i&&(e.i=!1,t(e))}),e.j);var n=e.h;e.h=null,e.m.apply(null,n)}(this)},he.prototype.M=function(){ue.prototype.M.call(this),this.g&&(M.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},he);function he(t,e){var n=ue.call(this)||this;return n.m=t,n.j=e,n.h=null,n.i=!1,n.g=null,n}function le(t){z.call(this),this.h=t,this.g={}}H(le,z);var fe=[];function de(t,e,n,r){Array.isArray(n)||(n&&(fe[0]=n.toString()),n=fe);for(var i=0;i<n.length;i++){var o=Mt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function pe(t){st(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Vt(t)}),t),t.g={}}function ye(){this.g=!0}function ge(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return zt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}le.prototype.M=function(){le.Z.M.call(this),pe(this)},le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ye.prototype.Aa=function(){this.g=!1},ye.prototype.info=function(){};var me={},ve=null;function we(){return ve=ve||new Gt}function be(t){_t.call(this,me.Ma,t)}function Ee(){var t=we();Qt(t,new be(t))}function Te(t,e){_t.call(this,me.STAT_EVENT,t),this.stat=e}function Ie(t){var e=we();Qt(e,new Te(e,t))}function _e(t,e){_t.call(this,me.Na,t),this.size=e}function Se(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return M.setTimeout((function(){t()}),e)}me.Ma="serverreachability",H(be,_t),me.STAT_EVENT="statevent",H(Te,_t),me.Na="timingevent",H(_e,_t);var Ae={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9};function De(){}function Ne(t){return t.h||(t.h=t.i())}function Ce(){}function ke(){_t.call(this,"d")}function Re(){_t.call(this,"c")}function xe(){}function Oe(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new le(this),this.P=Me,this.W=new oe(t=yt?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Le}function Le(){this.i=null,this.g="",this.h=!1}L={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"},De.prototype.h=null,Wt={OPEN:"a",pb:"b",Ka:"c",Bb:"d"},H(ke,_t),H(Re,_t),H(xe,De),xe.prototype.g=function(){return new XMLHttpRequest},xe.prototype.i=function(){return{}};var Pe=new xe,Me=45e3,Fe={},Ve={};function Ue(t,e,n){t.K=1,t.v=un(en(e)),t.s=n,t.U=!0,qe(t,null)}function qe(t,e){t.F=Date.now(),Ke(t),t.A=en(t.v);var s,a,u,n,r,o,c=t.A,h=t.X;Array.isArray(h)||(h=[String(h)]),En(c.h,"t",h),t.C=0,c=t.l.H,t.h=new Le,t.g=Ir(t.l,c?e:null,!t.s),0<t.O&&(t.L=new ce(G(t.Ia,t,t.g),t.O)),de(t.V,t.g,"readystatechange",t.gb),e=t.H?rt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Ee(),s=t.j,a=t.u,u=t.A,n=t.m,r=t.X,o=t.s,s.info((function(){if(s.g)if(o)for(var t="",e=o.split("&"),c=0;c<e.length;c++){var h,i,l=e[c].split("=");1<l.length&&(h=l[0],l=l[1],t=2<=(i=h.split("_")).length&&"type"==i[1]?t+(h+"=")+l+"&":t+(h+"=redacted&"))}else t=null;else t=o;return"XMLHTTP REQ ("+n+") [attempt "+r+"]: "+a+"\n"+u+"\n"+t}))}function Be(t){return t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function je(t,e,n){for(var r,i,o,s,a,u=!0;!t.I&&t.C<n.length;){if(o=n,a=s=void 0,s=(i=t).C,(r=-1==(a=o.indexOf("\n",s))?Ve:(s=Number(o.substring(s,a)),isNaN(s)?Fe:(a+=1)+s>o.length?Ve:(o=o.substr(a,s),i.C=a+s,o)))==Ve){4==e&&(t.o=4,Ie(14),u=!1),ge(t.j,t.m,null,"[Incomplete Response]");break}if(r==Fe){t.o=4,Ie(15),ge(t.j,t.m,n,"[Invalid Chunk]"),u=!1;break}ge(t.j,t.m,r,null),We(t,r)}Be(t)&&r!=Ve&&r!=Fe&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Ie(16),u=!1),t.i=t.i&&u,u?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),pr(e),e.L=!0,Ie(11))):(ge(t.j,t.m,n,"[Invalid Chunked Response]"),ze(t),He(t))}function Ke(t){t.Y=Date.now()+t.P,Ge(t,t.P)}function Ge(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Se(G(t.eb,t),e)}function Qe(t){t.B&&(M.clearTimeout(t.B),t.B=null)}function He(t){0==t.l.G||t.I||mr(t.l,t)}function ze(t){Qe(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,se(t.W),pe(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function We(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Cn(n.i,t)))if(n.I=t.N,!t.J&&Cn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(y){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;gr(n),or(n)}hr(n),Ie(18)}}else n.ta=i[1],0<n.ta-n.U&&i[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=Se(G(n.ab,n),6e3));if(Nn(n.i)<=1&&n.ka){try{n.ka()}catch(y){}n.ka=void 0}}else wr(n,11)}else if(!t.J&&n.g!=t||gr(n),!Z(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o,s,a,u,c,h,l,f,d,p,y=i[e];n.U=y[0],y=y[1],2==n.G?"c"==y[0]?(n.J=y[1],n.la=y[2],null!=(o=y[3])&&(n.ma=o,n.h.info("VER="+n.ma)),null!=(s=y[4])&&(n.za=s,n.h.info("SVER="+n.za)),null!=(a=y[5])&&"number"==typeof a&&0<a&&(r=1.5*a,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n,(u=t.g)&&(!(c=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(h=r.i).g&&(nt(c,"spdy")||nt(c,"quic")||nt(c,"h2"))&&(h.j=h.l,h.g=new Set,h.h&&(kn(h,h.h),h.h=null)),!r.D||(l=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=l,an(r.F,r.D,l))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms")),f=t,(r=n).oa=Tr(r,r.H?r.la:null,r.W),f.J?(Rn(r.i,f),d=f,(p=r.K)&&d.setTimeout(p),d.B&&(Qe(d),Ke(d)),r.g=f):dr(r),0<n.l.length&&ur(n)):"stop"!=y[0]&&"close"!=y[0]||wr(n,7):3==n.G&&("stop"==y[0]||"close"==y[0]?"stop"==y[0]?wr(n,7):ir(n):"noop"!=y[0]&&n.j&&n.j.wa(y),n.A=0)}Ee()}catch(y){}}function Ye(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(V(t)||"string"==typeof t)X(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(V(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(V(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Xe(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Xe)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function $e(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Je(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)Je(i,r=t.g[e])||(i[t.g[n++]=r]=1),e++;t.g.length=n}}function Je(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(O=Oe.prototype).setTimeout=function(t){this.P=t},O.gb=function(t){t=t.target;var e=this.L;e&&3==Zn(t)?e.l():this.Ia(t)},O.Ia=function(t){try{if(t==this.g)t:{var e=Zn(this.g),n=this.g.Da();if(this.g.ba(),!(e<3)&&(3!=e||yt||this.g&&(this.h.h||this.g.ga()||er(this.g)))){this.I||4!=e||7==n||Ee(),Qe(this);var r=this.g.ba();this.N=r;e:if(Be(this)){var i=er(this.g);t="";var o=i.length,s=4==Zn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ze(this),He(this);var a="";break e}this.h.i=new M.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,t+=this.h.i.decode(i[n],{stream:s&&n==o-1});i.splice(0,o),this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,l=this.j,f=this.u,d=this.A,p=this.m,y=this.X,g=e,m=r,l.info((function(){return"XMLHTTP RESP ("+p+") [ attempt "+y+"]: "+f+"\n"+d+"\n"+g+" "+m})),this.i){if(this.$&&!this.J){e:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Z(u)){var h=u;break e}}h=null}if(!(r=h)){this.i=!1,this.o=3,Ie(12),ze(this),He(this);break t}ge(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,We(this,r)}this.U?(je(this,e,a),yt&&this.i&&3==e&&(de(this.V,this.W,"tick",this.fb),this.W.start())):(ge(this.j,this.m,a,null),We(this,a)),4==e&&ze(this),this.i&&!this.I&&(4==e?mr(this.l,this):(this.i=!1,Ke(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,Ie(12)):(this.o=0,Ie(13)),ze(this),He(this)}}}catch(e){}var l,f,d,p,y,g,m},O.fb=function(){var t,e;this.g&&(t=Zn(this.g),e=this.g.ga(),this.C<e.length&&(Qe(this),je(this,t,e),this.i&&4!=t&&Ke(this)))},O.cancel=function(){this.I=!0,ze(this)},O.eb=function(){this.B=null;var t,e,n=Date.now();0<=n-this.Y?(t=this.j,e=this.A,t.info((function(){return"TIMEOUT: "+e})),2!=this.K&&(Ee(),Ie(17)),ze(this),this.o=2,He(this)):Ge(this,this.Y-n)},(O=Xe.prototype).R=function(){$e(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},O.T=function(){return $e(this),this.g.concat()},O.get=function(t,e){return Je(this.h,t)?this.h[t]:e},O.set=function(t,e){Je(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},O.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ze=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function tn(t,e){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof tn?(this.g=void 0!==e?e:t.g,nn(this,t.j),this.s=t.s,rn(this,t.i),on(this,t.m),this.l=t.l,e=t.h,(n=new mn).i=e.i,e.g&&(n.g=new Xe(e.g),n.h=e.h),sn(this,n),this.o=t.o):t&&(n=String(t).match(Ze))?(this.g=!!e,nn(this,n[1]||"",!0),this.s=cn(n[2]||""),rn(this,n[3]||"",!0),on(this,n[4]),this.l=cn(n[5]||"",!0),sn(this,n[6]||"",!0),this.o=cn(n[7]||"")):(this.g=!!e,this.h=new mn(null,this.g))}function en(t){return new tn(t)}function nn(t,e,n){t.j=n?cn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function rn(t,e,n){t.i=n?cn(e,!0):e}function on(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.m=e}else t.m=null}function sn(t,e,n){var r,i;e instanceof mn?(t.h=e,r=t.h,(i=t.g)&&!r.j&&(vn(r),r.i=null,r.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(wn(this,e),En(this,n,t))}),r)),r.j=i):(n||(e=hn(e,yn)),t.h=new mn(e,t.g))}function an(t,e,n){t.h.set(e,n)}function un(t){return an(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function cn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function hn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ln),t=n?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function ln(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}tn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(hn(e,fn,!0),":");var n=this.i;return!n&&"file"!=e||(t.push("//"),(e=this.s)&&t.push(hn(e,fn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(hn(n,"/"==n.charAt(0)?pn:dn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",hn(n,gn)),t.join("")};var fn=/[#\/\?@]/g,dn=/[#\?:]/g,pn=/[#\?]/g,yn=/[#\?@]/g,gn=/#/g;function mn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function vn(t){t.g||(t.g=new Xe,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function wn(t,e){vn(t),e=Tn(t,e),Je(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Je((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&$e(t)))}function bn(t,e){return vn(t),e=Tn(t,e),Je(t.g.h,e)}function En(t,e,n){wn(t,e),0<n.length&&(t.i=null,t.g.set(Tn(t,e),J(n)),t.h+=n.length)}function Tn(t,e){return e=String(e),t.j?e.toLowerCase():e}(O=mn.prototype).add=function(t,e){vn(this),this.i=null,t=Tn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},O.forEach=function(t,e){vn(this),this.g.forEach((function(n,r){X(n,(function(n){t.call(e,n,r,this)}),this)}),this)},O.T=function(){vn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},O.R=function(t){vn(this);var e=[];if("string"==typeof t)bn(this,t)&&(e=$(e,this.g.get(Tn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=$(e,t[n])}return e},O.set=function(t,e){return vn(this),this.i=null,bn(this,t=Tn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},O.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},O.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),o=(r=this.R(r),0);o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.i=t.join("&")};var In=function(t,e){this.h=t,this.g=e};function _n(t){this.l=t||An,t=M.PerformanceNavigationTiming?0<(t=M.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(M.g&&M.g.Ea&&M.g.Ea()&&M.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Sn,An=10;function Dn(t){return t.h||t.g&&t.g.size>=t.j}function Nn(t){return t.h?1:t.g?t.g.size:0}function Cn(t,e){return t.h?t.h==e:t.g&&t.g.has(e)}function kn(t,e){t.g?t.g.add(e):t.h=e}function Rn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function xn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return J(t.i);var r=t.i;try{for(var i=x(t.g.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.D)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function On(){}function Ln(){this.g=new On}function Pn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function Mn(t){this.l=t.$b||null,this.j=t.ib||!1}function Fn(t,e){Gt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Vn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_n.prototype.cancel=function(){var t,e;if(this.i=xn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=x(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},On.prototype.stringify=function(t){return M.JSON.stringify(t,void 0)},On.prototype.parse=function(t){return M.JSON.parse(t,void 0)},H(Mn,De),Mn.prototype.g=function(){return new Fn(this.l,this.j)},Mn.prototype.i=(Sn={},function(){return Sn}),H(Fn,Gt);var Vn=0;function Un(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function qn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Bn(t)}function Bn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(O=Fn.prototype).open=function(t,e){if(this.readyState!=Vn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Bn(this)},O.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||M).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},O.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,qn(this)),this.readyState=Vn},O.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Bn(this)),this.g&&(this.readyState=3,Bn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==M.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Un(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},O.Sa=function(t){var e;this.g&&(this.u&&t.value?this.response.push(t.value):this.u||(e=t.value||new Uint8Array(0),(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)),(t.done?qn:Bn)(this),3==this.readyState&&Un(this))},O.Ua=function(t){this.g&&(this.response=this.responseText=t,qn(this))},O.Ta=function(t){this.g&&(this.response=t,qn(this))},O.ha=function(){this.g&&qn(this)},O.setRequestHeader=function(t,e){this.v.append(t,e)},O.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},O.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Fn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var jn=M.JSON.parse;function Kn(t){Gt.call(this),this.headers=new Xe,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Gn,this.K=this.L=!1}H(Kn,Gt);var Gn="",Qn=/^https?$/i,Hn=["POST","PUT"];function zn(t){return"content-type"==t.toLowerCase()}function Wn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Yn(t),$n(t)}function Yn(t){t.D||(t.D=!0,Qt(t,"complete"),Qt(t,"error"))}function Xn(t){if(t.h&&void 0!==P&&(!t.C[1]||4!=Zn(t)||2!=t.ba()))if(t.v&&4==Zn(t))ae(t.Fa,0,t);else if(Qt(t,"readystatechange"),4==Zn(t)){t.h=!1;try{var e,n,r,i,o=t.ba();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.H).match(Ze)[1]||null)&&M.self&&M.self.location&&(i=(r=M.self.location.protocol).substr(0,r.length-1)),n=!Qn.test(i?i.toLowerCase():"")),e=n),e)Qt(t,"complete"),Qt(t,"success");else{t.m=6;try{var a=2<Zn(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",Yn(t)}}finally{$n(t)}}}function $n(t,e){if(t.g){Jn(t);var n=t.g,r=t.C[0]?F:null;t.g=null,t.C=null,e||Qt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Jn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(M.clearTimeout(t.A),t.A=null)}function Zn(t){return t.g?t.g.readyState:0}function er(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Gn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function nr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",st(n,(function(t,e){i+=e,i+=":",i+=t,i+="\r\n"})),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):an(t,e,n))}function rr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function tr(t){this.za=0,this.l=[],this.h=new ye,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=rr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=rr("baseRetryDelayMs",5e3,t),this.$a=rr("retryDelaySeedMs",1e4,t),this.Ya=rr("forwardChannelMaxRetries",2,t),this.ra=rr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new _n(t&&t.concurrentRequestLimit),this.Ca=new Ln,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function ir(t){var e,n;sr(t),3==t.G&&(e=t.V++,an(n=en(t.F),"SID",t.J),an(n,"RID",e),an(n,"TYPE","terminate"),lr(t,n),(e=new Oe(t,t.h,e,void 0)).K=2,e.v=un(en(n)),n=!1,!(n=M.navigator&&M.navigator.sendBeacon?M.navigator.sendBeacon(e.v.toString(),""):n)&&M.Image&&((new Image).src=e.v,n=!0),n||(e.g=Ir(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Ke(e)),Er(t)}function or(t){t.g&&(pr(t),t.g.cancel(),t.g=null)}function sr(t){or(t),t.u&&(M.clearTimeout(t.u),t.u=null),gr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&M.clearTimeout(t.m),t.m=null)}function ar(t,e){t.l.push(new In(t.Za++,e)),3==t.G&&ur(t)}function ur(t){Dn(t.i)||t.m||(t.m=!0,ee(t.Ha,t),t.C=0)}function cr(t,e){var n=e?e.m:t.V++,r=en(t.F);an(r,"SID",t.J),an(r,"RID",n),an(r,"AID",t.U),lr(t,r),t.o&&t.s&&nr(r,t.o,t.s),n=new Oe(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=fr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),kn(t.i,n),Ue(n,r,e)}function lr(t,e){t.j&&Ye({},(function(t,n){an(e,n,t)}))}function fr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?G(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if((c-=o)<0)o=Math.max(0,i[u].h-100),a=!1;else try{!function(t,e,n){var i=n||"";try{Ye(t,(function(t,n){var r=t;U(t)&&(r=zt(t)),e.push(i+n+"="+encodeURIComponent(r))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function dr(t){t.g||t.u||(t.Y=1,ee(t.Ga,t),t.A=0)}function hr(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=Se(G(t.Ga,t),vr(t,t.A)),t.A++,1)}function pr(t){null!=t.B&&(M.clearTimeout(t.B),t.B=null)}function yr(t){t.g=new Oe(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=en(t.oa);an(e,"RID","rpc"),an(e,"SID",t.J),an(e,"CI",t.N?"0":"1"),an(e,"AID",t.U),lr(t,e),an(e,"TYPE","xmlhttp"),t.o&&t.s&&nr(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=un(en(e)),n.s=null,n.U=!0,qe(n,t)}function gr(t){null!=t.v&&(M.clearTimeout(t.v),t.v=null)}function mr(t,e){var n,r,i,o=null;if(t.g==e){gr(t),pr(t),t.g=null;var s=2}else{if(!Cn(t.i,e))return;o=e.D,Rn(t.i,e),s=1}if(t.I=e.N,0!=t.G)if(e.i)1==s?(o=e.s?e.s.length:0,e=Date.now()-e.F,n=t.C,Qt(s=we(),new _e(s,o)),ur(t)):dr(t);else if(3==(n=e.o)||0==n&&0<t.I||(1!=s||(i=e,Nn((r=t).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=i.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=Se(G(r.Ha,r,i),vr(r,r.C)),r.C++,0))))&&(2!=s||!hr(t)))switch(o&&0<o.length&&(e=t.i,e.i=e.i.concat(o)),n){case 1:wr(t,5);break;case 4:wr(t,10);break;case 3:wr(t,6);break;default:wr(t,2)}}function vr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function wr(t,e){var n,r,i,o;t.h.info("Error code "+e),2==e?(r=null,t.j&&(r=null),o=G(t.jb,t),r||(r=new tn("//www.google.com/images/cleardot.gif"),M.location&&"http"==M.location.protocol||nn(r,"https"),un(r)),n=r.toString(),r=o,o=new ye,M.Image?((i=new Image).onload=Q(Pn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=Q(Pn,o,i,"TestLoadImage: error",!1,r),i.onabort=Q(Pn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=Q(Pn,o,i,"TestLoadImage: timeout",!1,r),M.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=n):r(!1)):Ie(2),t.G=0,t.j&&t.j.va(e),Er(t),sr(t)}function Er(t){t.G=0,t.I=-1,t.j&&(0==xn(t.i).length&&0==t.l.length||(t.i.i.length=0,J(t.l),t.l.length=0),t.j.ua())}function Tr(t,e,n){var r,i,o,s,a,u=(s=n)instanceof tn?en(s):new tn(s,void 0);return""!=u.i?(e&&rn(u,e+"."+u.i),on(u,u.m)):(r=(a=M.location).protocol,i=e?e+"."+a.hostname:a.hostname,o=+a.port,s=n,a=new tn(null,void 0),r&&nn(a,r),i&&rn(a,i),o&&on(a,o),s&&(a.l=s),u=a),t.aa&&st(t.aa,(function(t,e){an(u,e,t)})),e=t.D,n=t.sa,e&&n&&an(u,e,n),an(u,"VER",t.ma),lr(t,u),u}function Ir(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new Kn(new Mn({ib:!0})):new Kn(t.qa)).L=t.H,e}function br(){}function _r(){if(ft&&!(10<=Number(Tt)))throw Error("Environmental error: no available transport.")}function Sr(t,e){Gt.call(this),this.g=new tr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!Z(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Z(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Nr(this)}function Ar(t){ke.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Dr(){Re.call(this),this.status=1}function Nr(t){this.g=t}(O=Kn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||Pe).g(),this.C=this.u?Ne(this.u):Ne(Pe),this.g.onreadystatechange=G(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Wn(this,t)}t=n||"";var i,o=new Xe(this.headers);r&&Ye(r,(function(t,e){o.set(e,t)})),r=function(t){t:{for(var e=zn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.T()),n=M.FormData&&t instanceof M.FormData,0<=Y(Hn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Jn(this),0<this.B&&((this.K=(i=this.g,ft&&Et()&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=G(this.pa,this)):this.A=ae(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Wn(this,t)}},O.pa=function(){void 0!==P&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Qt(this,"timeout"),this.abort(8))},O.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Qt(this,"complete"),Qt(this,"abort"),$n(this))},O.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),$n(this,!0)),Kn.Z.M.call(this)},O.Fa=function(){this.s||(this.F||this.v||this.l?Xn(this):this.cb())},O.cb=function(){Xn(this)},O.ba=function(){try{return 2<Zn(this)?this.g.status:-1}catch(t){return-1}},O.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},O.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),jn(e)}},O.Da=function(){return this.m},O.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(O=tr.prototype).ma=8,O.G=1,O.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},O.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Oe(this,this.h,t,void 0),n=this.s;if(this.P&&(n?ut(n=rt(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=fr(this,e,r),an(i=en(this.F),"RID",t),an(i,"CVER",22),this.D&&an(i,"X-HTTP-Session-Id",this.D),lr(this,i),this.o&&n&&nr(i,this.o,n),kn(this.i,e),this.Ra&&an(i,"TYPE","init"),this.ja?(an(i,"$req",r),an(i,"SID","null"),e.$=!0,Ue(e,i,null)):Ue(e,i,r),this.G=2}}else 3==this.G&&(t?cr(this,t):0==this.l.length||Dn(this.i)||cr(this))},O.Ga=function(){var t;this.u=null,yr(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(t=2*this.O,this.h.info("BP detection timer enabled: "+t),this.B=Se(G(this.bb,this),t))},O.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Ie(10),or(this),yr(this))},O.ab=function(){null!=this.v&&(this.v=null,or(this),hr(this),Ie(19))},O.jb=function(t){t?(this.h.info("Successfully pinged google.com"),Ie(2)):(this.h.info("Failed to ping google.com"),Ie(1))},(O=br.prototype).xa=function(){},O.wa=function(){},O.va=function(){},O.ua=function(){},O.Oa=function(){},_r.prototype.g=function(t,e){return new Sr(t,e)},H(Sr,Gt),Sr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),ee(G(t.hb,t,e))),Ie(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=Tr(t,null,t.W),ur(t)},Sr.prototype.close=function(){ir(this.g)},Sr.prototype.u=function(t){var e;"string"==typeof t?((e={}).__data__=t,ar(this.g,e)):this.v?((e={}).__data__=zt(t),ar(this.g,e)):ar(this.g,t)},Sr.prototype.M=function(){this.g.j=null,delete this.j,ir(this.g),delete this.g,Sr.Z.M.call(this)},H(Ar,ke),H(Dr,Re),H(Nr,br),Nr.prototype.xa=function(){Qt(this.g,"a")},Nr.prototype.wa=function(t){Qt(this.g,new Ar(t))},Nr.prototype.va=function(t){Qt(this.g,new Dr)},Nr.prototype.ua=function(){Qt(this.g,"b")},_r.prototype.createWebChannel=_r.prototype.g,Sr.prototype.send=Sr.prototype.u,Sr.prototype.open=Sr.prototype.m,Ae.NO_ERROR=0,Ae.TIMEOUT=8,Ae.HTTP_ERROR=6,L.COMPLETE="complete",(Ce.EventType=Wt).OPEN="a",Wt.CLOSE="b",Wt.ERROR="c",Wt.MESSAGE="d",Gt.prototype.listen=Gt.prototype.N,Kn.prototype.listenOnce=Kn.prototype.O,Kn.prototype.getLastError=Kn.prototype.La,Kn.prototype.getLastErrorCode=Kn.prototype.Da,Kn.prototype.getStatus=Kn.prototype.ba,Kn.prototype.getResponseJson=Kn.prototype.Qa,Kn.prototype.getResponseText=Kn.prototype.ga,Kn.prototype.send=Kn.prototype.ea;var Cr=we,kr=Ae,Rr=L,xr=me,Or=10,Lr=11,Pr=Mn,Mr=Ce,Fr=Kn,Vr=(Ur.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Ur.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},Ur);function Ur(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}Vr.o=-1;var qr,Br={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},jr=(h(Gr,qr=Error),Gr),Kr=new C("@firebase/firestore");function Gr(t,e){var n=this;return(n=qr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Qr(){return Kr.logLevel}function Hr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Kr.logLevel<=I.DEBUG&&(e=n.map(Yr),Kr.debug.apply(Kr,s(["Firestore (8.10.0): "+t],e)))}function zr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Kr.logLevel<=I.ERROR&&(e=n.map(Yr),Kr.error.apply(Kr,s(["Firestore (8.10.0): "+t],e)))}function Wr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Kr.logLevel<=I.WARN&&(e=n.map(Yr),Kr.warn.apply(Kr,s(["Firestore (8.10.0): "+t],e)))}function Yr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Xr(t){throw zr(t="FIRESTORE (8.10.0) INTERNAL ASSERTION FAILED: "+(t=void 0===t?"Unexpected state":t)),new Error(t)}function $r(t){t||Xr()}var Jr=(Zr.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Zr);function Zr(){}function ti(t,e){return t<e?-1:e<t?1:0}function ei(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function ni(t){return t+"\0"}var ri=(si.now=function(){return si.fromMillis(Date.now())},si.fromDate=function(t){return si.fromMillis(t.getTime())},si.fromMillis=function(t){var e=Math.floor(t/1e3);return new si(e,Math.floor(1e6*(t-1e3*e)))},si.prototype.toDate=function(){return new Date(this.toMillis())},si.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},si.prototype._compareTo=function(t){return this.seconds===t.seconds?ti(this.nanoseconds,t.nanoseconds):ti(this.seconds,t.seconds)},si.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},si.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},si.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},si.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},si),ii=(oi.fromTimestamp=function(t){return new oi(t)},oi.min=function(){return new oi(new ri(0,0))},oi.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},oi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},oi.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},oi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},oi.prototype.toTimestamp=function(){return this.timestamp},oi);function oi(t){this.timestamp=t}function si(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new jr(Br.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new jr(Br.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new jr(Br.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new jr(Br.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function ai(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function ui(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ci(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}Object.defineProperty(Ei.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),Ei.prototype.isEqual=function(t){return 0===Ei.comparator(this,t)},Ei.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Ei?t.forEach((function(t){e.push(t)})):e.push(t),this.construct(e)},Ei.prototype.limit=function(){return this.offset+this.length},Ei.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},Ei.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},Ei.prototype.firstSegment=function(){return this.segments[this.offset]},Ei.prototype.lastSegment=function(){return this.get(this.length-1)},Ei.prototype.get=function(t){return this.segments[this.offset+t]},Ei.prototype.isEmpty=function(){return 0===this.length},Ei.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Ei.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Ei.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Ei.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},Ei.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0};var hi,fi,di=(h(bi,fi=L=Ei),bi.prototype.construct=function(t,e,n){return new bi(t,e,n)},bi.prototype.canonicalString=function(){return this.toArray().join("/")},bi.prototype.toString=function(){return this.canonicalString()},bi.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new jr(Br.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter((function(t){return 0<t.length})))}return new bi(n)},bi.emptyPath=function(){return new bi([])},bi),pi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,li=(h(wi,hi=L),wi.prototype.construct=function(t,e,n){return new wi(t,e,n)},wi.isValidIdentifier=function(t){return pi.test(t)},wi.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),wi.isValidIdentifier(t)?t:"`"+t+"`"})).join(".")},wi.prototype.toString=function(){return this.canonicalString()},wi.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},wi.keyField=function(){return new wi(["__name__"])},wi.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new jr(Br.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new jr(Br.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new jr(Br.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new jr(Br.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new wi(e)},wi.emptyPath=function(){return new wi([])},wi),yi=(vi.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},vi.prototype.isEqual=function(t){return ei(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},vi),gi=(mi.fromBase64String=function(t){return new mi(atob(t))},mi.fromUint8Array=function(t){return new mi(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},mi.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},mi.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},mi.prototype.approximateByteSize=function(){return 2*this.binaryString.length},mi.prototype.compareTo=function(t){return ti(this.binaryString,t.binaryString)},mi.prototype.isEqual=function(t){return this.binaryString===t.binaryString},mi);function mi(t){this.binaryString=t}function vi(t){(this.fields=t).sort(li.comparator)}function wi(){return null!==hi&&hi.apply(this,arguments)||this}function bi(){return null!==fi&&fi.apply(this,arguments)||this}function Ei(t,e,n){void 0===e?e=0:e>t.length&&Xr(),void 0===n?n=t.length-e:n>t.length-e&&Xr(),this.segments=t,this.offset=e,this.len=n}gi.EMPTY_BYTE_STRING=new gi("");var Ti=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ii(t){if($r(!!t),"string"!=typeof t)return{seconds:_i(t.seconds),nanos:_i(t.nanos)};var e=0,n=Ti.exec(t);return $r(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n)),t=new Date(t),{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function _i(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Si(t){return"string"==typeof t?gi.fromBase64String(t):gi.fromUint8Array(t)}function Ai(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Di(t){return t=Ii(t.mapValue.fields.__local_write_time__.timestampValue),new ri(t.seconds,t.nanos)}function Ni(t){return null==t}function Ci(t){return 0===t&&1/t==-1/0}function ki(t){return"number"==typeof t&&Number.isInteger(t)&&!Ci(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Ri=(xi.fromPath=function(t){return new xi(di.fromString(t))},xi.fromName=function(t){return new xi(di.fromString(t).popFirst(5))},xi.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},xi.prototype.isEqual=function(t){return null!==t&&0===di.comparator(this.path,t.path)},xi.prototype.toString=function(){return this.path.toString()},xi.comparator=function(t,e){return di.comparator(t.path,e.path)},xi.isDocumentKey=function(t){return t.length%2==0},xi.fromSegments=function(t){return new xi(new di(t.slice()))},xi);function xi(t){this.path=t}function Oi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ai(t)?4:10:Xr()}function Li(t,i){var e,n,r=Oi(t);if(r!==Oi(i))return!1;switch(r){case 0:return!0;case 1:return t.booleanValue===i.booleanValue;case 4:return Di(t).isEqual(Di(i));case 3:return function(e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ii(t.timestampValue);return e=Ii(e.timestampValue),n.seconds===e.seconds&&n.nanos===e.nanos}(i);case 5:return t.stringValue===i.stringValue;case 6:return n=i,Si(t.bytesValue).isEqual(Si(n.bytesValue));case 7:return t.referenceValue===i.referenceValue;case 8:return e=i,_i((n=t).geoPointValue.latitude)===_i(e.geoPointValue.latitude)&&_i(n.geoPointValue.longitude)===_i(e.geoPointValue.longitude);case 2:return function(t,e){return"integerValue"in t&&"integerValue"in e?_i(t.integerValue)===_i(e.integerValue):"doubleValue"in t&&"doubleValue"in e&&((t=_i(t.doubleValue))===(e=_i(e.doubleValue))?Ci(t)===Ci(e):isNaN(t)&&isNaN(e))}(t,i);case 9:return ei(t.arrayValue.values||[],i.arrayValue.values||[],Li);case 10:return function(){var e,n=t.mapValue.fields||{},r=i.mapValue.fields||{};if(ai(n)!==ai(r))return!1;for(e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Li(n[e],r[e])))return!1;return!0}();default:return Xr()}}function Pi(t,e){return void 0!==(t.values||[]).find((function(t){return Li(t,e)}))}function Mi(t,e){var n,r,i,o=Oi(t),s=Oi(e);if(o!==s)return ti(o,s);switch(o){case 0:return 0;case 1:return ti(t.booleanValue,e.booleanValue);case 2:return r=e,(i=_i(t.integerValue||t.doubleValue))<(r=_i(r.integerValue||r.doubleValue))?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return Fi(t.timestampValue,e.timestampValue);case 4:return Fi(Di(t),Di(e));case 5:return ti(t.stringValue,e.stringValue);case 6:return function(t,e){return t=Si(t),e=Si(e),t.compareTo(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=ti(n[i],r[i]);if(0!==o)return o}return ti(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,i=e.geoPointValue,0!==(r=ti(_i(n.latitude),_i(i.latitude)))?r:ti(_i(n.longitude),_i(i.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Mi(n[i],r[i]);if(o)return o}return ti(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=ti(r[s],o[s]);if(0!==a)return a;if(0!==(a=Mi(n[r[s]],i[o[s]])))return a}return ti(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Xr()}}function Fi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ti(t,e);var n=Ii(t);return t=Ii(e),0!==(e=ti(n.seconds,t.seconds))?e:ti(n.nanos,t.nanos)}function Vi(t){return function s(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){return"time("+(t=Ii(t)).seconds+","+t.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Si(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,Ri.fromName(e).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=s(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(t.mapValue):Xr();var e}(t)}function Ui(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function qi(t){return t&&"integerValue"in t}function Bi(t){return!!t&&"arrayValue"in t}function ji(t){return t&&"nullValue"in t}function Ki(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Gi(t){return t&&"mapValue"in t}function Qi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return ui(t.mapValue.fields,(function(t,n){return e.mapValue.fields[t]=Qi(n)})),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Qi(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Hi=(zi.empty=function(){return new zi({mapValue:{}})},zi.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Gi(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},zi.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Qi(e)},zi.prototype.setAll=function(t){var e=this,i=li.emptyPath(),n={},s=[];t.forEach((function(t,r){var o;i.isImmediateParentOf(r)||(o=e.getFieldsMap(i),e.applyChanges(o,n,s),n={},s=[],i=r.popLast()),t?n[r.lastSegment()]=Qi(t):s.push(r.lastSegment())})),t=this.getFieldsMap(i),this.applyChanges(t,n,s)},zi.prototype.delete=function(t){var e=this.field(t.popLast());Gi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},zi.prototype.isEqual=function(t){return Li(this.value,t.value)},zi.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Gi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},zi.prototype.applyChanges=function(t,e,n){ui(e,(function(e,n){return t[e]=n}));for(var r=0,i=n;r<i.length;r++){var o=i[r];delete t[o]}},zi.prototype.clone=function(){return new zi(Qi(this.value))},zi);function zi(t){this.value=t}var Wi=(Xi.newInvalidDocument=function(t){return new Xi(t,0,ii.min(),Hi.empty(),0)},Xi.newFoundDocument=function(t,e,n){return new Xi(t,1,e,n,0)},Xi.newNoDocument=function(t,e){return new Xi(t,2,e,Hi.empty(),0)},Xi.newUnknownDocument=function(t,e){return new Xi(t,3,e,Hi.empty(),2)},Xi.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},Xi.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Hi.empty(),this.documentState=0,this},Xi.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Hi.empty(),this.documentState=2,this},Xi.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},Xi.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(Xi.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Xi.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Xi.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Xi.prototype.isValidDocument=function(){return 0!==this.documentType},Xi.prototype.isFoundDocument=function(){return 1===this.documentType},Xi.prototype.isNoDocument=function(){return 2===this.documentType},Xi.prototype.isUnknownDocument=function(){return 3===this.documentType},Xi.prototype.isEqual=function(t){return t instanceof Xi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},Xi.prototype.clone=function(){return new Xi(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},Xi.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},Xi),Yi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Xi(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}function $i(t,e,n,r,i,o,s){return new Yi(t,e=void 0===e?null:e,n=void 0===n?[]:n,r=void 0===r?[]:r,i=void 0===i?null:i,o=void 0===o?null:o,s=void 0===s?null:s)}function Ji(t){var e=t;return null===e.h&&(t=e.path.canonicalString(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((function(t){return(t=t).field.canonicalString()+t.op.toString()+Vi(t.value)})).join(","),t+="|ob:",t+=e.orderBy.map((function(t){return(t=t).field.canonicalString()+t.dir})).join(","),Ni(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=No(e.startAt)),e.endAt&&(t+="|ub:",t+=No(e.endAt)),e.h=t),e.h}function Zi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,a=0;a<t.filters.length;a++)if(o=t.filters[a],s=e.filters[a],o.op!==s.op||!o.field.isEqual(s.field)||!Li(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ro(t.startAt,e.startAt)&&Ro(t.endAt,e.endAt)}function to(t){return Ri.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var eo,no=(h(ro,eo=function(){}),ro.create=function(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new ao(t,e,n):"array-contains"===e?new wo(t,n):"in"===e?new bo(t,n):"not-in"===e?new Eo(t,n):"array-contains-any"===e?new To(t,n):new ro(t,e,n)},ro.l=function(t,e,n){return new("in"===e?uo:co)(t,n)},ro.prototype.matches=function(t){return t=t.data.field(this.field),"!="===this.op?null!==t&&this.m(Mi(t,this.value)):null!==t&&Oi(this.value)===Oi(t)&&this.m(Mi(t,this.value))},ro.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Xr()}},ro.prototype.g=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},ro);function ro(t,e,n){var r=this;return(r=eo.call(this)||this).field=t,r.op=e,r.value=n,r}var io,oo,so,ao=(h(fo,so=no),fo.prototype.matches=function(t){return t=Ri.comparator(t.key,this.key),this.m(t)},fo),uo=(h(lo,oo=no),lo.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},lo),co=(h(ho,io=no),ho.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},ho);function ho(t,e){var n=this;return(n=io.call(this,t,"not-in",e)||this).keys=po(0,e),n}function lo(t,e){var n=this;return(n=oo.call(this,t,"in",e)||this).keys=po(0,e),n}function fo(t,e,n){var r=this;return(r=so.call(this,t,e,n)||this).key=Ri.fromName(n.referenceValue),r}function po(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map((function(t){return Ri.fromName(t.referenceValue)}))}var yo,go,mo,vo,wo=(h(Do,vo=no),Do.prototype.matches=function(t){return Bi(t=t.data.field(this.field))&&Pi(t.arrayValue,this.value)},Do),bo=(h(Ao,mo=no),Ao.prototype.matches=function(t){return null!==(t=t.data.field(this.field))&&Pi(this.value.arrayValue,t)},Ao),Eo=(h(So,go=no),So.prototype.matches=function(t){return!Pi(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&null!==(t=t.data.field(this.field))&&!Pi(this.value.arrayValue,t)},So),To=(h(_o,yo=no),_o.prototype.matches=function(t){var e=this;return!(!Bi(t=t.data.field(this.field))||!t.arrayValue.values)&&t.arrayValue.values.some((function(t){return Pi(e.value.arrayValue,t)}))},_o),Io=function(t,e){this.position=t,this.before=e};function _o(t,e){return yo.call(this,t,"array-contains-any",e)||this}function So(t,e){return go.call(this,t,"not-in",e)||this}function Ao(t,e){return mo.call(this,t,"in",e)||this}function Do(t,e){return vo.call(this,t,"array-contains",e)||this}function No(t){return(t.before?"b":"a")+":"+t.position.map(Vi).join(",")}var Co=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function ko(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Ri.comparator(Ri.fromName(s.referenceValue),n.key):Mi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Ro(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Li(t.position[n],e.position[n]))return!1;return!0}var xo=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function Oo(t,e,n,r,i,o,s,a){return new xo(t,e,n,r,i,o,s,a)}function Lo(t){return new xo(t)}function Po(t){return!Ni(t.limit)&&"F"===t.limitType}function Mo(t){return!Ni(t.limit)&&"L"===t.limitType}function Fo(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function Vo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Uo(t){return null!==t.collectionGroup}function qo(t){var e=t;if(null===e.p){e.p=[];var n=Vo(e);if(t=Fo(e),null!==n&&null===t)n.isKeyField()||e.p.push(new Co(n)),e.p.push(new Co(li.keyField(),"asc"));else{for(var r=!1,i=0,o=e.explicitOrderBy;i<o.length;i++){var s=o[i];e.p.push(s),s.field.isKeyField()&&(r=!0)}r||(n=0<e.explicitOrderBy.length?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",e.p.push(new Co(li.keyField(),n)))}}return e.p}function Bo(t){var e=t;if(!e.T)if("F"===e.limitType)e.T=$i(e.path,e.collectionGroup,qo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=qo(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Co(o.field,s))}var a=e.endAt?new Io(e.endAt.position,!e.endAt.before):null;t=e.startAt?new Io(e.startAt.position,!e.startAt.before):null,e.T=$i(e.path,e.collectionGroup,n,e.filters,e.limit,a,t)}return e.T}function jo(t,e,n){return new xo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ko(t,e){return Zi(Bo(t),Bo(e))&&t.limitType===e.limitType}function Go(t){return Ji(Bo(t))+"|lt:"+t.limitType}function Qo(t){return"Query(target="+(n=(e=Bo(t)).path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map((function(t){return(t=t).field.canonicalString()+" "+t.op+" "+Vi(t.value)})).join(", ")+"]"),Ni(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map((function(t){return(t=t).field.canonicalString()+" ("+t.dir+")"})).join(", ")+"]"),e.startAt&&(n+=", startAt: "+No(e.startAt)),e.endAt&&(n+=", endAt: "+No(e.endAt)),"Target("+n+"); limitType=")+t.limitType+")";var e,n}function Ho(i,t){return t.isFoundDocument()&&(e=i,n=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Ri.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n))&&function(t){for(var e=0,n=i.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.data.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||ko(t.startAt,qo(t),n))&&(!t.endAt||!ko(t.endAt,qo(t),n)));var e,n}function zo(a){return function(t,e){for(var n=!1,r=0,i=qo(a);r<i.length;r++){var o=i[r],s=function(t,e,n){var r=t.field.isKeyField()?Ri.comparator(e.key,n.key):function(t,n){var r=e.data.field(t);return t=n.data.field(t),null!==r&&null!==t?Mi(r,t):Xr()}(t.field,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Xr()}}(o,t,e);if(0!==s)return s;n=n||o.field.isKeyField()}return 0}}function Wo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ci(e)?"-0":e}}function Yo(t){return{integerValue:""+t}}function Xo(t,e){return ki(e)?Yo(e):Wo(t,e)}function $o(t,e){return t instanceof hs?qi(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var Jo,Zo,ts=(h(rs,Zo=C=function(){this._=void 0}),rs),es=(h(ns,Jo=C),ns);function ns(t){var e=this;return(e=Jo.call(this)||this).elements=t,e}function rs(){return null!==Zo&&Zo.apply(this,arguments)||this}function is(t,e){for(var n=ds(e),r=0,i=t.elements;r<i.length;r++)!function(t){n.some((function(e){return Li(e,t)}))||n.push(t)}(i[r]);return{arrayValue:{values:n}}}var os,ss=(h(as,os=C),as);function as(t){var e=this;return(e=os.call(this)||this).elements=t,e}function us(t,e){for(var n=ds(e),r=0,i=t.elements;r<i.length;r++)!function(t){n=n.filter((function(e){return!Li(e,t)}))}(i[r]);return{arrayValue:{values:n}}}var cs,hs=(h(ls,cs=C),ls);function ls(t,e){var n=this;return(n=cs.call(this)||this).R=t,n.A=e,n}function fs(t){return _i(t.integerValue||t.doubleValue)}function ds(t){return Bi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function ps(t,e){this.version=t,this.transformResults=e}var ys=function(t,e){this.field=t,this.transform=e},gs=(ms.none=function(){return new ms},ms.exists=function(t){return new ms(void 0,t)},ms.updateTime=function(t){return new ms(t)},Object.defineProperty(ms.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),ms.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},ms);function ms(t,e){this.updateTime=t,this.exists=e}function vs(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}function ws(t,e,n){var r,i,o,s;t instanceof _s?(i=e,o=n,vs((r=t).precondition,i)&&(s=r.value.clone(),o=ks(r.fieldTransforms,o,i),s.setAll(o),i.convertToFoundDocument(Es(i),s).setHasLocalMutations())):t instanceof Ss?(o=e,i=n,vs((s=t).precondition,o)&&(n=ks(s.fieldTransforms,i,o),(i=o.data).setAll(Ns(s)),i.setAll(n),o.convertToFoundDocument(Es(o),i).setHasLocalMutations())):(e=e,vs(t.precondition,e)&&e.convertToNoDocument(ii.min()))}function bs(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&ei(n,r,(function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof es&&e instanceof es||t instanceof ss&&e instanceof ss?ei(t.elements,e.elements,Li):t instanceof hs&&e instanceof hs?Li(t.A,e.A):t instanceof ts&&e instanceof ts)}))))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function Es(t){return t.isFoundDocument()?t.version:ii.min()}var Ts,Is,_s=(h(Ds,Is=L=function(){}),Ds),Ss=(h(As,Ts=L),As);function As(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=Ts.call(this)||this).key=t,o.data=e,o.fieldMask=n,o.precondition=r,o.fieldTransforms=i,o.type=1,o}function Ds(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=Is.call(this)||this).key=t,i.value=e,i.precondition=n,i.fieldTransforms=r,i.type=0,i}function Ns(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){var r;n.isEmpty()||(r=t.data.field(n),e.set(n,r))})),e}function Cs(t,e,n){var r=new Map;$r(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,(o=s,s=a,a=n[i],o instanceof es?is(o,s):o instanceof ss?us(o,s):a))}return r}function ks(t,e,n){for(var r,i=new Map,o=0,s=t;o<s.length;o++){var a=s[o],u=a.transform,c=n.data.field(a.field);i.set(a.field,(r=c,a=e,c=void 0,(u=u)instanceof ts?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):u instanceof es?is(u,r):u instanceof ss?us(u,r):(r=fs(u=$o(c=u,r))+fs(c.A),qi(u)&&qi(c.A)?Yo(r):Wo(c.R,r))))}return i}function Rs(t){this.count=t}var xs,Os,Ls,Ps=(h(Vs,Ls=L),Vs),Ms=(h(Fs,Os=L),Fs);function Fs(t,e){var n=this;return(n=Os.call(this)||this).key=t,n.precondition=e,n.type=3,n.fieldTransforms=[],n}function Vs(t,e){var n=this;return(n=Ls.call(this)||this).key=t,n.precondition=e,n.type=2,n.fieldTransforms=[],n}function Us(t){switch(t){case Br.OK:return Xr(),0;case Br.CANCELLED:case Br.UNKNOWN:case Br.DEADLINE_EXCEEDED:case Br.RESOURCE_EXHAUSTED:case Br.INTERNAL:case Br.UNAVAILABLE:case Br.UNAUTHENTICATED:return;case Br.INVALID_ARGUMENT:case Br.NOT_FOUND:case Br.ALREADY_EXISTS:case Br.PERMISSION_DENIED:case Br.FAILED_PRECONDITION:case Br.ABORTED:case Br.OUT_OF_RANGE:case Br.UNIMPLEMENTED:case Br.DATA_LOSS:return 1;default:return Xr(),0}}function qs(t){if(void 0===t)return zr("GRPC error has no .code"),Br.UNKNOWN;switch(t){case xs.OK:return Br.OK;case xs.CANCELLED:return Br.CANCELLED;case xs.UNKNOWN:return Br.UNKNOWN;case xs.DEADLINE_EXCEEDED:return Br.DEADLINE_EXCEEDED;case xs.RESOURCE_EXHAUSTED:return Br.RESOURCE_EXHAUSTED;case xs.INTERNAL:return Br.INTERNAL;case xs.UNAVAILABLE:return Br.UNAVAILABLE;case xs.UNAUTHENTICATED:return Br.UNAUTHENTICATED;case xs.INVALID_ARGUMENT:return Br.INVALID_ARGUMENT;case xs.NOT_FOUND:return Br.NOT_FOUND;case xs.ALREADY_EXISTS:return Br.ALREADY_EXISTS;case xs.PERMISSION_DENIED:return Br.PERMISSION_DENIED;case xs.FAILED_PRECONDITION:return Br.FAILED_PRECONDITION;case xs.ABORTED:return Br.ABORTED;case xs.OUT_OF_RANGE:return Br.OUT_OF_RANGE;case xs.UNIMPLEMENTED:return Br.UNIMPLEMENTED;case xs.DATA_LOSS:return Br.DATA_LOSS;default:return Xr()}}(C=xs=xs||{})[C.OK=0]="OK",C[C.CANCELLED=1]="CANCELLED",C[C.UNKNOWN=2]="UNKNOWN",C[C.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",C[C.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",C[C.NOT_FOUND=5]="NOT_FOUND",C[C.ALREADY_EXISTS=6]="ALREADY_EXISTS",C[C.PERMISSION_DENIED=7]="PERMISSION_DENIED",C[C.UNAUTHENTICATED=16]="UNAUTHENTICATED",C[C.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",C[C.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",C[C.ABORTED=10]="ABORTED",C[C.OUT_OF_RANGE=11]="OUT_OF_RANGE",C[C.UNIMPLEMENTED=12]="UNIMPLEMENTED",C[C.INTERNAL=13]="INTERNAL",C[C.UNAVAILABLE=14]="UNAVAILABLE",C[C.DATA_LOSS=15]="DATA_LOSS";var Bs=(Hs.prototype.insert=function(t,e){return new Hs(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ks.BLACK,null,null))},Hs.prototype.remove=function(t){return new Hs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ks.BLACK,null,null))},Hs.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Hs.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Hs.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Hs.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Hs.prototype.minKey=function(){return this.root.minKey()},Hs.prototype.maxKey=function(){return this.root.maxKey()},Hs.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},Hs.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},Hs.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},Hs.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},Hs.prototype.getIterator=function(){return new js(this.root,null,this.comparator,!1)},Hs.prototype.getIteratorFrom=function(t){return new js(this.root,t,this.comparator,!1)},Hs.prototype.getReverseIterator=function(){return new js(this.root,null,this.comparator,!0)},Hs.prototype.getReverseIteratorFrom=function(t){return new js(this.root,t,this.comparator,!0)},Hs),js=(Qs.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Qs.prototype.hasNext=function(){return 0<this.nodeStack.length},Qs.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Qs),Ks=(Gs.prototype.copy=function(t,e,n,r,i){return new Gs(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Gs.prototype.isEmpty=function(){return!1},Gs.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},Gs.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},Gs.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},Gs.prototype.minKey=function(){return this.min().key},Gs.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Gs.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},Gs.prototype.removeMin=function(){if(this.left.isEmpty())return Gs.EMPTY;var t=this;return(t=(t=t.left.isRed()||t.left.left.isRed()?t:t.moveRedLeft()).copy(null,null,null,t.left.removeMin(),null)).fixUp()},Gs.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r=(r=r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()?r:r.moveRedLeft()).copy(null,null,null,r.left.remove(t,e),null);else{if(0===e(t,(r=(r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed()?r:r.moveRedRight()).key)){if(r.right.isEmpty())return Gs.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},Gs.prototype.isRed=function(){return this.color},Gs.prototype.fixUp=function(){var t=this;return(t=(t=t.right.isRed()&&!t.left.isRed()?t.rotateLeft():t).left.isRed()&&t.left.left.isRed()?t.rotateRight():t).left.isRed()&&t.right.isRed()?t.colorFlip():t},Gs.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()?(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip():t},Gs.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()?(t=t.rotateRight()).colorFlip():t},Gs.prototype.rotateLeft=function(){var t=this.copy(null,null,Gs.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Gs.prototype.rotateRight=function(){var t=this.copy(null,null,Gs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Gs.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Gs.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},Gs.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Xr();if(this.right.isRed())throw Xr();var t=this.left.check();if(t!==this.right.check())throw Xr();return t+(this.isRed()?0:1)},Gs);function Gs(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Gs.RED,this.left=null!=r?r:Gs.EMPTY,this.right=null!=i?i:Gs.EMPTY,this.size=this.left.size+1+this.right.size}function Qs(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}function Hs(t,e){this.comparator=t,this.root=e||Ks.EMPTY}function zs(){this.size=0}Ks.EMPTY=null,Ks.RED=!0,Ks.BLACK=!1,Ks.EMPTY=(Object.defineProperty(zs.prototype,"key",{get:function(){throw Xr()},enumerable:!1,configurable:!0}),Object.defineProperty(zs.prototype,"value",{get:function(){throw Xr()},enumerable:!1,configurable:!0}),Object.defineProperty(zs.prototype,"color",{get:function(){throw Xr()},enumerable:!1,configurable:!0}),Object.defineProperty(zs.prototype,"left",{get:function(){throw Xr()},enumerable:!1,configurable:!0}),Object.defineProperty(zs.prototype,"right",{get:function(){throw Xr()},enumerable:!1,configurable:!0}),zs.prototype.copy=function(t,e,n,r,i){return this},zs.prototype.insert=function(t,e,n){return new Ks(t,e)},zs.prototype.remove=function(t,e){return this},zs.prototype.isEmpty=function(){return!0},zs.prototype.inorderTraversal=function(t){return!1},zs.prototype.reverseTraversal=function(t){return!1},zs.prototype.minKey=function(){return null},zs.prototype.maxKey=function(){return null},zs.prototype.isRed=function(){return!1},zs.prototype.checkMaxDepth=function(){return!0},zs.prototype.check=function(){return 0},new zs);var Ws=(Js.prototype.has=function(t){return null!==this.data.get(t)},Js.prototype.first=function(){return this.data.minKey()},Js.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Js.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Js.prototype.indexOf=function(t){return this.data.indexOf(t)},Js.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},Js.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},Js.prototype.forEachWhile=function(t,e){for(var n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},Js.prototype.firstAfterOrEqual=function(t){return(t=this.data.getIteratorFrom(t)).hasNext()?t.getNext().key:null},Js.prototype.getIterator=function(){return new Ys(this.data.getIterator())},Js.prototype.getIteratorFrom=function(t){return new Ys(this.data.getIteratorFrom(t))},Js.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},Js.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Js.prototype.isEmpty=function(){return this.data.isEmpty()},Js.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},Js.prototype.isEqual=function(t){if(!(t instanceof Js))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Js.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},Js.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},Js.prototype.copy=function(t){var e=new Js(this.comparator);return e.data=t,e},Js),Ys=($s.prototype.getNext=function(){return this.iter.getNext().key},$s.prototype.hasNext=function(){return this.iter.hasNext()},$s),Xs=new Bs(Ri.comparator);function $s(t){this.iter=t}function Js(t){this.comparator=t,this.data=new Bs(this.comparator)}var Zs=new Bs(Ri.comparator),ta=new Bs(Ri.comparator),ea=new Ws(Ri.comparator);function na(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ea,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var ra=new Ws(ti),ia=(pa.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n=new Map;return n.set(t,oa.createSynthesizedTargetChangeForCurrentChange(t,e)),new pa(ii.min(),n,ra,Xs,na())},pa),oa=(da.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new da(gi.EMPTY_BYTE_STRING,e,na(),na(),na())},da),sa=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},aa=function(t,e){this.targetId=t,this.V=e},ua=function(t,e,n,r){void 0===n&&(n=gi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ca=(Object.defineProperty(fa.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(fa.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(fa.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(fa.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),fa.prototype.O=function(t){0<t.approximateByteSize()&&(this.k=!0,this.C=t)},fa.prototype.M=function(){var t=na(),e=na(),i=na();return this.D.forEach((function(n,r){switch(r){case 0:t=t.add(n);break;case 2:e=e.add(n);break;case 1:i=i.add(n);break;default:Xr()}})),new oa(this.C,this.N,t,e,i)},fa.prototype.L=function(){this.k=!1,this.D=ga()},fa.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},fa.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},fa.prototype.U=function(){this.S+=1},fa.prototype.K=function(){--this.S},fa.prototype.j=function(){this.k=!0,this.N=!0},fa),ha=(la.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},la.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.F||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.F||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Xr()}}))},la.prototype.forEachTarget=function(t,e){var n=this;0<t.targetIds.length?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},la.prototype.rt=function(t){var e=t.targetId,n=t.V.count;(t=this.ot(e))&&(to(t=t.target)?0===n?(t=new Ri(t.path),this.tt(e,t,Wi.newNoDocument(t,ii.min()))):$r(1===n):this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e)))},la.prototype.ut=function(t){var i=this,e=new Map;this.G.forEach((function(n,r){var o=i.ot(r);o&&(n.current&&to(o.target)&&(o=new Ri(o.target.path),null!==i.H.get(o)||i.at(r,o)||i.tt(r,o,Wi.newNoDocument(o,t))),n.$&&(e.set(r,n.M()),n.L()))}));var s=na();this.J.forEach((function(t,e){var n=!0;e.forEachWhile((function(t){return!(t=i.ot(t))||2===t.purpose||(n=!1)})),n&&(s=s.add(t))}));var n=new ia(t,e,this.Y,this.H,s);return this.H=Xs,this.J=ya(),this.Y=new Ws(ti),n},la.prototype.Z=function(t,e){var n;this.st(t)&&(n=this.at(t,e.key)?2:0,this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t)))},la.prototype.tt=function(t,e,n){var r;this.st(t)&&(r=this.nt(t),this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n)))},la.prototype.removeTarget=function(t){this.G.delete(t)},la.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},la.prototype.U=function(t){this.nt(t).U()},la.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new ca,this.G.set(t,e)),e},la.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Ws(ti),this.J=this.J.insert(t,e)),e},la.prototype.st=function(t){var e=null!==this.ot(t);return e||Hr("WatchChangeAggregator","Detected inactive target",t),e},la.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},la.prototype.it=function(t){var e=this;this.G.set(t,new ca),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},la.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},la);function la(t){this.W=t,this.G=new Map,this.H=Xs,this.J=ya(),this.Y=new Ws(ti)}function fa(){this.S=0,this.D=ga(),this.C=gi.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}function da(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}function pa(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}function ya(){return new Bs(Ri.comparator)}function ga(){return new Bs(Ri.comparator)}var ma={asc:"ASCENDING",desc:"DESCENDING"},va={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},wa=function(t,e){this.databaseId=t,this.I=e};function ba(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ea(t,e){return t.I?e.toBase64():e.toUint8Array()}function Ta(t){return $r(!!t),ii.fromTimestamp((t=Ii(t),new ri(t.seconds,t.nanos)))}function Ia(t,e){return new di(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function _a(t){return $r(Ga(t=di.fromString(t))),t}function Sa(t,e){return Ia(t.databaseId,e.path)}function Aa(t,e){if((e=_a(e)).get(1)!==t.databaseId.projectId)throw new jr(Br.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);if(e.get(3)!==t.databaseId.database)throw new jr(Br.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new Ri(ka(e))}function Da(t,e){return Ia(t.databaseId,e)}function Na(t){return 4===(t=_a(t)).length?di.emptyPath():ka(t)}function Ca(t){return new di(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ka(t){return $r(4<t.length&&"documents"===t.get(4)),t.popFirst(5)}function Ra(t,e,n){return{name:Sa(t,e),fields:n.value.mapValue.fields}}function xa(t,e,n){var r=Aa(t,e.name);return t=Ta(e.updateTime),e=new Hi({mapValue:{fields:e.fields}}),e=Wi.newFoundDocument(r,t,e),n&&e.setHasCommittedMutations(),n?e.setHasCommittedMutations():e}function Oa(t,e){var n,r,i;if(e instanceof _s)n={update:Ra(t,e.key,e.value)};else if(e instanceof Ps)n={delete:Sa(t,e.key)};else if(e instanceof Ss)n={update:Ra(t,e.key,e.data),updateMask:(r=e.fieldMask,i=[],r.fields.forEach((function(t){return i.push(t.canonicalString())})),{fieldPaths:i})};else{if(!(e instanceof Ms))return Xr();n={verify:Sa(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map((function(t){var e=t.transform;if(e instanceof ts)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof es)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof ss)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof hs)return{fieldPath:t.field.canonicalString(),increment:e.A};throw Xr()}))),e.precondition.isNone||(n.currentDocument=void 0!==(e=e.precondition).updateTime?{updateTime:ba(t,e.updateTime.toTimestamp())}:void 0!==e.exists?{exists:e.exists}:Xr()),n}function La(t,e){var n=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?gs.updateTime(Ta(s.updateTime)):void 0!==s.exists?gs.exists(s.exists):gs.none():gs.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n,r=null;return"setToServerValue"in e?($r("REQUEST_TIME"===e.setToServerValue),r=new ts):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],r=new es(n)):"removeAllFromArray"in e?(n=e.removeAllFromArray.values||[],r=new ss(n)):"increment"in e?r=new hs(t,e.increment):Xr(),e=li.fromServerFormat(e.fieldPath),new ys(e,r)}(t,e)})):[];if(e.update){e.update.name;var i=Aa(t,e.update.name),o=new Hi({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=(s=e.updateMask.fieldPaths||[],new yi(s.map((function(t){return li.fromServerFormat(t)}))));return new Ss(i,o,s,n,r)}return new _s(i,o,n,r)}return e.delete?(r=Aa(t,e.delete),new Ps(r,n)):e.verify?(e=Aa(t,e.verify),new Ms(e,n)):Xr()}function Pa(t,e){return{documents:[Da(t,e.path)]}}function Ma(t,e){var n={structuredQuery:{}},r=e.path;return null!==e.collectionGroup?(n.parent=Da(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Da(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),(r=function(t){if(0!==t.length)return 1===(t=t.map((function(t){if("=="===t.op){if(Ki(t.value))return{unaryFilter:{field:qa(t.field),op:"IS_NAN"}};if(ji(t.value))return{unaryFilter:{field:qa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ki(t.value))return{unaryFilter:{field:qa(t.field),op:"IS_NOT_NAN"}};if(ji(t.value))return{unaryFilter:{field:qa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qa(t.field),op:(e=t.op,va[e]),value:t.value}};var e}))).length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(e.filters))&&(n.structuredQuery.where=r),(r=function(t){if(0!==t.length)return t.map((function(t){return{field:qa((t=t).field),direction:(t=t.dir,ma[t])}}))}(e.orderBy))&&(n.structuredQuery.orderBy=r),r=e.limit,null!==(r=t.I||Ni(r)?r:{value:r})&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=Va(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Va(e.endAt)),n}function Fa(t){var e=Na(t.parent),n=t.structuredQuery,i=null;0<(o=n.from?n.from.length:0)&&($r(1===o),(a=n.from[0]).allDescendants?i=a.collectionId:e=e.child(a.collectionId));var r=[];n.where&&(r=function t(e){return e?void 0!==e.unaryFilter?[Ka(e)]:void 0!==e.fieldFilter?[ja(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):Xr():[]}(n.where));var s=[],o=(t=null,null),a=null;return Oo(e,i,s=n.orderBy?n.orderBy.map((function(t){return new Co(Ba((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e})):s,r,t=n.limit?Ni(r="object"==typeof(r=n.limit)?r.value:r)?null:r:t,"F",o=n.startAt?Ua(n.startAt):o,a=n.endAt?Ua(n.endAt):a)}function Va(t){return{before:t.before,values:t.position}}function Ua(t){var e=!!t.before;return t=t.values||[],new Io(t,e)}function qa(t){return{fieldPath:t.canonicalString()}}function Ba(t){return li.fromServerFormat(t.fieldPath)}function ja(t){return no.create(Ba(t.fieldFilter.field),function(){switch(t.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Xr()}}(),t.fieldFilter.value)}function Ka(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ba(t.unaryFilter.field);return no.create(e,"==",{doubleValue:NaN});case"IS_NULL":return e=Ba(t.unaryFilter.field),no.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=Ba(t.unaryFilter.field);return no.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return n=Ba(t.unaryFilter.field),no.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Xr()}}function Ga(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Qa(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Ha(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}(t.get(n),e);return Ha(e)}function Ha(t){return t+""}function za(t){var e=t.length;if($r(2<=e),2===e)return $r(""===t.charAt(0)&&""===t.charAt(1)),di.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Xr(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Xr()}o=s+2}return new di(r)}function Wa(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Ya=function(t,e){this.seconds=t,this.nanoseconds=e};function Xa(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}function $a(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}Wa.store="owner",Wa.key="owner",Xa.store="mutationQueues",Xa.keyPath="userId",$a.store="mutations",$a.keyPath="batchId",$a.userMutationsIndex="userMutationsIndex",$a.userMutationsKeyPath=["userId","batchId"];var Ja=(Za.prefixForUser=function(t){return[t]},Za.prefixForPath=function(t,e){return[t,Qa(e)]},Za.key=function(t,e,n){return[t,Qa(e),n]},Za);function Za(){}function tu(t,e){this.path=t,this.readTime=e}function eu(t,e){this.path=t,this.version=e}Ja.store="documentMutations",Ja.PLACEHOLDER=new Ja;var nu=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};function ru(t){this.byteSize=t}function iu(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}nu.store="remoteDocuments",nu.readTimeIndex="readTimeIndex",nu.readTimeIndexPath="readTime",nu.collectionReadTimeIndex="collectionReadTimeIndex",nu.collectionReadTimeIndexPath=["parentPath","readTime"],ru.store="remoteDocumentGlobal",ru.key="remoteDocumentGlobalKey",iu.store="targets",iu.keyPath="targetId",iu.queryTargetsIndexName="queryTargetsIndex",iu.queryTargetsKeyPath=["canonicalId","targetId"];var ou=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};function su(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function au(t,e){this.collectionId=t,this.parent=e}function uu(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}function cu(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}function hu(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}ou.store="targetDocuments",ou.keyPath=["targetId","path"],ou.documentTargetsIndex="documentTargetsIndex",ou.documentTargetsKeyPath=["path","targetId"],su.key="targetGlobalKey",su.store="targetGlobal",au.store="collectionParents",au.keyPath=["collectionId","parent"],uu.store="clientMetadata",uu.keyPath="clientId",cu.store="bundles",cu.keyPath="bundleId",hu.store="namedQueries",hu.keyPath="name";var lu,fu=s(s([],s(s([],s(s([],s(s([],[Xa.store,$a.store,Ja.store,nu.store,iu.store,Wa.store,su.store,ou.store]),[uu.store])),[ru.store])),[au.store])),[cu.store,hu.store]),du="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",pu=(Su.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},Su.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},L=Su,function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}),yu=(_u.prototype.catch=function(t){return this.next(void 0,t)},_u.prototype.next=function(t,i){var e=this;return this.callbackAttached&&Xr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(t,this.result):new _u((function(n,r){e.nextCallback=function(o){e.wrapSuccess(t,o).next(n,r)},e.catchCallback=function(t){e.wrapFailure(i,t).next(n,r)}}))},_u.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},_u.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof _u?e:_u.resolve(e)}catch(t){return _u.reject(t)}},_u.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction((function(){return t(e)})):_u.resolve(e)},_u.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction((function(){return t(e)})):_u.reject(e)},_u.resolve=function(t){return new _u((function(e,n){e(t)}))},_u.reject=function(t){return new _u((function(e,n){n(t)}))},_u.waitFor=function(t){return new _u((function(e,n){var r=0,i=0,o=!1;t.forEach((function(t){++r,t.next((function(){++i,o&&i===r&&e()}),(function(t){return n(t)}))})),o=!0,i===r&&e()}))},_u.or=function(t){for(var e=_u.resolve(!1),n=0,r=t;n<r.length;n++)!function(t){e=e.next((function(e){return e?_u.resolve(e):t()}))}(r[n]);return e},_u.forEach=function(t,e){var n=this,i=[];return t.forEach((function(t,r){i.push(e.call(n,t,r))})),this.waitFor(i)},_u),gu=(Iu.open=function(t,e,n,r){try{return new Iu(e,t.transaction(r,n))}catch(t){throw new wu(e,t)}},Object.defineProperty(Iu.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),Iu.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Hr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Iu.prototype.store=function(t){return t=this.transaction.objectStore(t),new Du(t)},Iu),mu=(Tu.delete=function(t){return Hr("SimpleDb","Removing database:",t),Cu(window.indexedDB.deleteDatabase(t)).toPromise()},Tu.yt=function(){if("undefined"==typeof indexedDB)return!1;if(Tu.gt())return!0;var t=d(),e=0<(n=Tu._t(t))&&n<10,n=0<(n=Tu.Et(t))&&n<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||e||n)},Tu.gt=function(){var t;return void 0!==e&&"YES"===(null===(t=e.env)||void 0===t?void 0:t.Tt)},Tu.It=function(t,e){return t.store(e)},Tu._t=function(t){return t=(t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i))?t[1].split("_").slice(0,2).join("."):"-1",Number(t)},Tu.Et=function(t){return t=(t=t.match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1",Number(t)},Tu.prototype.At=function(t){return l(this,void 0,void 0,(function(){var e,i=this;return g(this,(function(n){switch(n.label){case 0:return this.db?[3,2]:(Hr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result,e(t)},r.onblocked=function(){n(new wu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(e){"VersionError"===(e=e.target.error).name?n(new jr(Br.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new wu(t,e))},r.onupgradeneeded=function(t){Hr("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.wt.Rt(e,r.transaction,t.oldVersion,i.version).next((function(){Hr("SimpleDb","Database upgrade to version "+i.version+" complete")}))}}))]);case 1:e.db=n.sent(),n.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return i.bt(t)}),this.db)]}}))}))},Tu.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},Tu.prototype.runTransaction=function(a,t,u,e){return l(this,void 0,void 0,(function(){var i,n,s,r;return g(this,(function(o){switch(o.label){case 0:i="readonly"===t,n=0,r=function(){var t,r,o;return g(this,(function(c){switch(c.label){case 0:++n,c.label=1;case 1:return c.trys.push([1,4,,5]),[4,s.At(a)];case 2:return s.db=c.sent(),t=gu.open(s.db,a,i?"readonly":"readwrite",u),r=e(t).catch((function(e){return t.abort(e),yu.reject(e)})).toPromise(),o={},r.catch((function(){})),[4,t.dt];case 3:return[2,(o.value=(c.sent(),r),o)];case 4:return r=c.sent(),o="FirebaseError"!==r.name&&n<3,Hr("SimpleDb","Transaction failed with error:",r.message,"Retrying:",o),s.close(),o?[3,5]:[2,{value:Promise.reject(r)}];case 5:return[2]}}))},s=this,o.label=1;case 1:return[5,r()];case 2:if("object"==typeof(r=o.sent()))return[2,r.value];o.label=3;case 3:return[3,1];case 4:return[2]}}))}))},Tu.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},Tu),vu=(Object.defineProperty(Eu.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(Eu.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(Eu.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),Eu.prototype.done=function(){this.Vt=!0},Eu.prototype.Ct=function(t){this.St=t},Eu.prototype.delete=function(){return Cu(this.Pt.delete())},Eu),wu=(h(bu,lu=jr),bu);function bu(t,e){var n=this;return(n=lu.call(this,Br.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function Eu(t){this.Pt=t,this.Vt=!1,this.St=null}function Tu(t,e,n){this.name=t,this.version=e,this.wt=n,12.2===Tu._t(d())&&zr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Iu(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new pu,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new wu(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){e=Ru(e.target.error),n.ft.reject(new wu(t,e))}}function _u(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}function Su(){this.onCommittedListeners=[]}function Au(t){return"IndexedDbTransactionError"===t.name}var Du=(Nu.prototype.put=function(t,e){return Cu(t=void 0!==e?(Hr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Hr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Nu.prototype.add=function(t){return Hr("SimpleDb","ADD",this.store.name,t,t),Cu(this.store.add(t))},Nu.prototype.get=function(t){var e=this;return Cu(this.store.get(t)).next((function(n){return Hr("SimpleDb","GET",e.store.name,t,n=void 0===n?null:n),n}))},Nu.prototype.delete=function(t){return Hr("SimpleDb","DELETE",this.store.name,t),Cu(this.store.delete(t))},Nu.prototype.count=function(){return Hr("SimpleDb","COUNT",this.store.name),Cu(this.store.count())},Nu.prototype.Nt=function(t,e){e=this.cursor(this.options(t,e));var n=[];return this.xt(e,(function(t,e){n.push(e)})).next((function(){return n}))},Nu.prototype.kt=function(t,e){return Hr("SimpleDb","DELETE ALL",this.store.name),(e=this.options(t,e)).Ft=!1,e=this.cursor(e),this.xt(e,(function(t,e,n){return n.delete()}))},Nu.prototype.$t=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.xt(n,e)},Nu.prototype.Ot=function(t){var e=this.cursor({});return new yu((function(n,r){e.onerror=function(t){t=Ru(t.target.error),r(t)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},Nu.prototype.xt=function(t,i){var e=[];return new yu((function(n,r){t.onerror=function(t){r(t.target.error)},t.onsuccess=function(t){var r,o=t.target.result;o?(r=new vu(o),(t=i(o.primaryKey,o.value,r))instanceof yu&&(t=t.catch((function(t){return r.done(),yu.reject(t)})),e.push(t)),r.isDone?n():null===r.Dt?o.continue():o.continue(r.Dt)):n()}})).next((function(){return yu.waitFor(e)}))},Nu.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Nu.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Nu);function Nu(t){this.store=t}function Cu(t){return new yu((function(e,n){t.onsuccess=function(t){t=t.target.result,e(t)},t.onerror=function(t){t=Ru(t.target.error),n(t)}}))}var ku=!1;function Ru(t){var e=mu._t(d());if(12.2<=e&&e<13&&(e="An internal error was encountered in the Indexed Database server",0<=t.message.indexOf(e))){var n=new jr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return ku||(ku=!0,setTimeout((function(){throw n}),0)),n}return t}var xu,Ou=(h(Lu,xu=L),Lu);function Lu(t,e){var n=this;return(n=xu.call(this)||this).Mt=t,n.currentSequenceNumber=e,n}function Pu(t,e){return mu.It(t.Mt,e)}var Mu=(ju.prototype.applyToRemoteDocument=function(t,e){for(var n,r,i,o,s,a,u=e.mutationResults,c=0;c<this.mutations.length;c++){var h=this.mutations[c];h.key.isEqual(t.key)&&(n=h,r=t,i=u[c],h=a=s=o=void 0,n instanceof _s?(s=r,a=i,h=(o=n).value.clone(),o=Cs(o.fieldTransforms,s,a.transformResults),h.setAll(o),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()):n instanceof Ss?(o=r,s=i,vs((a=n).precondition,o)?(h=Cs(a.fieldTransforms,o,s.transformResults),(n=o.data).setAll(Ns(a)),n.setAll(h),o.convertToFoundDocument(s.version,n).setHasCommittedMutations()):o.convertToUnknownDocument(s.version)):r.convertToNoDocument(i.version).setHasCommittedMutations())}},ju.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(r=n[e]).key.isEqual(t.key)&&ws(r,t,this.localWriteTime);for(var r,i=0,o=this.mutations;i<o.length;i++)(r=o[i]).key.isEqual(t.key)&&ws(r,t,this.localWriteTime)},ju.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key);n=r,e.applyToLocalView(n),r.isValidDocument()||n.convertToNoDocument(ii.min())}))},ju.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),na())},ju.prototype.isEqual=function(t){return this.batchId===t.batchId&&ei(this.mutations,t.mutations,bs)&&ei(this.baseMutations,t.baseMutations,bs)},ju),Fu=(Bu.from=function(t,e,n){$r(t.mutations.length===n.length);for(var r=ta,i=t.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Bu(t,e,n,r)},Bu),Vu=(qu.prototype.withSequenceNumber=function(t){return new qu(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},qu.prototype.withResumeToken=function(t,e){return new qu(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},qu.prototype.withLastLimboFreeSnapshotVersion=function(t){return new qu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},qu),Uu=function(t){this.Lt=t};function qu(t,e,n,r,i,o,s){void 0===i&&(i=ii.min()),void 0===o&&(o=ii.min()),void 0===s&&(s=gi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Bu(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}function ju(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}function Ku(t,e){if(e.document)return xa(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Ri.fromSegments(e.noDocument.path),r=Wu(e.noDocument.readTime);return n=Wi.newNoDocument(n,r),e.hasCommittedMutations?n.setHasCommittedMutations():n}return e.unknownDocument?(n=Ri.fromSegments(e.unknownDocument.path),r=Wu(e.unknownDocument.version),Wi.newUnknownDocument(n,r)):Xr()}function Gu(t,e,n){var r=Qu(n);if(n=e.key.path.popLast().toArray(),e.isFoundDocument()){var i={name:Sa(o=t.Lt,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:ba(o,s.version.toTimestamp())},o=e.hasCommittedMutations;return new nu(null,null,i,o,r,n)}if(e.isNoDocument()){var s=e.key.path.toArray();return i=zu(e.version),o=e.hasCommittedMutations,new nu(null,new tu(s,i),null,o,r,n)}return e.isUnknownDocument()?(o=e.key.path.toArray(),e=zu(e.version),new nu(new eu(o,e),null,null,!0,r,n)):Xr()}function Qu(t){return[(t=t.toTimestamp()).seconds,t.nanoseconds]}function Hu(t){return t=new ri(t[0],t[1]),ii.fromTimestamp(t)}function zu(t){return t=t.toTimestamp(),new Ya(t.seconds,t.nanoseconds)}function Wu(t){return t=new ri(t.seconds,t.nanoseconds),ii.fromTimestamp(t)}function Yu(t,e){for(var n=(e.baseMutations||[]).map((function(e){return La(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i,o=e.mutations[r];r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(i=e.mutations[r+1],o.updateTransforms=i.transform.fieldTransforms,e.mutations.splice(r+1,1),++r)}var s=e.mutations.map((function(e){return La(t.Lt,e)})),a=ri.fromMillis(e.localWriteTimeMs);return new Mu(e.batchId,a,n,s)}function Xu(t){var e=Wu(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Wu(t.lastLimboFreeSnapshotVersion):ii.min(),r=void 0!==t.query.documents?($r(1===(r=t.query).documents.length),Bo(Lo(Na(r.documents[0])))):Bo(Fa(t.query));return new Vu(r,t.targetId,0,t.lastListenSequenceNumber,e,n,gi.fromBase64String(t.resumeToken))}function $u(t,e){var n=zu(e.snapshotVersion),r=zu(e.lastLimboFreeSnapshotVersion),i=(to(e.target)?Pa:Ma)(t.Lt,e.target);return t=e.resumeToken.toBase64(),new iu(e.targetId,Ji(e.target),n,t,e.sequenceNumber,r,i)}function Ju(t){var e=Fa({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?jo(e,e.limit,"L"):e}var Zu=(tc.prototype.getBundleMetadata=function(t,e){return ec(t).get(e).next((function(t){if(t)return{id:(t=t).bundleId,createTime:Wu(t.createTime),version:t.version}}))},tc.prototype.saveBundleMetadata=function(t,e){return ec(t).put({bundleId:(e=e).id,createTime:zu(Ta(e.createTime)),version:e.version})},tc.prototype.getNamedQuery=function(t,e){return nc(t).get(e).next((function(t){if(t)return{name:(t=t).name,query:Ju(t.bundledQuery),readTime:Wu(t.readTime)}}))},tc.prototype.saveNamedQuery=function(t,e){return nc(t).put({name:(e=e).name,readTime:zu(Ta(e.readTime)),bundledQuery:e.bundledQuery})},tc);function tc(){}function ec(t){return Pu(t,cu.store)}function nc(t){return Pu(t,hu.store)}var rc=(uc.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),yu.resolve()},uc.prototype.getCollectionParents=function(t,e){return yu.resolve(this.Bt.getEntries(e))},uc),ic=(ac.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ws(di.comparator);return t=!r.has(n),this.index[e]=r.add(n),t},ac.prototype.has=function(t){var e=t.lastSegment();return t=t.popLast(),(e=this.index[e])&&e.has(t)},ac.prototype.getEntries=function(t){return(this.index[t]||new Ws(di.comparator)).toArray()},ac),oc=(sc.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(this.qt.has(e))return yu.resolve();var r=e.lastSegment(),i=e.popLast();return t.addOnCommittedListener((function(){n.qt.add(e)})),i={collectionId:r,parent:Qa(i)},cc(t).put(i)},sc.prototype.getCollectionParents=function(t,i){var e=[],n=IDBKeyRange.bound([i,""],[ni(i),""],!1,!0);return cc(t).Nt(n).next((function(t){for(var n=0,r=t;n<r.length;n++){var o=r[n];if(o.collectionId!==i)break;e.push(za(o.parent))}return e}))},sc);function sc(){this.qt=new ic}function ac(){this.index={}}function uc(){this.Bt=new ic}function cc(t){return Pu(t,au.store)}var hc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},lc=(fc.withCacheSize=function(t){return new fc(t,fc.DEFAULT_COLLECTION_PERCENTILE,fc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},fc);function fc(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}function dc(t,e,n){var r=t.store($a.store),i=t.store(Ja.store),o=[],s=(t=IDBKeyRange.only(n.batchId),0);t=r.$t({range:t},(function(t,e,n){return s++,n.delete()})),o.push(t.next((function(){$r(1===s)})));for(var a=[],u=0,c=n.mutations;u<c.length;u++){var h=c[u],l=Ja.key(e,h.key.path,n.batchId);o.push(i.delete(l)),a.push(h.key)}return yu.waitFor(o).next((function(){return a}))}function pc(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Xr();e=t.noDocument}return JSON.stringify(e).length}lc.DEFAULT_COLLECTION_PERCENTILE=10,lc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lc.DEFAULT=new lc(41943040,lc.DEFAULT_COLLECTION_PERCENTILE,lc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lc.DISABLED=new lc(-1,0,0);var yc=(gc.Qt=function(t,e,n,r){return $r(""!==t.uid),new gc(t.isAuthenticated()?t.uid:"",e,n,r)},gc.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return vc(t).$t({index:$a.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},gc.prototype.addMutationBatch=function(p,t,g,e){var n=this,r=wc(p),b=vc(p);return b.add({}).next((function(o){$r("number"==typeof o);for(var c,h,l,i,f,s=new Mu(o,t,g,e),a=(c=n.R,h=n.userId,i=(l=s).baseMutations.map((function(t){return Oa(c.Lt,t)})),f=l.mutations.map((function(t){return Oa(c.Lt,t)})),new $a(h,l.batchId,l.localWriteTime.toMillis(),i,f)),u=[],d=new Ws((function(t,e){return ti(t.canonicalString(),e.canonicalString())})),y=0,m=e;y<m.length;y++){var v=m[y],w=Ja.key(n.userId,v.key.path,o);d=d.add(v.key.path.popLast()),u.push(b.put(a)),u.push(r.put(w,Ja.PLACEHOLDER))}return d.forEach((function(t){u.push(n.Ut.addToCollectionParentIndex(p,t))})),p.addOnCommittedListener((function(){n.Kt[o]=s.keys()})),yu.waitFor(u).next((function(){return s}))}))},gc.prototype.lookupMutationBatch=function(t,e){var n=this;return vc(t).get(e).next((function(t){return t?($r(t.userId===n.userId),Yu(n.R,t)):null}))},gc.prototype.jt=function(t,e){var n=this;return this.Kt[e]?yu.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next((function(t){return t?(t=t.keys(),n.Kt[e]=t):null}))},gc.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,i=e+1,r=(e=IDBKeyRange.lowerBound([this.userId,i]),null);return vc(t).$t({index:$a.userMutationsIndex,range:e},(function(t,e,o){e.userId===n.userId&&($r(e.batchId>=i),r=Yu(n.R,e)),o.done()})).next((function(){return r}))},gc.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return vc(t).$t({index:$a.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},gc.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return vc(t).Nt($a.userMutationsIndex,n).next((function(t){return t.map((function(t){return Yu(e.R,t)}))}))},gc.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,s){var a=this,e=Ja.prefixForPath(this.userId,s.path),u=(e=IDBKeyRange.lowerBound(e),[]);return wc(t).$t({range:e},(function(e,n,r){var o=e[0],i=e[1];if(e=e[2],i=za(i),o===a.userId&&s.path.isEqual(i))return vc(t).get(e).next((function(t){if(!t)throw Xr();$r(t.userId===a.userId),u.push(Yu(a.R,t))}));r.done()})).next((function(){return u}))},gc.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var s=this,a=new Ws(ti),n=[];return e.forEach((function(e){var r=Ja.prefixForPath(s.userId,e.path);r=IDBKeyRange.lowerBound(r),r=wc(t).$t({range:r},(function(t,n,r){var o=t[0],i=t[1];t=t[2],i=za(i),o===s.userId&&e.path.isEqual(i)?a=a.add(t):r.done()})),n.push(r)})),yu.waitFor(n).next((function(){return s.Wt(t,a)}))},gc.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,s=e.path,a=s.length+1,u=(e=Ja.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),new Ws(ti));return wc(t).$t({range:e},(function(t,e,r){var o=t[0],i=t[1];t=t[2],i=za(i),o===n.userId&&s.isPrefixOf(i)?i.length===a&&(u=u.add(t)):r.done()})).next((function(){return n.Wt(t,u)}))},gc.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(vc(t).get(e).next((function(t){if(null===t)throw Xr();$r(t.userId===n.userId),r.push(Yu(n.R,t))})))})),yu.waitFor(i).next((function(){return r}))},gc.prototype.removeMutationBatch=function(t,e){var n=this;return dc(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),yu.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},gc.prototype.Gt=function(t){delete this.Kt[t]},gc.prototype.performConsistencyCheck=function(t){var i=this;return this.checkEmpty(t).next((function(e){if(!e)return yu.resolve();e=IDBKeyRange.lowerBound(Ja.prefixForUser(i.userId));var n=[];return wc(t).$t({range:e},(function(t,e,r){t[0]===i.userId?(t=za(t[1]),n.push(t)):r.done()})).next((function(){$r(0===n.length)}))}))},gc.prototype.containsKey=function(t,e){return mc(t,this.userId,e)},gc.prototype.zt=function(t){var e=this;return bc(t).get(this.userId).next((function(t){return t||new Xa(e.userId,-1,"")}))},gc);function gc(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}function mc(t,e,n){var s=(n=Ja.prefixForPath(e,n.path))[1],a=(n=IDBKeyRange.lowerBound(n),!1);return wc(t).$t({range:n,Ft:!0},(function(t,n,r){var o=t[0],i=t[1];t[2],o===e&&i===s&&(a=!0),r.done()})).next((function(){return a}))}function vc(t){return Pu(t,$a.store)}function wc(t){return Pu(t,Ja.store)}function bc(t){return Pu(t,Xa.store)}var Ec=(_c.prototype.next=function(){return this.Ht+=2,this.Ht},_c.Jt=function(){return new _c(0)},_c.Yt=function(){return new _c(-1)},_c),Tc=(Ic.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new Ec(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},Ic.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return ii.fromTimestamp(new ri(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},Ic.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},Ic.prototype.setTargetsMetadata=function(t,e,n){var i=this;return this.Xt(t).next((function(r){return r.highestListenSequenceNumber=e,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),i.Zt(t,r)}))},Ic.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},Ic.prototype.updateTargetData=function(t,e){return this.te(t,e)},Ic.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return Sc(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return $r(0<e.targetCount),--e.targetCount,n.Zt(t,e)}))},Ic.prototype.removeTargets=function(t,e,i){var n=this,s=0,a=[];return Sc(t).$t((function(r,o){(o=Xu(o)).sequenceNumber<=e&&null===i.get(o.targetId)&&(s++,a.push(n.removeTargetData(t,o)))})).next((function(){return yu.waitFor(a)})).next((function(){return s}))},Ic.prototype.forEachTarget=function(t,e){return Sc(t).$t((function(t,n){n=Xu(n),e(n)}))},Ic.prototype.Xt=function(t){return Ac(t).get(su.key).next((function(t){return $r(null!==t),t}))},Ic.prototype.Zt=function(t,e){return Ac(t).put(su.key,e)},Ic.prototype.te=function(t,e){return Sc(t).put($u(this.R,e))},Ic.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Ic.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},Ic.prototype.getTargetData=function(t,e){var n=Ji(e),i=(n=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),null);return Sc(t).$t({range:n,index:iu.queryTargetsIndexName},(function(t,n,r){n=Xu(n),Zi(e,n.target)&&(i=n,r.done())})).next((function(){return i}))},Ic.prototype.addMatchingKeys=function(t,e,n){var i=this,r=[],s=Dc(t);return e.forEach((function(e){var o=Qa(e.path);r.push(s.put(new ou(n,o))),r.push(i.referenceDelegate.addReference(t,n,e))})),yu.waitFor(r)},Ic.prototype.removeMatchingKeys=function(t,e,n){var i=this,r=Dc(t);return yu.forEach(e,(function(e){var o=Qa(e.path);return yu.waitFor([r.delete([n,o]),i.referenceDelegate.removeReference(t,n,e)])}))},Ic.prototype.removeMatchingKeysForTargetId=function(t,e){return t=Dc(t),e=IDBKeyRange.bound([e],[e+1],!1,!0),t.delete(e)},Ic.prototype.getMatchingKeysForTargetId=function(t,e){e=IDBKeyRange.bound([e],[e+1],!1,!0),t=Dc(t);var n=na();return t.$t({range:e,Ft:!0},(function(t,e,r){t=za(t[1]),t=new Ri(t),n=n.add(t)})).next((function(){return n}))},Ic.prototype.containsKey=function(t,e){e=Qa(e.path),e=IDBKeyRange.bound([e],[ni(e)],!1,!0);var i=0;return Dc(t).$t({index:ou.documentTargetsIndex,Ft:!0,range:e},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return 0<i}))},Ic.prototype.lt=function(t,e){return Sc(t).get(e).next((function(t){return t?Xu(t):null}))},Ic);function Ic(t,e){this.referenceDelegate=t,this.R=e}function _c(t){this.Ht=t}function Sc(t){return Pu(t,iu.store)}function Ac(t){return Pu(t,su.store)}function Dc(t){return Pu(t,ou.store)}function Nc(t){return l(this,void 0,void 0,(function(){return g(this,(function(e){if(t.code!==Br.FAILED_PRECONDITION||t.message!==du)throw t;return Hr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function Cc(t,e){var n=t[0],r=t[1];return t=e[0],e=e[1],0===(t=ti(n,t))?ti(r,e):t}var kc=(Fc.prototype.ie=function(){return++this.se},Fc.prototype.re=function(t){var e=[t,this.ie()];this.buffer.size<this.ne?this.buffer=this.buffer.add(e):Cc(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(Fc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Fc),Rc=(Mc.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},Mc.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(Mc.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),Mc.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Hr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return l(e,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Au(e=n.sent())?(Hr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Nc(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},Mc),xc=(Pc.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},Pc.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return yu.resolve(Vr.o);var r=new kc(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},Pc.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},Pc.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},Pc.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Hr("LruGarbageCollector","Garbage collection skipped; disabled"),yu.resolve(hc)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(Hr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),hc):n.fe(t,e)}))},Pc.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},Pc.prototype.fe=function(t,e){var n,i,r,s,a,u,o,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return i=e>c.params.maximumSequenceNumbersToCollect?(Hr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),c.params.maximumSequenceNumbersToCollect):e,s=Date.now(),c.nthSequenceNumber(t,i)})).next((function(r){return n=r,a=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return r=e,u=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return o=Date.now(),Qr()<=I.DEBUG&&Hr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-h)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+r+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(o-u)+"ms\nTotal Duration: "+(o-h)+"ms"),yu.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:t})}))},Pc),Oc=(Lc.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},Lc.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},Lc.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},Lc.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},Lc.prototype.addReference=function(t,e,n){return Vc(t,n)},Lc.prototype.removeReference=function(t,e,n){return Vc(t,n)},Lc.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},Lc.prototype.markPotentiallyOrphaned=Vc,Lc.prototype._e=function(t,e){return r=e,i=!1,bc(n=t).Ot((function(t){return mc(n,t,r).next((function(t){return t&&(i=!0),yu.resolve(!t)}))})).next((function(){return i}));var n,r,i},Lc.prototype.removeOrphanedDocuments=function(t,e){var i=this,n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],a=0;return this.we(t,(function(r,o){o<=e&&(o=i._e(t,r).next((function(e){if(!e)return a++,n.getEntry(t,r).next((function(){return n.removeEntry(r),Dc(t).delete([0,Qa(r.path)])}))})),s.push(o))})).next((function(){return yu.waitFor(s)})).next((function(){return n.apply(t)})).next((function(){return a}))},Lc.prototype.removeTarget=function(t,e){return e=e.withSequenceNumber(t.currentSequenceNumber),this.db.getTargetCache().updateTargetData(t,e)},Lc.prototype.updateLimboDocument=Vc,Lc.prototype.we=function(t,e){t=Dc(t);var i,n=Vr.o;return t.$t({index:ou.documentTargetsIndex},(function(t,r){var o=t[0];t[1],t=r.path,r=r.sequenceNumber,0===o?(n!==Vr.o&&e(new Ri(za(i)),n),n=r,i=t):n=Vr.o})).next((function(){n!==Vr.o&&e(new Ri(za(i)),n)}))},Lc.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},Lc);function Lc(t,e){this.db=t,this.garbageCollector=new xc(this,e)}function Pc(t,e){this.ae=t,this.params=e}function Mc(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}function Fc(t){this.ne=t,this.buffer=new Ws(Cc),this.se=0}function Vc(t,e){return Dc(t).put((t=t.currentSequenceNumber,new ou(0,Qa(e.path),t)))}var Uc,qc=(Hc.prototype.get=function(t){var e=this.mapKeyFn(t);if(void 0!==(e=this.inner[e]))for(var n=0,r=e;n<r.length;n++){var o=(i=r[n])[0],i=i[1];if(this.equalsFn(o,t))return i}},Hc.prototype.has=function(t){return void 0!==this.get(t)},Hc.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},Hc.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},Hc.prototype.forEach=function(s){ui(this.inner,(function(t,e){for(var n=0,r=e;n<r.length;n++){var o=(i=r[n])[0],i=i[1];s(o,i)}}))},Hc.prototype.isEmpty=function(){return ci(this.inner)},Hc),Bc=(Qc.prototype.getReadTime=function(t){return(t=this.changes.get(t))?t.readTime:ii.min()},Qc.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},Qc.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Wi.newInvalidDocument(t),readTime:e})},Qc.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?yu.resolve(n.document):this.getFromCache(t,e)},Qc.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},Qc.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},Qc.prototype.assertNotApplied=function(){},C=Qc,Gc.prototype.addEntry=function(t,e,n){return Wc(t).put(Yc(e),n)},Gc.prototype.removeEntry=function(t,e){return t=Wc(t),e=Yc(e),t.delete(e)},Gc.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},Gc.prototype.getEntry=function(t,e){var n=this;return Wc(t).get(Yc(e)).next((function(t){return n.ye(e,t)}))},Gc.prototype.ge=function(t,e){var n=this;return Wc(t).get(Yc(e)).next((function(t){return{document:n.ye(e,t),size:pc(t)}}))},Gc.prototype.getEntries=function(t,e){var n=this,r=Xs;return this.pe(t,e,(function(t,e){e=n.ye(t,e),r=r.insert(t,e)})).next((function(){return r}))},Gc.prototype.Ee=function(t,e){var n=this,i=Xs,r=new Bs(Ri.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);i=i.insert(t,o),r=r.insert(t,pc(e))})).next((function(){return{documents:i,Te:r}}))},Gc.prototype.pe=function(t,e,i){if(e.isEmpty())return yu.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),r=e.getIterator(),s=r.getNext();return Wc(t).$t({range:n},(function(t,e,n){for(var o=Ri.fromSegments(t);s&&Ri.comparator(s,o)<0;)i(s,null),s=r.getNext();s&&s.isEqual(o)&&(i(s,e),s=r.hasNext()?r.getNext():null),s?n.Ct(s.path.toArray()):n.done()})).next((function(){for(;s;)i(s,null),s=r.hasNext()?r.getNext():null}))},Gc.prototype.getDocumentsMatchingQuery=function(t,e,n){var r,i=this,o=Xs,s=e.path.length+1,a={};return n.isEqual(ii.min())?(r=e.path.toArray(),a.range=IDBKeyRange.lowerBound(r)):(r=e.path.toArray(),n=Qu(n),a.range=IDBKeyRange.lowerBound([r,n],!0),a.index=nu.collectionReadTimeIndex),Wc(t).$t(a,(function(t,n,r){t.length===s&&(n=Ku(i.R,n),e.path.isPrefixOf(n.key.path)?Ho(e,n)&&(o=o.insert(n.key,n)):r.done())})).next((function(){return o}))},Gc.prototype.newChangeBuffer=function(t){return new jc(this,!!t&&t.trackRemovals)},Gc.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},Gc.prototype.getMetadata=function(t){return zc(t).get(ru.key).next((function(t){return $r(!!t),t}))},Gc.prototype.me=function(t,e){return zc(t).put(ru.key,e)},Gc.prototype.ye=function(t,e){return!e||(e=Ku(this.R,e)).isNoDocument()&&e.version.isEqual(ii.min())?Wi.newInvalidDocument(t):e},Gc),jc=(h(Kc,Uc=C),Kc.prototype.applyChanges=function(i){var t=this,s=[],a=0,u=new Ws((function(t,e){return ti(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(e,n){var r,o=t.Ae.get(e);n.document.isValidDocument()?(r=Gu(t.Ie.R,n.document,t.getReadTime(e)),u=u.add(e.path.popLast()),n=pc(r),a+=n-o,s.push(t.Ie.addEntry(i,e,r))):(a-=o,t.trackRemovals?(o=Gu(t.Ie.R,Wi.newNoDocument(e,ii.min()),t.getReadTime(e)),s.push(t.Ie.addEntry(i,e,o))):s.push(t.Ie.removeEntry(i,e)))})),u.forEach((function(e){s.push(t.Ie.Ut.addToCollectionParentIndex(i,e))})),s.push(this.Ie.updateMetadata(i,a)),yu.waitFor(s)},Kc.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},Kc.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},Kc);function Kc(t,e){var n=this;return(n=Uc.call(this)||this).Ie=t,n.trackRemovals=e,n.Ae=new qc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),n}function Gc(t,e){this.R=t,this.Ut=e}function Qc(){this.changes=new qc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}function Hc(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}function zc(t){return Pu(t,ru.store)}function Wc(t){return Pu(t,nu.store)}function Yc(t){return t.path.toArray()}var Xc=($c.prototype.Rt=function(t,e,n,r){var i=this;$r(n<r&&0<=n&&r<=11);var o=new gu("createOrUpgrade",e);n<1&&1<=r&&(t.createObjectStore(Wa.store),(s=t).createObjectStore(Xa.store,{keyPath:Xa.keyPath}),s.createObjectStore($a.store,{keyPath:$a.keyPath,autoIncrement:!0}).createIndex($a.userMutationsIndex,$a.userMutationsKeyPath,{unique:!0}),s.createObjectStore(Ja.store),Jc(t),t.createObjectStore(nu.store));var s,a=yu.resolve();return n<3&&3<=r&&(0!==n&&((s=t).deleteObjectStore(ou.store),s.deleteObjectStore(iu.store),s.deleteObjectStore(su.store),Jc(t)),a=a.next((function(){return t=o.store(su.store),e=new su(0,0,ii.min().toTimestamp(),0),t.put(su.key,e);var t,e}))),n<4&&4<=r&&(a=(a=0!==n?a.next((function(){return e=t,(n=o).store($a.store).Nt().next((function(t){e.deleteObjectStore($a.store),e.createObjectStore($a.store,{keyPath:$a.keyPath,autoIncrement:!0}).createIndex($a.userMutationsIndex,$a.userMutationsKeyPath,{unique:!0});var r=n.store($a.store);return t=t.map((function(t){return r.put(t)})),yu.waitFor(t)}));var e,n})):a).next((function(){t.createObjectStore(uu.store,{keyPath:uu.keyPath})}))),n<5&&5<=r&&(a=a.next((function(){return i.Re(o)}))),n<6&&6<=r&&(a=a.next((function(){return t.createObjectStore(ru.store),i.be(o)}))),n<7&&7<=r&&(a=a.next((function(){return i.ve(o)}))),n<8&&8<=r&&(a=a.next((function(){return i.Pe(t,o)}))),n<9&&9<=r&&(a=a.next((function(){var n;(n=t).objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges"),(n=e.objectStore(nu.store)).createIndex(nu.readTimeIndex,nu.readTimeIndexPath,{unique:!1}),n.createIndex(nu.collectionReadTimeIndex,nu.collectionReadTimeIndexPath,{unique:!1})}))),n<10&&10<=r&&(a=a.next((function(){return i.Ve(o)}))),n<11&&11<=r?a.next((function(){t.createObjectStore(cu.store,{keyPath:cu.keyPath}),t.createObjectStore(hu.store,{keyPath:hu.keyPath})})):a},$c.prototype.be=function(t){var e=0;return t.store(nu.store).$t((function(t,n){e+=pc(n)})).next((function(){var n=new ru(e);return t.store(ru.store).put(ru.key,n)}))},$c.prototype.Re=function(t){var e=this,n=t.store(Xa.store),i=t.store($a.store);return n.Nt().next((function(n){return yu.forEach(n,(function(n){var r=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return i.Nt($a.userMutationsIndex,r).next((function(r){return yu.forEach(r,(function(r){return $r(r.userId===n.userId),r=Yu(e.R,r),dc(t,n.userId,r).next((function(){}))}))}))}))}))},$c.prototype.ve=function(t){var e=t.store(ou.store),n=t.store(nu.store);return t.store(su.store).get(su.key).next((function(t){var i=[];return n.$t((function(n,r){var o=new di(n);n=[0,Qa(o)],i.push(e.get(n).next((function(n){return n?yu.resolve():e.put(new ou(0,Qa(o),t.highestListenSequenceNumber))})))})).next((function(){return yu.waitFor(i)}))}))},$c.prototype.Pe=function(t,e){function n(t){if(i.add(t)){var e=t.lastSegment();return t=t.popLast(),r.put({collectionId:e,parent:Qa(t)})}}t.createObjectStore(au.store,{keyPath:au.keyPath});var r=e.store(au.store),i=new ic;return e.store(nu.store).$t({Ft:!0},(function(t,e){return n((t=new di(t)).popLast())})).next((function(){return e.store(Ja.store).$t({Ft:!0},(function(t,e){t[0];var r=t[1];return t[2],n((r=za(r)).popLast())}))}))},$c.prototype.Ve=function(t){var e=this,n=t.store(iu.store);return n.$t((function(t,r){return r=Xu(r),r=$u(e.R,r),n.put(r)}))},$c);function $c(t){this.R=t}function Jc(t){t.createObjectStore(ou.store,{keyPath:ou.keyPath}).createIndex(ou.documentTargetsIndex,ou.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(iu.store,{keyPath:iu.keyPath}).createIndex(iu.queryTargetsIndexName,iu.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(su.store)}var Zc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",eh=(nh.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new jr(Br.FAILED_PRECONDITION,Zc);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new Vr(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},nh.prototype.He=function(t){var e=this;return this.Me=function(n){return l(e,void 0,void 0,(function(){return g(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},nh.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return l(e,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},nh.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return l(e,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},nh.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return th(e).put(new uu(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(Au(e))return Hr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Hr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},nh.prototype.Je=function(t){var e=this;return rh(t).get(Wa.key).next((function(t){return yu.resolve(e.tn(t))}))},nh.prototype.en=function(t){return th(t).delete(this.clientId)},nh.prototype.nn=function(){return l(this,void 0,void 0,(function(){var t,e,n,i,r=this;return g(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Pu(t,uu.store);return e.Nt().next((function(t){var n=r.rn(t,18e5),o=t.filter((function(t){return-1===n.indexOf(t)}));return yu.forEach(o,(function(t){return e.delete(t.clientId)})).next((function(){return o}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)i=n[e],this.Qe.removeItem(this.on(i.clientId));o.label=2;case 2:return[2]}}))}))},nh.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},nh.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},nh.prototype.Ye=function(t){var e=this;return this.Ce?yu.resolve(!0):rh(t).get(Wa.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new jr(Br.FAILED_PRECONDITION,Zc);return!1}}return!(!e.networkEnabled||!e.inForeground)||th(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground;if(t=e.networkEnabled===t.networkEnabled,n||r&&t)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&Hr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},nh.prototype.shutdown=function(){return l(this,void 0,void 0,(function(){var t=this;return g(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Wa.store,uu.store],(function(e){var n=new Ou(e,Vr.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},nh.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},nh.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return th(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(nh.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),nh.prototype.getMutationQueue=function(t){return yc.Qt(t,this.R,this.Ut,this.referenceDelegate)},nh.prototype.getTargetCache=function(){return this.qe},nh.prototype.getRemoteDocumentCache=function(){return this.Ue},nh.prototype.getIndexManager=function(){return this.Ut},nh.prototype.getBundleCache=function(){return this.Ke},nh.prototype.runTransaction=function(t,e,n){var i,r=this;return Hr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",fu,(function(o){return i=new Ou(o,r.Ne?r.Ne.next():Vr.o),"readwrite-primary"===e?r.Je(i).next((function(t){return!!t||r.Ye(i)})).next((function(e){if(!e)throw zr("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable((function(){return r.Me(!1)})),new jr(Br.FAILED_PRECONDITION,du);return n(i)})).next((function(t){return r.Ze(i).next((function(){return t}))})):r.dn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},nh.prototype.dn=function(t){var e=this;return rh(t).get(Wa.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new jr(Br.FAILED_PRECONDITION,Zc)}))},nh.prototype.Ze=function(t){var e=new Wa(this.clientId,this.allowTabSynchronization,Date.now());return rh(t).put(Wa.key,e)},nh.yt=function(){return mu.yt()},nh.prototype.Xe=function(t){var e=this,n=rh(t);return n.get(Wa.key).next((function(t){return e.tn(t)?(Hr("IndexedDbPersistence","Releasing primary lease."),n.delete(Wa.key)):yu.resolve()}))},nh.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(zr("Detected an update time that is in the future: "+t+" > "+n),1))},nh.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},nh.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},nh.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),y()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("pagehide",this.ke))},nh.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},nh.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return Hr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return zr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},nh.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){zr("Failed to set zombie client id.",t)}},nh.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},nh.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},nh);function nh(t,e,n,r,i,o,s,a,u,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Se=i,this.window=o,this.document=s,this.De=u,this.Ce=c,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!nh.yt())throw new jr(Br.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Oc(this,r),this.Le=e+"main",this.R=new Uu(a),this.Be=new mu(this.Le,11,new Xc(this.R)),this.qe=new Tc(this.referenceDelegate,this.R),this.Ut=new oc,this.Ue=(e=this.R,a=this.Ut,new Bc(e,a)),this.Ke=new Zu,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===c&&zr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function rh(t){return Pu(t,Wa.store)}function th(t){return Pu(t,uu.store)}function ih(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}function oh(t,e){this.progress=t,this.wn=e}var sh=(dh.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},dh.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},dh.prototype.gn=function(t,i){t.forEach((function(t,e){for(var n=0,r=i;n<r.length;n++)r[n].applyToLocalView(e)}))},dh.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},dh.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},dh.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,Ri.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Tn(t,e.path):Uo(e)?this.In(t,e,n):this.An(t,e,n);var r},dh.prototype.Tn=function(t,e){return this.mn(t,new Ri(e)).next((function(t){var e=Zs;return t.isFoundDocument()?e.insert(t.key,t):e}))},dh.prototype.In=function(t,e,i){var n=this,s=e.collectionGroup,a=Zs;return this.Ut.getCollectionParents(t,s).next((function(r){return yu.forEach(r,(function(r){var o=(o=e,r=r.child(s),new xo(r,null,o.explicitOrderBy.slice(),o.filters.slice(),o.limit,o.limitType,o.startAt,o.endAt));return n.An(t,o,i).next((function(t){t.forEach((function(t,e){a=a.insert(t,e)}))}))})).next((function(){return a}))}))},dh.prototype.An=function(t,e,n){var r,o,c=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,c._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return o=e,c.Rn(t,o,r).next((function(t){r=t;for(var e=0,n=o;e<n.length;e++)for(var c=n[e],i=0,h=c.mutations;i<h.length;i++){var s=h[i],a=s.key,u=r.get(a);null==u&&(u=Wi.newInvalidDocument(a),r=r.insert(a,u)),ws(s,u,c.localWriteTime),u.isFoundDocument()||(r=r.remove(a))}}))})).next((function(){return r.forEach((function(t,n){Ho(e,n)||(r=r.remove(t))})),r}))},dh.prototype.Rn=function(t,e,n){for(var r=na(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Ss&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},dh),ah=(fh.Pn=function(t,e){for(var n=na(),r=na(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new fh(t,e.fromCache,n,r)},fh),uh=(lh.prototype.Vn=function(t){this.Sn=t},lh.prototype.getDocumentsMatchingQuery=function(t,e,i,n){var s=this;return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())||i.isEqual(ii.min())?this.Dn(t,e):this.Sn.pn(t,n).next((function(r){var o=s.Cn(e,r);return(Po(e)||Mo(e))&&s.Nn(e.limitType,o,n,i)?s.Dn(t,e):(Qr()<=I.DEBUG&&Hr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Qo(e)),s.Sn.getDocumentsMatchingQuery(t,e,i).next((function(t){return o.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},lh.prototype.Cn=function(t,e){var n=new Ws(zo(t));return e.forEach((function(e,r){Ho(t,r)&&(n=n.add(r))})),n},lh.prototype.Nn=function(t,e,n,r){return n.size!==e.size||!!(e="F"===t?e.last():e.first())&&(e.hasPendingWrites||0<e.version.compareTo(r))},lh.prototype.Dn=function(t,e){return Qr()<=I.DEBUG&&Hr("QueryEngine","Using full collection scan to execute query:",Qo(e)),this.Sn.getDocumentsMatchingQuery(t,e,ii.min())},lh),ch=(hh.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.kn)}))},hh);function hh(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new Bs(ti),this.Fn=new qc(Ji,Zi),this.$n=ii.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new sh(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}function lh(){}function fh(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}function dh(t,e,n){this.Ue=t,this._n=e,this.Ut=n}function ph(t,e,n,r){return new ch(t,e,n,r)}function yh(i,t){return l(this,void 0,void 0,(function(){var e,n,r,o;return g(this,(function(c){switch(c.label){case 0:return n=(e=i)._n,r=e.Mn,[4,e.persistence.runTransaction("Handle user change","readonly",(function(g){var o;return e._n.getAllMutationBatches(g).next((function(c){return o=c,n=e.persistence.getMutationQueue(t),r=new sh(e.On,n,e.persistence.getIndexManager()),n.getAllMutationBatches(g)})).next((function(t){for(var e=[],n=[],c=na(),i=0,h=o;i<h.length;i++){var s=h[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++){var l=u[a];c=c.add(l.key)}}for(var f=0,d=t;f<d.length;f++){var y=d[f];n.push(y.batchId);for(var m=0,p=y.mutations;m<p.length;m++){var v=p[m];c=c.add(v.key)}}return r.pn(g,c).next((function(t){return{Ln:t,removedBatchIds:e,addedBatchIds:n}}))}))}))];case 1:return o=c.sent(),[2,(e._n=n,e.Mn=r,e.xn.Vn(e.Mn),o)]}}))}))}function gh(t,e){var n=t;return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r,o,i,c,s,h,a,u=e.batch.keys(),l=n.On.newChangeBuffer({trackRemovals:!0});return r=n,o=t,c=l,h=(s=(i=e).batch).keys(),a=yu.resolve(),h.forEach((function(t){a=a.next((function(){return c.getEntry(o,t)})).next((function(e){var n=i.docVersions.get(t);$r(null!==n),e.version.compareTo(n)<0&&(s.applyToRemoteDocument(e,i),e.isValidDocument()&&c.addEntry(e,i.commitVersion))}))})),a.next((function(){return r._n.removeMutationBatch(o,s)})).next((function(){return l.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,u)}))}))}function mh(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function vh(t,e){var u=t,n=e.snapshotVersion,r=u.kn;return u.persistence.runTransaction("Apply remote event","readwrite-primary",(function(s){var t=u.On.newChangeBuffer({trackRemovals:!0});r=u.kn;var a=[];e.targetChanges.forEach((function(t,e){var o,c,i,h=r.get(e);h&&(a.push(u.qe.removeMatchingKeys(s,t.removedDocuments,e).next((function(){return u.qe.addMatchingKeys(s,t.addedDocuments,e)}))),0<(i=t.resumeToken).approximateByteSize()&&(o=h.withResumeToken(i,n).withSequenceNumber(s.currentSequenceNumber),r=r.insert(e,o),c=h,i=t,$r(0<(h=o).resumeToken.approximateByteSize()),(0===c.resumeToken.approximateByteSize()||3e8<=h.snapshotVersion.toMicroseconds()-c.snapshotVersion.toMicroseconds()||0<i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size)&&a.push(u.qe.updateTargetData(s,o))))}));var o,c=Xs;return e.documentUpdates.forEach((function(t,n){e.resolvedLimboDocuments.has(t)&&a.push(u.persistence.referenceDelegate.updateLimboDocument(s,t))})),a.push(wh(s,t,e.documentUpdates,n,void 0).next((function(t){c=t}))),n.isEqual(ii.min())||(o=u.qe.getLastRemoteSnapshotVersion(s).next((function(t){return u.qe.setTargetsMetadata(s,s.currentSequenceNumber,n)})),a.push(o)),yu.waitFor(a).next((function(){return t.apply(s)})).next((function(){return u.Mn.En(s,c)})).next((function(){return c}))})).then((function(t){return u.kn=r,t}))}function wh(t,s,e,a,u){var n=na();return e.forEach((function(t){return n=n.add(t)})),s.getEntries(t,n).next((function(i){var t=Xs;return e.forEach((function(e,n){var r=i.get(e),o=(null==u?void 0:u.get(e))||a;n.isNoDocument()&&n.version.isEqual(ii.min())?(s.removeEntry(e,o),t=t.insert(e,n)):!r.isValidDocument()||0<n.version.compareTo(r.version)||0===n.version.compareTo(r.version)&&r.hasPendingWrites?(s.addEntry(n,o),t=t.insert(e,n)):Hr("LocalStore","Ignoring outdated watch update for ",e,". Current version:",r.version," Watch version:",n.version)})),t}))}function bh(t,e){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",(function(t){var n;return i.qe.getTargetData(t,e).next((function(r){return r?(n=r,yu.resolve(n)):i.qe.allocateTargetId(t).next((function(r){return n=new Vu(e,r,0,t.currentSequenceNumber),i.qe.addTargetData(t,n).next((function(){return n}))}))}))})).then((function(t){var n=i.kn.get(t.targetId);return(null===n||0<t.snapshotVersion.compareTo(n.snapshotVersion))&&(i.kn=i.kn.insert(t.targetId,t),i.Fn.set(e,t.targetId)),t}))}function Eh(i,t,s){return l(this,void 0,void 0,(function(){var e,n,r;return g(this,(function(o){switch(o.label){case 0:n=(e=i).kn.get(t),r=s?"readwrite":"readwrite-primary",o.label=1;case 1:return o.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,(function(t){return e.persistence.referenceDelegate.removeTarget(t,n)}))];case 2:o.sent(),o.label=3;case 3:return[3,5];case 4:if(!Au(r=o.sent()))throw r;return Hr("LocalStore","Failed to update sequence numbers for target "+t+": "+r),[3,5];case 5:return e.kn=e.kn.remove(t),e.Fn.delete(n.target),[2]}}))}))}function Th(t,e,s){var a=t,u=ii.min(),n=na();return a.persistence.runTransaction("Execute query","readonly",(function(t){return r=a,o=t,c=Bo(e),(void 0!==(r=(i=r).Fn.get(c))?yu.resolve(i.kn.get(r)):i.qe.getTargetData(o,c)).next((function(e){if(e)return u=e.lastLimboFreeSnapshotVersion,a.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){n=t}))})).next((function(){return a.xn.getDocumentsMatchingQuery(t,e,s?u:ii.min(),s?n:na())})).next((function(t){return{documents:t,Bn:n}}));var r,o,c,i}))}function Ih(t,e){var n=t,r=n.qe;return(t=n.kn.get(e))?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function _h(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",(function(t){return e=s.On,n=t,t=s.$n,r=e,i=Xs,o=Qu(t),t=Wc(n),n=IDBKeyRange.lowerBound(o,!0),t.$t({index:nu.readTimeIndex,range:n},(function(t,e){var n=Ku(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:Hu(o)}}));var e,n,r,i,o})).then((function(t){var e=t.wn;return t=t.readTime,s.$n=t,e}))}function Sh(t){return l(this,void 0,void 0,(function(){var e;return g(this,(function(n){return[2,(e=t).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return t=Wc(t),e=ii.min(),t.$t({index:nu.readTimeIndex,reverse:!0},(function(t,n,r){n.readTime&&(e=Hu(n.readTime)),r.done()})).next((function(){return e}));var e})).then((function(t){e.$n=t}))]}))}))}var Ah,Dh,Nh=(Yh.prototype.getBundleMetadata=function(t,e){return yu.resolve(this.Qn.get(e))},Yh.prototype.saveBundleMetadata=function(t,e){return this.Qn.set(e.id,{id:e.id,version:e.version,createTime:Ta(e.createTime)}),yu.resolve()},Yh.prototype.getNamedQuery=function(t,e){return yu.resolve(this.jn.get(e))},Yh.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,{name:(e=e).name,query:Ju(e.bundledQuery),readTime:Ta(e.readTime)}),yu.resolve()},Yh),Ch=(Wh.prototype.isEmpty=function(){return this.Wn.isEmpty()},Wh.prototype.addReference=function(t,e){e=new kh(t,e),this.Wn=this.Wn.add(e),this.zn=this.zn.add(e)},Wh.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},Wh.prototype.removeReference=function(t,e){this.Yn(new kh(t,e))},Wh.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},Wh.prototype.Zn=function(t){var e=this,n=new Ri(new di([])),r=new kh(n,t),i=(t=new kh(n,t+1),[]);return this.zn.forEachInRange([r,t],(function(t){e.Yn(t),i.push(t.key)})),i},Wh.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},Wh.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},Wh.prototype.es=function(t){var e=new Ri(new di([])),n=new kh(e,t),r=(t=new kh(e,t+1),na());return this.zn.forEachInRange([n,t],(function(t){r=r.add(t.key)})),r},Wh.prototype.containsKey=function(t){var e=new kh(t,0);return null!==(e=this.Wn.firstAfterOrEqual(e))&&t.isEqual(e.key)},Wh),kh=(zh.Gn=function(t,e){return Ri.comparator(t.key,e.key)||ti(t.ns,e.ns)},zh.Hn=function(t,e){return ti(t.ns,e.ns)||Ri.comparator(t.key,e.key)},zh),Rh=(Hh.prototype.checkEmpty=function(t){return yu.resolve(0===this._n.length)},Hh.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,0<this._n.length&&this._n[this._n.length-1],n=new Mu(i,e,n,r),this._n.push(n);for(var o=0,s=r;o<s.length;o++){var a=s[o];this.rs=this.rs.add(new kh(a.key,i)),this.Ut.addToCollectionParentIndex(t,a.key.path.popLast())}return yu.resolve(n)},Hh.prototype.lookupMutationBatch=function(t,e){return yu.resolve(this.os(e))},Hh.prototype.getNextMutationBatchAfterBatchId=function(t,e){return e=(e=this.cs(e+1))<0?0:e,yu.resolve(this._n.length>e?this._n[e]:null)},Hh.prototype.getHighestUnacknowledgedBatchId=function(){return yu.resolve(0===this._n.length?-1:this.ss-1)},Hh.prototype.getAllMutationBatches=function(t){return yu.resolve(this._n.slice())},Hh.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new kh(e,0),i=(e=new kh(e,Number.POSITIVE_INFINITY),[]);return this.rs.forEachInRange([r,e],(function(t){t=n.os(t.ns),i.push(t)})),yu.resolve(i)},Hh.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ws(ti);return e.forEach((function(t){var e=new kh(t,0);t=new kh(t,Number.POSITIVE_INFINITY),n.rs.forEachInRange([e,t],(function(t){r=r.add(t.ns)}))})),yu.resolve(this.us(r))},Hh.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1;e=n,Ri.isDocumentKey(e)||(e=e.child("")),e=new kh(new Ri(e),0);var i=new Ws(ti);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(i=i.add(t.ns)),!0)}),e),yu.resolve(this.us(i))},Hh.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){null!==(t=e.os(t))&&n.push(t)})),n},Hh.prototype.removeMutationBatch=function(t,e){var i=this;$r(0===this.hs(e.batchId,"removed")),this._n.shift();var n=this.rs;return yu.forEach(e.mutations,(function(r){var o=new kh(r.key,e.batchId);return n=n.delete(o),i.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((function(){i.rs=n}))},Hh.prototype.Gt=function(t){},Hh.prototype.containsKey=function(t,e){var n=new kh(e,0);return n=this.rs.firstAfterOrEqual(n),yu.resolve(e.isEqual(n&&n.key))},Hh.prototype.performConsistencyCheck=function(t){return this._n.length,yu.resolve()},Hh.prototype.hs=function(t,e){return this.cs(t)},Hh.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},Hh.prototype.os=function(t){return(t=this.cs(t))<0||t>=this._n.length?null:this._n[t]},Hh),xh=(Qh.prototype.addEntry=function(t,e,n){var r=e.key,o=(i=this.docs.get(r))?i.size:0,i=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:i,readTime:n}),this.size+=i-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},Qh.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Qh.prototype.getEntry=function(t,e){var n=this.docs.get(e);return yu.resolve(n?n.document.clone():Wi.newInvalidDocument(e))},Qh.prototype.getEntries=function(t,e){var n=this,r=Xs;return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Wi.newInvalidDocument(t))})),yu.resolve(r)},Qh.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Xs,i=new Ri(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=(s=o.getNext()).key,s=(u=s.value).document,u=u.readTime;if(!e.path.isPrefixOf(a.path))break;u.compareTo(n)<=0||Ho(e,s)&&(r=r.insert(s.key,s.clone()))}return yu.resolve(r)},Qh.prototype.fs=function(t,e){return yu.forEach(this.docs,(function(t){return e(t)}))},Qh.prototype.newChangeBuffer=function(t){return new Oh(this)},Qh.prototype.getSize=function(t){return yu.resolve(this.size)},Qh),Oh=(h(Gh,Dh=C),Gh.prototype.applyChanges=function(t){var e=this,i=[];return this.changes.forEach((function(n,r){r.document.isValidDocument()?i.push(e.Ie.addEntry(t,r.document,e.getReadTime(n))):e.Ie.removeEntry(n)})),yu.waitFor(i)},Gh.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},Gh.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},Gh),Lh=(Kh.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),yu.resolve()},Kh.prototype.getLastRemoteSnapshotVersion=function(t){return yu.resolve(this.lastRemoteSnapshotVersion)},Kh.prototype.getHighestSequenceNumber=function(t){return yu.resolve(this.ws)},Kh.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),yu.resolve(this.highestTargetId)},Kh.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),yu.resolve()},Kh.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Ec(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},Kh.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,yu.resolve()},Kh.prototype.updateTargetData=function(t,e){return this.te(e),yu.resolve()},Kh.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),--this.targetCount,yu.resolve()},Kh.prototype.removeTargets=function(t,e,i){var n=this,s=0,a=[];return this.ds.forEach((function(r,o){o.sequenceNumber<=e&&null===i.get(o.targetId)&&(n.ds.delete(r),a.push(n.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),yu.waitFor(a).next((function(){return s}))},Kh.prototype.getTargetCount=function(t){return yu.resolve(this.targetCount)},Kh.prototype.getTargetData=function(t,e){return e=this.ds.get(e)||null,yu.resolve(e)},Kh.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),yu.resolve()},Kh.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),yu.waitFor(i)},Kh.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),yu.resolve()},Kh.prototype.getMatchingKeysForTargetId=function(t,e){return e=this._s.es(e),yu.resolve(e)},Kh.prototype.containsKey=function(t,e){return yu.resolve(this._s.containsKey(e))},Kh),Ph=(jh.prototype.start=function(){return Promise.resolve()},jh.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(jh.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),jh.prototype.setDatabaseDeletedListener=function(){},jh.prototype.setNetworkEnabled=function(){},jh.prototype.getIndexManager=function(){return this.Ut},jh.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Rh(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},jh.prototype.getTargetCache=function(){return this.qe},jh.prototype.getRemoteDocumentCache=function(){return this.Ue},jh.prototype.getBundleCache=function(){return this.Ke},jh.prototype.runTransaction=function(t,e,n){var r=this;Hr("MemoryPersistence","Starting transaction:",t);var i=new Mh(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},jh.prototype.Is=function(t,e){return yu.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},jh),Mh=(h(Bh,Ah=L),Bh),Fh=(qh.bs=function(t){return new qh(t)},Object.defineProperty(qh.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Xr()},enumerable:!1,configurable:!0}),qh.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),yu.resolve()},qh.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),yu.resolve()},qh.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),yu.resolve()},qh.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},qh.prototype.Es=function(){this.Rs=new Set},qh.prototype.Ts=function(t){var e=this,i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return yu.forEach(this.vs,(function(n){var r=Ri.fromPath(n);return e.Ps(t,r).next((function(t){t||i.removeEntry(r)}))})).next((function(){return e.Rs=null,i.apply(t)}))},qh.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},qh.prototype.ps=function(t){return 0},qh.prototype.Ps=function(t,e){var n=this;return yu.or([function(){return yu.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},qh),Vh=(Uh.prototype.isAuthenticated=function(){return null!=this.uid},Uh.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},Uh.prototype.isEqual=function(t){return t.uid===this.uid},Uh);function Uh(t){this.uid=t}function qh(t){this.persistence=t,this.As=new Ch,this.Rs=null}function Bh(t){var e=this;return(e=Ah.call(this)||this).currentSequenceNumber=t,e}function jh(t,e){var n=this;this.gs={},this.Ne=new Vr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Lh(this),this.Ut=new rc,this.Ue=(t=this.Ut,new xh(t,(function(t){return n.referenceDelegate.ps(t)}))),this.R=new Uu(e),this.Ke=new Nh(this.R)}function Kh(t){this.persistence=t,this.ds=new qc(Ji,Zi),this.lastRemoteSnapshotVersion=ii.min(),this.highestTargetId=0,this.ws=0,this._s=new Ch,this.targetCount=0,this.ys=Ec.Jt()}function Gh(t){var e=this;return(e=Dh.call(this)||this).Ie=t,e}function Qh(t,e){this.Ut=t,this.ls=e,this.docs=new Bs(Ri.comparator),this.size=0}function Hh(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Ws(kh.Gn)}function zh(t,e){this.key=t,this.ns=e}function Wh(){this.Wn=new Ws(kh.Gn),this.zn=new Ws(kh.Hn)}function Yh(t){this.R=t,this.Qn=new Map,this.jn=new Map}function Xh(t,e){return"firestore_clients_"+t+"_"+e}function $h(t,e,n){return n="firestore_mutations_"+t+"_"+n,e.isAuthenticated()&&(n+="_"+e.uid),n}function Jh(t,e){return"firestore_targets_"+t+"_"+e}Vh.UNAUTHENTICATED=new Vh(null),Vh.GOOGLE_CREDENTIALS=new Vh("google-credentials-uid"),Vh.FIRST_PARTY=new Vh("first-party-uid"),Vh.MOCK_USER=new Vh("mock-user");var Zh,tl=(Il.Vs=function(t,e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new jr(i.error.code,i.error.message)),o?new Il(t,e,i.state,r):(zr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Il.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Il),el=(Tl.Vs=function(t,e){var n,r=JSON.parse(e),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new jr(r.error.code,r.error.message)),i?new Tl(t,r.state,n):(zr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Tl.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Tl),nl=(El.Vs=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ra,o=0;r&&o<n.activeTargetIds.length;++o)r=ki(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new El(t,i):(zr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},El),rl=(bl.Vs=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new bl(e.clientId,e.onlineState):(zr("SharedClientState","Failed to parse online state: "+t),null)},bl),il=(wl.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},wl.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},wl.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},wl),sl=(vl.yt=function(t){return!(!t||!t.localStorage)},vl.prototype.start=function(){return l(this,void 0,void 0,(function(){var t,e,n,i,r,s,a,u,o,c,h=this;return g(this,(function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(s=l.sent(),t=0,e=s;t<e.length;t++)(n=e[t])!==this.Ns&&(i=this.getItem(Xh(this.persistenceKey,n)))&&(r=nl.Vs(n,i))&&(this.Fs=this.Fs.insert(r.clientId,r));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,o=this.$s;u<o.length;u++)c=o[u],this.ks(c);return this.$s=[],this.window.addEventListener("pagehide",(function(){return h.shutdown()})),this.started=!0,[2]}}))}))},vl.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},vl.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},vl.prototype.isActiveQueryTarget=function(t){var e=!1;return this.Fs.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},vl.prototype.addPendingMutation=function(t){this.zs(t,"pending")},vl.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},vl.prototype.addLocalQueryTarget=function(t){var e,n="not-current";return this.isActiveQueryTarget(t)&&(!(e=this.storage.getItem(Jh(this.persistenceKey,t)))||(e=el.Vs(t,e))&&(n=e.state)),this.Js.Ds(t),this.Qs(),n},vl.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},vl.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},vl.prototype.clearQueryState=function(t){this.removeItem(Jh(this.persistenceKey,t))},vl.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},vl.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},vl.prototype.setOnlineState=function(t){this.Xs(t)},vl.prototype.notifyBundleLoaded=function(){this.Zs()},vl.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},vl.prototype.getItem=function(t){var e=this.storage.getItem(t);return Hr("SharedClientState","READ",t,e),e},vl.prototype.setItem=function(t,e){Hr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},vl.prototype.removeItem=function(t){Hr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},vl.prototype.ks=function(t){var e=this,n=t;n.storageArea===this.storage&&(Hr("SharedClientState","EVENT",n.key,n.newValue),n.key!==this.Os?this.Se.enqueueRetryable((function(){return l(e,void 0,void 0,(function(){var t,e,r,i;return g(this,(function(o){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(t=this.ni(n.key,n.newValue))return[2,this.ei(t.clientId,t)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(e=this.si(n.key,n.newValue)))return[2,this.ii(e)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(r=this.ri(n.key,n.newValue)))return[2,this.oi(r)]}else if(n.key===this.Us){if(null!==n.newValue&&(i=this.js(n.newValue)))return[2,this.Ws(i)]}else if(n.key===this.Ms)(i=function(t){var e=Vr.o;if(null!=t)try{var n=JSON.parse(t);$r("number"==typeof n),e=n}catch(t){zr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Vr.o&&this.sequenceNumberHandler(i);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]}))}))})):zr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))},Object.defineProperty(vl.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),vl.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},vl.prototype.zs=function(t,e,n){n=new tl(this.currentUser,t,e,n),t=$h(this.persistenceKey,this.currentUser,t),this.setItem(t,n.Ss())},vl.prototype.Hs=function(t){t=$h(this.persistenceKey,this.currentUser,t),this.removeItem(t)},vl.prototype.Xs=function(t){t={clientId:this.Ns,onlineState:t},this.storage.setItem(this.Us,JSON.stringify(t))},vl.prototype.Ys=function(t,e,n){var r=Jh(this.persistenceKey,t);n=new el(t,e,n),this.setItem(r,n.Ss())},vl.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},vl.prototype.ti=function(t){return(t=this.Ls.exec(t))?t[1]:null},vl.prototype.ni=function(t,e){return t=this.ti(t),nl.Vs(t,e)},vl.prototype.si=function(t,e){var n=this.Bs.exec(t);return t=Number(n[1]),n=void 0!==n[2]?n[2]:null,tl.Vs(new Vh(n),t,e)},vl.prototype.ri=function(t,e){return t=this.qs.exec(t),t=Number(t[1]),el.Vs(t,e)},vl.prototype.js=function(t){return rl.Vs(t)},vl.prototype.ii=function(t){return l(this,void 0,void 0,(function(){return g(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Hr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},vl.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},vl.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.Fs=r}))},vl.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},vl.prototype.Gs=function(t){var e=ra;return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},vl),al=(ml.prototype.addPendingMutation=function(t){},ml.prototype.updateMutationState=function(t,e,n){},ml.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},ml.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},ml.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},ml.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},ml.prototype.clearQueryState=function(t){delete this.fi[t]},ml.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},ml.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},ml.prototype.start=function(){return this.li=new il,Promise.resolve()},ml.prototype.handleUserChange=function(t,e,n){},ml.prototype.setOnlineState=function(t){},ml.prototype.shutdown=function(){},ml.prototype.writeSequenceNumber=function(t){},ml.prototype.notifyBundleLoaded=function(){},ml),cl=(dl.prototype.di=function(t){},dl.prototype.shutdown=function(){},dl),ol=(gl.prototype.di=function(t){this.gi.push(t)},gl.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},gl.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},gl.prototype._i=function(){Hr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},gl.prototype.yi=function(){Hr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},gl.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},gl),hl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},ll=(yl.prototype.Ii=function(t){this.Ai=t},yl.prototype.Ri=function(t){this.bi=t},yl.prototype.onMessage=function(t){this.vi=t},yl.prototype.close=function(){this.Ti()},yl.prototype.send=function(t){this.Ei(t)},yl.prototype.Pi=function(){this.Ai()},yl.prototype.Vi=function(t){this.bi(t)},yl.prototype.Si=function(t){this.vi(t)},yl),ul=(pl.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);return Hr("RestConnection","Sending: ",i,n),e={},this.ki(e,r),this.Fi(t,i,e,n).then((function(t){return Hr("RestConnection","Received: ",t),t}),(function(e){throw Wr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},pl.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},pl.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},pl.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+hl[t]},h(fl,Zh=pl),fl.prototype.Fi=function(u,t,e,n){return new Promise((function(r,s){var a=new Fr;a.listenOnce(Rr.COMPLETE,(function(){try{switch(a.getLastErrorCode()){case kr.NO_ERROR:var t=a.getResponseJson();Hr("Connection","XHR received:",JSON.stringify(t)),r(t);break;case kr.TIMEOUT:Hr("Connection",'RPC "'+u+'" timed out'),s(new jr(Br.DEADLINE_EXCEEDED,"Request time out"));break;case kr.HTTP_ERROR:var e,n,o=a.getStatus();Hr("Connection",'RPC "'+u+'" failed with status:',o,"response text:",a.getResponseText()),0<o?(e=a.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace(/_/g,"-"),n=0<=Object.values(Br).indexOf(i)?i:Br.UNKNOWN,s(new jr(n,e.message))):s(new jr(Br.UNKNOWN,"Server responded with status "+a.getStatus())):s(new jr(Br.UNAVAILABLE,"Connection failed."));break;default:Xr()}}finally{Hr("Connection",'RPC "'+u+'" completed.')}var i}));var o=JSON.stringify(n);a.send(t,"POST",o,e,15)}))},fl.prototype.Oi=function(t,e){var n,r=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new _r,o=Cr();t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},this.useFetchStreams&&(t.xmlHttpFactory=new Pr({})),this.ki(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=d().indexOf("Electron/")||0<=(n=d()).indexOf("MSIE ")||0<=n.indexOf("Trident/")||0<=d().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders"),Hr("Connection","Creating WebChannel: "+(r=r.join("")),t);var s=i.createWebChannel(r,t),a=!1,u=!1,c=new ll({Ei:function(t){u?Hr("Connection","Not sending because WebChannel is closed:",t):(a||(Hr("Connection","Opening WebChannel transport."),s.open(),a=!0),Hr("Connection","WebChannel sending:",t),s.send(t))},Ti:function(){return s.close()}});return(t=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))})(s,Mr.EventType.OPEN,(function(){u||Hr("Connection","WebChannel transport opened.")})),t(s,Mr.EventType.CLOSE,(function(){u||(u=!0,Hr("Connection","WebChannel transport closed"),c.Vi())})),t(s,Mr.EventType.ERROR,(function(t){u||(u=!0,Wr("Connection","WebChannel transport errored:",t),c.Vi(new jr(Br.UNAVAILABLE,"The operation could not be completed")))})),t(s,Mr.EventType.MESSAGE,(function(t){var e,n,r,i;u||($r(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Hr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=xs[r];if(void 0!==t)return qs(t)}(),i=n.message,void 0===t&&(t=Br.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.Vi(new jr(t,i)),s.close()):(Hr("Connection","WebChannel received:",e),c.Si(e)))})),t(o,xr.STAT_EVENT,(function(t){t.stat===Or?Hr("Connection","Detected buffering proxy"):t.stat===Lr&&Hr("Connection","Detected no buffering proxy")})),setTimeout((function(){c.Pi()}),0),c},fl);function fl(t){var e=this;return(e=Zh.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.autoDetectLongPolling=t.autoDetectLongPolling,e.useFetchStreams=t.useFetchStreams,e}function pl(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}function yl(t){this.Ei=t.Ei,this.Ti=t.Ti}function gl(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}function dl(){}function ml(){this.li=new il,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}function vl(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new Bs(ti),this.started=!1,this.$s=[],n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.storage=this.window.localStorage,this.currentUser=i,this.Os=Xh(this.persistenceKey,this.Ns),this.Ms="firestore_sequence_number_"+this.persistenceKey,this.Fs=this.Fs.insert(this.Ns,new il),this.Ls=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.Us="firestore_online_state_"+this.persistenceKey,this.Ks="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.xs)}function wl(){this.activeTargetIds=ra}function bl(t,e){this.clientId=t,this.onlineState=e}function El(t,e){this.clientId=t,this.activeTargetIds=e}function Tl(t,e,n){this.targetId=t,this.state=e,this.error=n}function Il(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function _l(){return"undefined"!=typeof window?window:null}function Sl(){return"undefined"!=typeof document?document:null}function Al(t){return new wa(t,!0)}function Dl(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(t){n.enqueueAndForget((function(){return l(o,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return Xl(this)?(Hr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return l(this,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:return(e=t).Or.add(4),[4,Kl(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,jl(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new Pl(n,r)}var Nl,Cl,kl,Rl=(Bl.prototype.reset=function(){this.qi=0},Bl.prototype.Qi=function(){this.qi=this.Bi},Bl.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);0<i&&Hr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Ki=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},Bl.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},Bl.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},Bl.prototype.Wi=function(){return(Math.random()-.5)*this.qi},Bl),xl=(ql.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},ql.prototype.er=function(){return 2===this.state},ql.prototype.start=function(){3!==this.state?this.auth():this.nr()},ql.prototype.stop=function(){return l(this,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},ql.prototype.sr=function(){this.state=0,this.Zi.reset()},ql.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},ql.prototype.cr=function(t){this.ur(),this.stream.send(t)},ql.prototype.rr=function(){return l(this,void 0,void 0,(function(){return g(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},ql.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},ql.prototype.close=function(t,e){return l(this,void 0,void 0,(function(){return g(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Br.RESOURCE_EXHAUSTED?(zr(e.toString()),zr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===Br.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},ql.prototype.ar=function(){},ql.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new jr(Br.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},ql.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},ql.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return l(t,void 0,void 0,(function(){return g(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},ql.prototype.dr=function(t){return Hr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},ql.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(Hr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},h(Ul,kl=C=ql),Ul.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},Ul.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Xr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.I?($r(void 0===s||"string"==typeof s),gi.fromBase64String(s||"")):($r(void 0===s||s instanceof Uint8Array),gi.fromUint8Array(s||new Uint8Array))),o=(a=e.targetChange.cause)&&(u=void 0===(c=a).code?Br.UNKNOWN:qs(c.code),new jr(u,c.message||"")),s=new ua(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime,r=Aa(t,n.document.name),i=Ta(n.document.updateTime);var a=new Hi({mapValue:{fields:n.document.fields}}),u=(o=Wi.newFoundDocument(r,i,a),n.targetIds||[]),c=n.removedTargetIds||[];s=new sa(u,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=Aa(t,n.document),i=n.readTime?Ta(n.readTime):ii.min(),a=Wi.newNoDocument(r,i),o=n.removedTargetIds||[],s=new sa([],o,a.key,a);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=Aa(t,n.document),i=n.removedTargetIds||[],s=new sa([],i,r,null);else{if(!("filter"in e))return Xr();e.filter,(e=e.filter).targetId,r=new Rs(n=e.count||0),i=e.targetId,s=new aa(i,r)}return s}(this.R,t);return t=function(t){return"targetChange"in t?(t=t.targetChange).targetIds&&t.targetIds.length||!t.readTime?ii.min():Ta(t.readTime):ii.min()}(t),this.listener._r(e,t)},Ul.prototype.mr=function(t){var e,n,r,o,i={};i.database=Ca(this.R),i.addTarget=(e=this.R,(r=to(r=(n=t).target)?{documents:Pa(e,r)}:{query:Ma(e,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=Ea(e,n.resumeToken):0<n.snapshotVersion.compareTo(ii.min())&&(r.readTime=ba(e,n.snapshotVersion.toTimestamp())),r),this.R,o=t,(t=null==(t=function(){switch(o.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Xr()}}())?null:{"goog-listen-tags":t})&&(i.labels=t),this.cr(i)},Ul.prototype.yr=function(t){var e={};e.database=Ca(this.R),e.removeTarget=t,this.cr(e)},Ul),Ol=(h(Vl,Cl=C),Object.defineProperty(Vl.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),Vl.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,Cl.prototype.start.call(this)},Vl.prototype.ar=function(){this.gr&&this.Er([])},Vl.prototype.wr=function(t){return this.Hi.Oi("Write",t)},Vl.prototype.onMessage=function(t){if($r(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?($r(void 0!==r),n.map((function(t){return n=r,(t=(e=t).updateTime?Ta(e.updateTime):Ta(n)).isEqual(ii.min())&&(t=Ta(n)),new ps(t,e.transformResults||[]);var e,n}))):[]),n=Ta(t.commitTime);return this.listener.Tr(n,e)}var r;return $r(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},Vl.prototype.Ar=function(){var t={};t.database=Ca(this.R),this.cr(t)},Vl.prototype.Er=function(t){var e=this;t={streamToken:this.lastStreamToken,writes:t.map((function(t){return Oa(e.R,t)}))},this.cr(t)},Vl),Ll=(h(Fl,Nl=function(){}),Fl.prototype.br=function(){if(this.Rr)throw new jr(Br.FAILED_PRECONDITION,"The client has already been terminated.")},Fl.prototype.Ni=function(t,e,n){var i=this;return this.br(),this.credentials.getToken().then((function(r){return i.Hi.Ni(t,e,n,r)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===Br.UNAUTHENTICATED&&i.credentials.invalidateToken(),t):new jr(Br.UNKNOWN,t.toString())}))},Fl.prototype.$i=function(t,e,n){var i=this;return this.br(),this.credentials.getToken().then((function(r){return i.Hi.$i(t,e,n,r)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===Br.UNAUTHENTICATED&&i.credentials.invalidateToken(),t):new jr(Br.UNKNOWN,t.toString())}))},Fl.prototype.terminate=function(){this.Rr=!0},Fl),Pl=(Ml.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},Ml.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,1<=this.vr&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},Ml.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},Ml.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},Ml.prototype.Cr=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.",this.Vr?(zr(t),this.Vr=!1):Hr("OnlineStateTracker",t)},Ml.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},Ml);function Ml(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}function Fl(t,e,n){var r=this;return(r=Nl.call(this)||this).credentials=t,r.Hi=e,r.R=n,r.Rr=!1,r}function Vl(t,e,n,r,i){var o=this;return(o=Cl.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).R=r,o.gr=!1,o}function Ul(t,e,n,r,i){var o=this;return(o=kl.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).R=r,o}function ql(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Rl(t,e)}function Bl(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}function jl(t){return l(this,void 0,void 0,(function(){var e,n;return g(this,(function(r){switch(r.label){case 0:if(!Xl(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Kl(t){return l(this,void 0,void 0,(function(){var e,n;return g(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Gl(t,e){t.$r.has(e.targetId)||(t.$r.set(e.targetId,e),Yl(t)?Wl(t):sf(t).er()&&Hl(t,e))}function Ql(t,e){var n=t;t=sf(n),n.$r.delete(e),t.er()&&zl(n,e),0===n.$r.size&&(t.er()?t.ir():Xl(n)&&n.Br.set("Unknown"))}function Hl(t,e){t.qr.U(e.targetId),sf(t).mr(e)}function zl(t,e){t.qr.U(e),sf(t).yr(e)}function Wl(t){t.qr=new ha({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),sf(t).start(),t.Br.Sr()}function Yl(t){return Xl(t)&&!sf(t).tr()&&0<t.$r.size}function Xl(t){return 0===t.Or.size}function $l(t){t.qr=void 0}function Jl(s,a,u){return l(this,void 0,void 0,(function(){var t,e;return g(this,(function(n){switch(n.label){case 0:if(s.Br.set("Online"),!(a instanceof ua&&2===a.state&&a.cause))return[3,6];n.label=1;case 1:return n.trys.push([1,3,,5]),[4,function(t,s){return l(this,void 0,void 0,(function(){var e,n,r,i;return g(this,(function(o){switch(o.label){case 0:e=s.cause,n=0,r=s.targetIds,o.label=1;case 1:return n<r.length?(i=r[n],t.$r.has(i)?[4,t.remoteSyncer.rejectListen(i,e)]:[3,3]):[3,5];case 2:o.sent(),t.$r.delete(i),t.qr.removeTarget(i),o.label=3;case 3:o.label=4;case 4:return n++,[3,1];case 5:return[2]}}))}))}(s,a)];case 2:return n.sent(),[3,5];case 3:return t=n.sent(),Hr("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),t),[4,Zl(s,t)];case 4:return n.sent(),[3,5];case 5:return[3,13];case 6:if(a instanceof sa?s.qr.X(a):a instanceof aa?s.qr.rt(a):s.qr.et(a),u.isEqual(ii.min()))return[3,13];n.label=7;case 7:return n.trys.push([7,11,,13]),[4,mh(s.localStore)];case 8:return e=n.sent(),0<=u.compareTo(e)?[4,(i=u,(o=(r=s).qr.ut(i)).targetChanges.forEach((function(t,e){var n;0<t.resumeToken.approximateByteSize()&&(n=r.$r.get(e))&&r.$r.set(e,n.withResumeToken(t.resumeToken,i))})),o.targetMismatches.forEach((function(t){var e=r.$r.get(t);e&&(r.$r.set(t,e.withResumeToken(gi.EMPTY_BYTE_STRING,e.snapshotVersion)),zl(r,t),e=new Vu(e.target,t,1,e.sequenceNumber),Hl(r,e))})),r.remoteSyncer.applyRemoteEvent(o))]:[3,10];case 9:n.sent(),n.label=10;case 10:return[3,13];case 11:return Hr("RemoteStore","Failed to raise snapshot:",e=n.sent()),[4,Zl(s,e)];case 12:return n.sent(),[3,13];case 13:return[2]}var r,i,o}))}))}function Zl(t,e,i){return l(this,void 0,void 0,(function(){var n=this;return g(this,(function(r){switch(r.label){case 0:if(!Au(e))throw e;return t.Or.add(1),[4,Kl(t)];case 1:return r.sent(),t.Br.set("Offline"),i=i||function(){return mh(t.localStore)},t.asyncQueue.enqueueRetryable((function(){return l(n,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return Hr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return e.sent(),t.Or.delete(1),[4,jl(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function tf(t,e){return e().catch((function(n){return Zl(t,n,e)}))}function ef(u){return l(this,void 0,void 0,(function(){var i,t,s,a;return g(this,(function(e){switch(e.label){case 0:t=af(i=u),s=0<i.Fr.length?i.Fr[i.Fr.length-1].batchId:-1,e.label=1;case 1:if(!(Xl(i)&&i.Fr.length<10))return[3,7];e.label=2;case 2:return e.trys.push([2,4,,6]),[4,(n=i.localStore,r=s,(o=n).persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===r&&(r=-1),o._n.getNextMutationBatchAfterBatchId(t,r)})))];case 3:return null===(a=e.sent())?(0===i.Fr.length&&t.ir(),[3,7]):(s=a.batchId,function(t,e){t.Fr.push(e),(t=af(t)).er()&&t.pr&&t.Er(e.mutations)}(i,a),[3,6]);case 4:return a=e.sent(),[4,Zl(i,a)];case 5:return e.sent(),[3,6];case 6:return[3,1];case 7:return nf(i)&&rf(i),[2]}var n,r,o}))}))}function nf(t){return Xl(t)&&!af(t).tr()&&0<t.Fr.length}function rf(t){af(t).start()}function of(t,e){return l(this,void 0,void 0,(function(){var n;return g(this,(function(r){switch(r.label){case 0:return n=t,e?(n.Or.delete(2),[4,jl(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,Kl(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function sf(t){var e,n,r,i=this;return t.Ur||(t.Ur=(e=t.datastore,n=t.asyncQueue,r={Ii:function(t){return l(this,void 0,void 0,(function(){return g(this,(function(e){return t.$r.forEach((function(e,n){Hl(t,e)})),[2]}))}))}.bind(null,t),Ri:function(t,e){return l(this,void 0,void 0,(function(){return g(this,(function(n){return $l(t),Yl(t)?(t.Br.Nr(e),Wl(t)):t.Br.set("Unknown"),[2]}))}))}.bind(null,t),_r:Jl.bind(null,t)},e.br(),new xl(n,e.Hi,e.credentials,e.R,r)),t.Mr.push((function(e){return l(i,void 0,void 0,(function(){return g(this,(function(n){switch(n.label){case 0:return e?(t.Ur.sr(),Yl(t)?Wl(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:n.sent(),$l(t),n.label=3;case 3:return[2]}}))}))}))),t.Ur}function af(t){var e,n,r,i=this;return t.Kr||(t.Kr=(e=t.datastore,n=t.asyncQueue,r={Ii:function(t){return l(this,void 0,void 0,(function(){return g(this,(function(e){return af(t).Ar(),[2]}))}))}.bind(null,t),Ri:function(t,e){return l(this,void 0,void 0,(function(){return g(this,(function(n){switch(n.label){case 0:return e&&af(t).pr?[4,function(t,i){return l(this,void 0,void 0,(function(){var e,n;return g(this,(function(r){switch(r.label){case 0:return Us(n=i.code)&&n!==Br.ABORTED?(e=t.Fr.shift(),af(t).sr(),[4,tf(t,(function(){return t.remoteSyncer.rejectFailedWrite(e.batchId,i)}))]):[3,3];case 1:return r.sent(),[4,ef(t)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return nf(t)&&rf(t),[2]}}))}))}.bind(null,t),Ir:function(t){return l(this,void 0,void 0,(function(){var e,n,r,i;return g(this,(function(o){for(e=af(t),n=0,r=t.Fr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]}))}))}.bind(null,t),Tr:function(t,i,e){return l(this,void 0,void 0,(function(){var n,r;return g(this,(function(o){switch(o.label){case 0:return n=t.Fr.shift(),r=Fu.from(n,i,e),[4,tf(t,(function(){return t.remoteSyncer.applySuccessfulWrite(r)}))];case 1:return o.sent(),[4,ef(t)];case 2:return o.sent(),[2]}}))}))}.bind(null,t)},e.br(),new Ol(n,e.Hi,e.credentials,e.R,r)),t.Mr.push((function(e){return l(i,void 0,void 0,(function(){return g(this,(function(n){switch(n.label){case 0:return e?(t.Kr.sr(),[4,ef(t)]):[3,2];case 1:return n.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:n.sent(),0<t.Fr.length&&(Hr("RemoteStore","Stopping write stream with "+t.Fr.length+" pending writes"),t.Fr=[]),n.label=4;case 4:return[2]}}))}))}))),t.Kr}var uf=(cf.createAndSchedule=function(t,e,n,r,i){return(i=new cf(t,e,Date.now()+n,r,i)).start(n),i},cf.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},cf.prototype.skipDelay=function(){return this.handleDelayElapsed()},cf.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new jr(Br.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},cf.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},cf.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},cf);function cf(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new pu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}function hf(t,e){if(zr("AsyncQueue",e+": "+t),Au(t))return new jr(Br.UNAVAILABLE,e+": "+t);throw t}function lf(){this.queries=new qc(Go,Ko),this.onlineState="Unknown",this.Gr=new Set}var ff=(vf.emptySet=function(t){return new vf(t.comparator)},vf.prototype.has=function(t){return null!=this.keyedMap.get(t)},vf.prototype.get=function(t){return this.keyedMap.get(t)},vf.prototype.first=function(){return this.sortedSet.minKey()},vf.prototype.last=function(){return this.sortedSet.maxKey()},vf.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},vf.prototype.indexOf=function(t){return(t=this.keyedMap.get(t))?this.sortedSet.indexOf(t):-1},Object.defineProperty(vf.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),vf.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},vf.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},vf.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},vf.prototype.isEqual=function(t){if(!(t instanceof vf))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},vf.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},vf.prototype.copy=function(t,e){var n=new vf;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},vf),df=(mf.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);!n||0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Xr()},mf.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal((function(e,n){t.push(n)})),t},mf),pf=(gf.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach((function(t){i.push({type:0,doc:t})})),new gf(t,e,ff.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(gf.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),gf.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ko(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},gf),yf=function(){this.Wr=void 0,this.listeners=[]};function gf(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}function mf(){this.Qr=new Bs(Ri.comparator)}function vf(t){this.comparator=t?function(e,n){return t(e,n)||Ri.comparator(e.key,n.key)}:function(t,e){return Ri.comparator(t.key,e.key)},this.keyedMap=Zs,this.sortedSet=new Bs(this.comparator)}function wf(s,a){return l(this,void 0,void 0,(function(){var t,e,n,i,r;return g(this,(function(o){switch(o.label){case 0:if(t=s,e=a.query,n=!1,(i=t.queries.get(e))||(n=!0,i=new yf),!n)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),r=i,[4,t.onListen(e)];case 2:return r.Wr=o.sent(),[3,4];case 3:return r=hf(r=o.sent(),"Initialization of query '"+Qo(a.query)+"' failed"),[2,void a.onError(r)];case 4:return t.queries.set(e,i),i.listeners.push(a),a.zr(t.onlineState),i.Wr&&a.Hr(i.Wr)&&Ef(t),[2]}}))}))}function bf(s,a){return l(this,void 0,void 0,(function(){var t,e,n,i,r;return g(this,(function(o){return t=s,e=a.query,n=!1,(i=t.queries.get(e))&&0<=(r=i.listeners.indexOf(a))&&(i.listeners.splice(r,1),n=0===i.listeners.length),n?[2,(t.queries.delete(e),t.onUnlisten(e))]:[2]}))}))}function Ef(t){t.Gr.forEach((function(t){t.next()}))}var Tf=(Cf.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new pf(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},Cf.prototype.onError=function(t){this.Jr.error(t)},Cf.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},Cf.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},Cf.prototype.Zr=function(t){if(0<t.docChanges.length)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},Cf.prototype.no=function(t){t=pf.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},Cf),If=(Nf.prototype.io=function(){return"metadata"in this.payload},Nf),_f=(Df.prototype.qn=function(t){return Aa(this.R,t)},Df.prototype.Un=function(t){return t.metadata.exists?xa(this.R,t.document,!1):Wi.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},Df.prototype.Kn=Ta,Df),Sf=(Af.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},Af.prototype.co=function(t){for(var e=new Map,n=new _f(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||na()).add(s);e.set(c,h)}}return e},Af.prototype.complete=function(){return l(this,void 0,void 0,(function(){var t,e,n,i;return g(this,(function(r){switch(r.label){case 0:return[4,function(t,e,n,p){return l(this,void 0,void 0,(function(){var r,o,i,c,h,s,a,u,l,f;return g(this,(function(d){switch(d.label){case 0:for(r=t,o=na(),i=Xs,c=ta,h=0,s=n;h<s.length;h++)a=s[h],u=e.qn(a.metadata.name),a.document&&(o=o.add(u)),i=i.insert(u,e.Un(a)),c=c.insert(u,e.Kn(a.metadata.readTime));return l=r.On.newChangeBuffer({trackRemovals:!0}),[4,bh(r,Bo(Lo(di.fromString("__bundle__/docs/"+p))))];case 1:return f=d.sent(),[2,r.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return wh(t,l,i,ii.min(),c).next((function(e){return l.apply(t),e})).next((function(e){return r.qe.removeMatchingKeysForTargetId(t,f.targetId).next((function(){return r.qe.addMatchingKeys(t,o,f.targetId)})).next((function(){return r.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}(this.localStore,new _f(this.R),this.documents,this.ro.id)];case 1:t=r.sent(),e=this.co(this.documents),n=0,i=this.queries,r.label=2;case 2:return n<i.length?(i=i[n],[4,function(t,i,e){return void 0===e&&(e=na()),l(this,void 0,void 0,(function(){var n,r;return g(this,(function(o){switch(o.label){case 0:return[4,bh(t,Bo(Ju(i.bundledQuery)))];case 1:return n=o.sent(),[2,(r=t).persistence.runTransaction("Save named query","readwrite",(function(t){var o=Ta(i.readTime);return 0<=n.snapshotVersion.compareTo(o)?r.Ke.saveNamedQuery(t,i):(o=n.withResumeToken(gi.EMPTY_BYTE_STRING,o),r.kn=r.kn.insert(o.targetId,o),r.qe.updateTargetData(t,o).next((function(){return r.qe.removeMatchingKeysForTargetId(t,n.targetId)})).next((function(){return r.qe.addMatchingKeys(t,e,n.targetId)})).next((function(){return r.Ke.saveNamedQuery(t,i)})))}))]}}))}))}(this.localStore,i,e.get(i.name))]):[3,5];case 3:r.sent(),r.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new oh(Object.assign({},this.progress),t))]}}))}))},Af);function Af(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=kf(t)}function Df(t){this.R=t}function Nf(t,e){this.payload=t,this.byteLength=e}function Cf(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}function kf(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var Rf=function(t){this.key=t},xf=function(t){this.key=t},Of=(Object.defineProperty(Vf.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),Vf.prototype._o=function(t,e){var s=this,a=e?e.mo:new df,u=(e||this).fo,n=(e||this).mutatedKeys,r=u,o=!1,c=Po(this.query)&&u.size===this.query.limit?u.last():null,h=Mo(this.query)&&u.size===this.query.limit?u.first():null;if(t.inorderTraversal((function(t,e){var l=u.get(t),f=Ho(s.query,e)?e:null,i=!!l&&s.mutatedKeys.has(l.key),d=!!f&&(f.hasLocalMutations||s.mutatedKeys.has(f.key)&&f.hasCommittedMutations);e=!1,l&&f?l.data.isEqual(f.data)?i!==d&&(a.track({type:3,doc:f}),e=!0):s.yo(l,f)||(a.track({type:2,doc:f}),e=!0,(c&&0<s.lo(f,c)||h&&s.lo(f,h)<0)&&(o=!0)):!l&&f?(a.track({type:0,doc:f}),e=!0):l&&!f&&(a.track({type:1,doc:l}),e=!0,(c||h)&&(o=!0)),e&&(n=f?(r=r.add(f),d?n.add(t):n.delete(t)):(r=r.delete(t),n.delete(t)))})),Po(this.query)||Mo(this.query))for(;r.size>this.query.limit;){var l=Po(this.query)?r.last():r.first();r=r.delete(l.key),n=n.delete(l.key),a.track({type:1,doc:l})}return{fo:r,mo:a,Nn:o,mutatedKeys:n}},Vf.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},Vf.prototype.applyChanges=function(t,e,n){var r=this,o=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var i=t.mo.jr();i.sort((function(t,e){return o=t.type,i=e.type,n(o)-n(i)||r.lo(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xr()}}var o,i})),this.po(n);var s=e?this.Eo():[];return e=(n=0===this.ho.size&&this.current?1:0)!==this.ao,this.ao=n,0!==i.length||e?{snapshot:new pf(this.query,t.fo,o,i,t.mutatedKeys,0==n,e,!1),To:s}:{To:s}},Vf.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new df,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},Vf.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},Vf.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},Vf.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=na(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new xf(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new Rf(t))})),n},Vf.prototype.Ao=function(t){return this.uo=t.Bn,this.ho=na(),t=this._o(t.documents),this.applyChanges(t,!0)},Vf.prototype.Ro=function(){return pf.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},Vf),Lf=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Pf=function(t){this.key=t,this.bo=!1},Mf=(Object.defineProperty(Ff.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),Ff);function Ff(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new qc(Go,Ko),this.Vo=new Map,this.So=new Set,this.Do=new Bs(Ri.comparator),this.Co=new Map,this.No=new Ch,this.xo={},this.ko=new Map,this.Fo=Ec.Yt(),this.onlineState="Unknown",this.$o=void 0}function Vf(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=na(),this.mutatedKeys=na(),this.lo=zo(t),this.fo=new ff(this.lo)}function Uf(i,t,s,a){return l(this,void 0,void 0,(function(){var e,n,r;return g(this,(function(o){switch(o.label){case 0:return i.Oo=function(t,e,n){return function(t,i,e,s){return l(this,void 0,void 0,(function(){var n,r;return g(this,(function(o){switch(o.label){case 0:return(n=i.view._o(e)).Nn?[4,Th(t.localStore,i.query,!1).then((function(t){return t=t.documents,i.view._o(t,n)}))]:[3,2];case 1:n=o.sent(),o.label=2;case 2:return r=s&&s.targetChanges.get(i.targetId),r=i.view.applyChanges(n,t.isPrimaryClient,r),[2,(Yf(t,i.targetId,r.To),r.snapshot)]}}))}))}(i,t,e,n)},[4,Th(i.localStore,t,!0)];case 1:return n=o.sent(),r=new Of(t,n.Bn),e=r._o(n.documents),n=oa.createSynthesizedTargetChangeForCurrentChange(s,a&&"Offline"!==i.onlineState),n=r.applyChanges(e,i.isPrimaryClient,n),Yf(i,s,n.To),r=new Lf(t,s,r),[2,(i.Po.set(t,r),i.Vo.has(s)?i.Vo.get(s).push(t):i.Vo.set(s,[t]),n.snapshot)]}}))}))}function qf(t,e,p){return l(this,void 0,void 0,(function(){var s,n;return g(this,(function(r){switch(r.label){case 0:n=id(t),r.label=1;case 1:return r.trys.push([1,5,,6]),[4,(i=n.localStore,a=e,l=i,f=ri.now(),d=a.reduce((function(t,e){return t.add(e.key)}),na()),l.persistence.runTransaction("Locally write mutations","readwrite",(function(s){return l.Mn.pn(s,d).next((function(t){u=t;for(var e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field);null!=(s=$o(o.transform,s||null))&&(n=null==n?Hi.empty():n).set(o.field,s)}return n||null}(i,u.get(i.key));null!=o&&e.push(new Ss(i.key,o,function s(t){var a=[];return ui(t.fields,(function(t,e){var n=new li([t]);if(Gi(e))if(0===(e=s(e.mapValue).fields).length)a.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];a.push(n.child(o))}else a.push(n)})),new yi(a)}(o.value.mapValue),gs.exists(!0)))}return l._n.addMutationBatch(s,f,e,a)}))})).then((function(t){return t.applyToLocalDocumentSet(u),{batchId:t.batchId,changes:u}})))];case 2:return s=r.sent(),n.sharedClientState.addPendingMutation(s.batchId),o=n,c=s.batchId,h=p,i=(i=(i=o.xo[o.currentUser.toKey()])||new Bs(ti)).insert(c,h),o.xo[o.currentUser.toKey()]=i,[4,$f(n,s.changes)];case 3:return r.sent(),[4,ef(n.remoteStore)];case 4:return r.sent(),[3,6];case 5:return n=hf(n=r.sent(),"Failed to persist write"),p.reject(n),[3,6];case 6:return[2]}var o,c,h,i,a,u,l,f,d}))}))}function Bf(t,i){return l(this,void 0,void 0,(function(){var e,n;return g(this,(function(r){switch(r.label){case 0:e=t,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,vh(e.localStore,i)];case 2:return n=r.sent(),i.targetChanges.forEach((function(t,n){(n=e.Co.get(n))&&($r(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),0<t.addedDocuments.size?n.bo=!0:0<t.modifiedDocuments.size?$r(n.bo):0<t.removedDocuments.size&&($r(n.bo),n.bo=!1))})),[4,$f(e,n,i)];case 3:return r.sent(),[3,6];case 4:return[4,Nc(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))}function jf(t,e,n){var r;((t=t).isPrimaryClient&&0===n||!t.isPrimaryClient&&1===n)&&(r=[],t.Po.forEach((function(t,n){(n=n.view.zr(e)).snapshot&&r.push(n.snapshot)})),function(t,i){t.onlineState=i;var e=!1;t.queries.forEach((function(t,n){for(var r=0,o=n.listeners;r<o.length;r++)o[r].zr(i)&&(e=!0)})),e&&Ef(t)}(t.eventManager,e),r.length&&t.vo._r(r),t.onlineState=e,t.isPrimaryClient&&t.sharedClientState.setOnlineState(e))}function Kf(s,a,u){return l(this,void 0,void 0,(function(){var t,e;return g(this,(function(n){switch(n.label){case 0:t=s,n.label=1;case 1:return n.trys.push([1,4,,6]),[4,(r=t.localStore,o=a,(i=r).persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var e;return i._n.lookupMutationBatch(t,o).next((function(n){return $r(null!==n),e=n.keys(),i._n.removeMutationBatch(t,n)})).next((function(){return i._n.performConsistencyCheck(t)})).next((function(){return i.Mn.pn(t,e)}))})))];case 2:return e=n.sent(),Hf(t,a,u),Qf(t,a),t.sharedClientState.updateMutationState(a,"rejected",u),[4,$f(t,e)];case 3:return n.sent(),[3,6];case 4:return[4,Nc(n.sent())];case 5:return n.sent(),[3,6];case 6:return[2]}var r,o,i}))}))}function Gf(t,s){return l(this,void 0,void 0,(function(){var e,n,i;return g(this,(function(r){switch(r.label){case 0:Xl((e=t).remoteStore)||Hr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,(o=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return o._n.getHighestUnacknowledgedBatchId(t)}))];case 2:return-1===(n=r.sent())?[2,void s.resolve()]:((i=e.ko.get(n)||[]).push(s),e.ko.set(n,i),[3,4]);case 3:return i=hf(i=r.sent(),"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var o}))}))}function Qf(t,e){(t.ko.get(e)||[]).forEach((function(t){t.resolve()})),t.ko.delete(e)}function Hf(t,e,n){var r=t,i=r.xo[r.currentUser.toKey()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i)}function zf(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Wf(t,e)}))}function Wf(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Ql(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Xf(t))}function Yf(t,e,n){for(var r,i,o,s=0,a=n;s<a.length;s++){var u=a[s];u instanceof Rf?(t.No.addReference(u.key,e),r=t,o=void 0,i=(o=(i=u).key).path.canonicalString(),r.Do.get(o)||r.So.has(i)||(Hr("SyncEngine","New document in limbo: "+o),r.So.add(i),Xf(r))):u instanceof xf?(Hr("SyncEngine","Document no longer in limbo: "+u.key),t.No.removeReference(u.key,e),t.No.containsKey(u.key)||Wf(t,u.key)):Xr()}}function Xf(t){for(;0<t.So.size&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Ri(di.fromString(e));e=t.Fo.next(),t.Co.set(e,new Pf(n)),t.Do=t.Do.insert(n,e),Gl(t.remoteStore,new Vu(Bo(Lo(n.path)),e,2,Vr.o))}}function $f(t,s,a){return l(this,void 0,void 0,(function(){var e,n,i,r;return g(this,(function(o){switch(o.label){case 0:return n=[],i=[],r=[],(e=t).Po.isEmpty()?[3,3]:(e.Po.forEach((function(t,o){r.push(e.Oo(o,s,a).then((function(t){t&&(e.isPrimaryClient&&e.sharedClientState.updateQueryState(o.targetId,t.fromCache?"not-current":"current"),n.push(t),t=ah.Pn(o.targetId,t),i.push(t))})))})),[4,Promise.all(r)]);case 1:return o.sent(),e.vo._r(n),[4,function(u,t){return l(this,void 0,void 0,(function(){var e,n,r,i,o,s,a;return g(this,(function(c){switch(c.label){case 0:e=u,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,e.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(n){return yu.forEach(t,(function(t){return yu.forEach(t.bn,(function(r){return e.persistence.referenceDelegate.addReference(n,t.targetId,r)})).next((function(){return yu.forEach(t.vn,(function(r){return e.persistence.referenceDelegate.removeReference(n,t.targetId,r)}))}))}))}))];case 2:return c.sent(),[3,4];case 3:if(!Au(n=c.sent()))throw n;return Hr("LocalStore","Failed to update sequence numbers: "+n),[3,4];case 4:for(r=0,i=t;r<i.length;r++)a=i[r],o=a.targetId,a.fromCache||(s=e.kn.get(o),a=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(a),e.kn=e.kn.insert(o,a));return[2]}}))}))}(e.localStore,i)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))}function Jf(i,t){return l(this,void 0,void 0,(function(){var e,n;return g(this,(function(r){switch(r.label){case 0:return(e=i).currentUser.isEqual(t)?[3,3]:(Hr("SyncEngine","User change. New user:",t.toKey()),[4,yh(e.localStore,t)]);case 1:return n=r.sent(),e.currentUser=t,(o=e).ko.forEach((function(t){t.forEach((function(t){t.reject(new jr(Br.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),o.ko.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,$f(e,n.Ln)];case 2:r.sent(),r.label=3;case 3:return[2]}var o}))}))}function Zf(a,u,t,e){return l(this,void 0,void 0,(function(){var n,s;return g(this,(function(r){switch(r.label){case 0:return[4,(o=(n=a).localStore,c=u,i=(h=o)._n,h.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return i.jt(t,c).next((function(e){return e?h.Mn.pn(t,e):yu.resolve(null)}))})))];case 1:return null===(s=r.sent())?[3,6]:"pending"!==t?[3,3]:[4,ef(n.remoteStore)];case 2:return r.sent(),[3,4];case 3:"acknowledged"===t||"rejected"===t?(Hf(n,u,e||null),Qf(n,u),n.localStore._n.Gt(u)):Xr(),r.label=4;case 4:return[4,$f(n,s)];case 5:return r.sent(),[3,7];case 6:Hr("SyncEngine","Cannot apply mutation batch with id: "+u),r.label=7;case 7:return[2]}var o,c,h,i}))}))}function ed(t,e){return l(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c;return g(this,(function(h){switch(h.label){case 0:return td(n=t),id(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,nd(n,r.toArray())]);case 1:return i=h.sent(),n.$o=!0,[4,of(n.remoteStore,!0)];case 2:for(h.sent(),o=0,s=i;o<s.length;o++)a=s[o],Gl(n.remoteStore,a);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(u=[],c=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?u.push(e):c=c.then((function(){return zf(n,e),Eh(n.localStore,e,!0)})),Ql(n.remoteStore,e)})),[4,c]);case 4:return h.sent(),[4,nd(n,u)];case 5:return h.sent(),(l=n).Co.forEach((function(t,e){Ql(l.remoteStore,e)})),l.No.ts(),l.Co=new Map,l.Do=new Bs(Ri.comparator),n.$o=!1,[4,of(n.remoteStore,!1)];case 6:h.sent(),h.label=7;case 7:return[2]}var l}))}))}function nd(t,p){return l(this,void 0,void 0,(function(){var e,n,r,i,o,s,a,u,c,h,f,d;return g(this,(function(y){switch(y.label){case 0:e=t,n=[],r=[],i=0,o=p,y.label=1;case 1:return i<o.length?(s=o[i],a=void 0,(u=e.Vo.get(s))&&0!==u.length?[4,bh(e.localStore,Bo(u[0]))]:[3,7]):[3,13];case 2:a=y.sent(),c=0,h=u,y.label=3;case 3:return c<h.length?(f=h[c],f=e.Po.get(f),[4,function(t,i){return l(this,void 0,void 0,(function(){var e,n;return g(this,(function(r){switch(r.label){case 0:return[4,Th((e=t).localStore,i.query,!0)];case 1:return n=r.sent(),n=i.view.Ao(n),[2,(e.isPrimaryClient&&Yf(e,i.targetId,n.To),n)]}}))}))}(e,f)]):[3,6];case 4:(f=y.sent()).snapshot&&r.push(f.snapshot),y.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,Ih(e.localStore,s)];case 8:return d=y.sent(),[4,bh(e.localStore,d)];case 9:return a=y.sent(),[4,Uf(e,rd(d),s,!1)];case 10:y.sent(),y.label=11;case 11:n.push(a),y.label=12;case 12:return i++,[3,1];case 13:return[2,(e.vo._r(r),n)]}}))}))}function rd(t){return Oo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function td(t){return t.remoteStore.remoteSyncer.applyRemoteEvent=Bf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){var n=t;if((t=n.Co.get(e))&&t.bo)return na().add(t.key);var r=na();if(!(e=n.Vo.get(e)))return r;for(var i=0,o=e;i<o.length;i++){var s=o[i];s=n.Po.get(s),r=r.unionWith(s.view.wo)}return r}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=function(t,s,a){return l(this,void 0,void 0,(function(){var e,n,r,i;return g(this,(function(o){switch(o.label){case 0:return(e=t).sharedClientState.updateQueryState(s,"rejected",a),i=e.Co.get(s),(n=i&&i.key)?(r=(r=new Bs(Ri.comparator)).insert(n,Wi.newNoDocument(n,ii.min())),i=na().add(n),i=new ia(ii.min(),new Map,new Ws(ti),r,i),[4,Bf(e,i)]):[3,2];case 1:return o.sent(),e.Do=e.Do.remove(n),e.Co.delete(s),Xf(e),[3,4];case 2:return[4,Eh(e.localStore,s,!1).then((function(){return zf(e,s,a)})).catch(Nc)];case 3:o.sent(),o.label=4;case 4:return[2]}}))}))}.bind(null,t),t.vo._r=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query;if(a=n.queries.get(a)){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Ef(n)}.bind(null,t.eventManager),t.vo.Mo=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,t.eventManager),t}function id(t){return t.remoteStore.remoteSyncer.applySuccessfulWrite=function(i,t){return l(this,void 0,void 0,(function(){var e,n,r;return g(this,(function(o){switch(o.label){case 0:e=i,n=t.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,gh(e.localStore,t)];case 2:return r=o.sent(),Hf(e,n,null),Qf(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),[4,$f(e,r)];case 3:return o.sent(),[3,6];case 4:return[4,Nc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Kf.bind(null,t),t}function od(t,e,n){var r=t;(function(t,e,p){return l(this,void 0,void 0,(function(){var a,u,n,r,o;return g(this,(function(c){switch(c.label){case 0:return c.trys.push([0,14,,15]),[4,e.getMetadata()];case 1:return a=c.sent(),[4,(f=t.localStore,d=f,s=Ta((i=a).createTime),d.persistence.runTransaction("hasNewerBundle","readonly",(function(t){return d.Ke.getBundleMetadata(t,i.id)})).then((function(t){return!!t&&0<=t.createTime.compareTo(s)})))];case 2:return c.sent()?[4,e.close()]:[3,4];case 3:return[2,(c.sent(),void p._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}))];case 4:return p._updateProgress(kf(a)),u=new Sf(a,t.localStore,e.R),[4,e.Lo()];case 5:n=c.sent(),c.label=6;case 6:return n?[4,u.oo(n)]:[3,10];case 7:return(r=c.sent())&&p._updateProgress(r),[4,e.Lo()];case 8:n=c.sent(),c.label=9;case 9:return[3,6];case 10:return[4,u.complete()];case 11:return o=c.sent(),[4,$f(t,o.wn,void 0)];case 12:return c.sent(),[4,(f=t.localStore,h=a,(l=f).persistence.runTransaction("Save bundle","readwrite",(function(t){return l.Ke.saveBundleMetadata(t,h)})))];case 13:return c.sent(),p._completeWith(o.progress),[3,15];case 14:return Wr("SyncEngine","Loading bundle failed with "+(o=c.sent())),p._failWith(o),[3,15];case 15:return[2]}var h,l,f,i,d,s}))}))})(r,e,n).then((function(){r.sharedClientState.notifyBundleLoaded()}))}var sd,ad,ud=(gd.prototype.initialize=function(t){return l(this,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return this.R=Al(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}}))}))},gd.prototype.Uo=function(t){return null},gd.prototype.Ko=function(t){return ph(this.persistence,new uh,t.initialUser,this.R)},gd.prototype.qo=function(t){return new Ph(Fh.bs,this.R)},gd.prototype.Bo=function(t){return new al},gd.prototype.terminate=function(){return l(this,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},gd),cd=(h(yd,ad=ud),yd.prototype.initialize=function(t){return l(this,void 0,void 0,(function(){var e=this;return g(this,(function(n){switch(n.label){case 0:return[4,ad.prototype.initialize.call(this,t)];case 1:return n.sent(),[4,Sh(this.localStore)];case 2:return n.sent(),[4,this.Qo.initialize(this,t)];case 3:return n.sent(),[4,id(this.Qo.syncEngine)];case 4:return n.sent(),[4,ef(this.Qo.remoteStore)];case 5:return n.sent(),[4,this.persistence.He((function(){return e.gcScheduler&&!e.gcScheduler.started&&e.gcScheduler.start(e.localStore),Promise.resolve()}))];case 6:return n.sent(),[2]}}))}))},yd.prototype.Ko=function(t){return ph(this.persistence,new uh,t.initialUser,this.R)},yd.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new Rc(e,t.asyncQueue)},yd.prototype.qo=function(t){var e=ih(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?lc.withCacheSize(this.cacheSizeBytes):lc.DEFAULT;return new eh(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,_l(),Sl(),this.R,this.sharedClientState,!!this.forceOwnership)},yd.prototype.Bo=function(t){return new al},yd),hd=(h(pd,sd=cd),pd.prototype.initialize=function(t){return l(this,void 0,void 0,(function(){var e,n=this;return g(this,(function(r){switch(r.label){case 0:return[4,sd.prototype.initialize.call(this,t)];case 1:return r.sent(),e=this.Qo.syncEngine,this.sharedClientState instanceof sl?(this.sharedClientState.syncEngine={ui:Zf.bind(null,e),ai:function(i,t,s,a){return l(this,void 0,void 0,(function(){var e,n,r;return g(this,(function(o){switch(o.label){case 0:return(e=i).$o?(Hr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.Vo.has(t))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,_h(e.localStore)];case 3:return n=o.sent(),r=ia.createSynthesizedRemoteEventForCurrentChange(t,"current"===s),[4,$f(e,n,r)];case 4:return o.sent(),[3,8];case 5:return[4,Eh(e.localStore,t,!0)];case 6:return o.sent(),zf(e,t,a),[3,8];case 7:Xr(),o.label=8;case 8:return[2]}}))}))}.bind(null,e),hi:function(t,e,n){return l(this,void 0,void 0,(function(){var r,o,c,i,h,s,a,u;return g(this,(function(l){switch(l.label){case 0:if(!(r=td(t)).$o)return[3,10];o=0,c=e,l.label=1;case 1:return o<c.length?(c=c[o],r.Vo.has(c)?(Hr("SyncEngine","Adding an already active target "+c),[3,5]):[4,Ih(r.localStore,c)]):[3,6];case 2:return i=l.sent(),[4,bh(r.localStore,i)];case 3:return h=l.sent(),[4,Uf(r,rd(i),h.targetId,!1)];case 4:l.sent(),Gl(r.remoteStore,h),l.label=5;case 5:return o++,[3,1];case 6:s=function(t){return g(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Eh(r.localStore,t,!1).then((function(){Ql(r.remoteStore,t),zf(r,t)})).catch(Nc)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},a=0,u=n,l.label=7;case 7:return a<u.length?(u=u[a],[5,s(u)]):[3,10];case 8:l.sent(),l.label=9;case 9:return a++,[3,7];case 10:return[2]}}))}))}.bind(null,e),fn:function(t){return t.localStore.persistence.fn()}.bind(null,e),ci:function(t){return l(this,void 0,void 0,(function(){var e;return g(this,(function(n){return[2,_h((e=t).localStore).then((function(t){return $f(e,t)}))]}))}))}.bind(null,e)},[4,this.sharedClientState.start()]):[3,3];case 2:r.sent(),r.label=3;case 3:return[4,this.persistence.He((function(t){return l(n,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return[4,ed(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return r.sent(),[2]}}))}))},pd.prototype.Bo=function(t){var e=_l();if(!sl.yt(e))throw new jr(Br.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=ih(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new sl(e,t.asyncQueue,n,t.clientId,t.initialUser)},pd),ld=(fd.prototype.initialize=function(t,e){return l(this,void 0,void 0,(function(){var n=this;return g(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return jf(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Jf.bind(null,this.syncEngine),[4,of(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},fd.prototype.createEventManager=function(t){return new lf},fd.prototype.createDatastore=function(t){var e=Al(t.databaseInfo.databaseId),n=(n=t.databaseInfo,new ul(n));return t=t.credentials,new Ll(t,n,e)},fd.prototype.createRemoteStore=function(t){var e=this;return new Dl(this.localStore,this.datastore,t.asyncQueue,(function(t){return jf(e.syncEngine,t,0)}),t=new(ol.yt()?ol:cl))},fd.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){return o=new Mf(t,e,n,r,i,o),s&&(o.$o=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},fd.prototype.terminate=function(){return function(t){return l(this,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:return e=t,Hr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Kl(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},fd);function fd(){}function pd(t,e){var n=this;return(n=sd.call(this,t,e,!1)||this).Qo=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function yd(t,e,n){var r=this;return(r=ad.call(this)||this).Qo=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function gd(){this.synchronizeTabs=!1}function dd(t,e){void 0===e&&(e=10240);var i=0;return{read:function(){return l(this,void 0,void 0,(function(){var n;return g(this,(function(r){return i<t.byteLength?(n={value:t.slice(i,i+e),done:!1},[2,(i+=e,n)]):[2,{done:!0}]}))}))},cancel:function(){return l(this,void 0,void 0,(function(){return g(this,(function(t){return[2]}))}))},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var md=(Ad.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},Ad.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Ad.prototype.Wo=function(){this.muted=!0},Ad.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},Ad),vd=(Sd.prototype.close=function(){return this.Go.cancel()},Sd.prototype.getMetadata=function(){return l(this,void 0,void 0,(function(){return g(this,(function(t){return[2,this.metadata.promise]}))}))},Sd.prototype.Lo=function(){return l(this,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},Sd.prototype.Ho=function(){return l(this,void 0,void 0,(function(){var t,e,n;return g(this,(function(r){switch(r.label){case 0:return[4,this.Jo()];case 1:return null===(t=r.sent())?[2,null]:(n=this.zo.decode(t),e=Number(n),isNaN(e)&&this.Yo("length string ("+n+") is not valid number"),[4,this.Xo(e)]);case 2:return n=r.sent(),[2,new If(JSON.parse(n),t.length+e)]}}))}))},Sd.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},Sd.prototype.Jo=function(){return l(this,void 0,void 0,(function(){var t,e;return g(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},Sd.prototype.Xo=function(t){return l(this,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},Sd.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},Sd.prototype.tc=function(){return l(this,void 0,void 0,(function(){var t,e;return g(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))},Sd),wd=(_d.prototype.lookup=function(t){return l(this,void 0,void 0,(function(){var e,n=this;return g(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new jr(Br.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,a){return l(this,void 0,void 0,(function(){var t,e,n,i,r;return g(this,(function(o){switch(o.label){case 0:return e=Ca((t=s).R)+"/documents",n={documents:a.map((function(e){return Sa(t.R,e)}))},[4,t.$i("BatchGetDocuments",e,n)];case 1:return n=o.sent(),i=new Map,n.forEach((function(e){var n;n=t.R,e="found"in(e=e)?function(t,e){$r(!!e.found),e.found.name,e.found.updateTime;var n=Aa(t,e.found.name);return t=Ta(e.found.updateTime),e=new Hi({mapValue:{fields:e.found.fields}}),Wi.newFoundDocument(n,t,e)}(n,e):"missing"in e?function(t,e){return $r(!!e.missing),$r(!!e.readTime),t=Aa(t,e.missing),e=Ta(e.readTime),Wi.newNoDocument(t,e)}(n,e):Xr(),i.set(e.key.toString(),e)})),r=[],[2,(a.forEach((function(t){$r(!!(t=i.get(t.toString()))),r.push(t)})),r)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},_d.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},_d.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},_d.prototype.delete=function(t){this.write(new Ps(t,this.precondition(t))),this.writtenDocs.add(t.toString())},_d.prototype.commit=function(){return l(this,void 0,void 0,(function(){var t,e=this;return g(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){n=Ri.fromPath(n),e.mutations.push(new Ms(n,e.precondition(n)))})),[4,function(i,t){return l(this,void 0,void 0,(function(){var e,n,r;return g(this,(function(o){switch(o.label){case 0:return n=Ca((e=i).R)+"/documents",r={writes:t.map((function(t){return Oa(e.R,t)}))},[4,e.Ni("Commit",n,r)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},_d.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Xr();e=ii.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new jr(Br.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},_d.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?gs.updateTime(e):gs.none()},_d.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return gs.exists(!0);if(e.isEqual(ii.min()))throw new jr(Br.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return gs.updateTime(e)},_d.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},_d.prototype.ensureCommitNotCalled=function(){},_d),bd=(Id.prototype.run=function(){--this.ec,this.nc()},Id.prototype.nc=function(){var t=this;this.Zi.ji((function(){return l(t,void 0,void 0,(function(){var t,e,n=this;return g(this,(function(r){return t=new wd(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},Id.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Ni(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},Id.prototype.ic=function(t){var e=this;0<this.ec&&this.rc(t)?(--this.ec,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},Id.prototype.rc=function(t){return"FirebaseError"===t.name&&("aborted"===(t=t.code)||"failed-precondition"===t||!Us(t))},Id),Ed=(Td.prototype.getConfiguration=function(){return l(this,void 0,void 0,(function(){return g(this,(function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}))}))},Td.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},Td.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new jr(Br.FAILED_PRECONDITION,"The client has already been terminated.")},Td.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new pu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return l(t,void 0,void 0,(function(){var t;return g(this,(function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:n.sent(),n.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=hf(t=n.sent(),"Failed to shutdown persistence"),e.reject(t),[3,6];case 6:return[2]}}))}))})),e.promise},Td);function Td(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Vh.UNAUTHENTICATED,this.clientId=Jr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,(function(t){return l(r,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return Hr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}}))}))}))}function Id(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Rl(this.asyncQueue,"transaction_retry")}function _d(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}function Sd(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new pu,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}function Ad(t){this.observer=t,this.muted=!1}function Dd(i,t){return l(this,void 0,void 0,(function(){var e,n,r=this;return g(this,(function(o){switch(o.label){case 0:return i.asyncQueue.verifyOperationInProgress(),Hr("FirestoreClient","Initializing OfflineComponentProvider"),[4,i.getConfiguration()];case 1:return e=o.sent(),[4,t.initialize(e)];case 2:return o.sent(),n=e.initialUser,i.setCredentialChangeListener((function(e){return l(r,void 0,void 0,(function(){return g(this,(function(r){switch(r.label){case 0:return n.isEqual(e)?[3,2]:[4,yh(t.localStore,e)];case 1:r.sent(),n=e,r.label=2;case 2:return[2]}}))}))})),t.persistence.setDatabaseDeletedListener((function(){return i.terminate()})),i.offlineComponents=t,[2]}}))}))}function Nd(t,i){return l(this,void 0,void 0,(function(){var e,n;return g(this,(function(r){switch(r.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Cd(t)];case 1:return e=r.sent(),Hr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return n=r.sent(),[4,i.initialize(e,n)];case 3:return r.sent(),t.setCredentialChangeListener((function(t){return function(t,i){return l(this,void 0,void 0,(function(){var e,n;return g(this,(function(r){switch(r.label){case 0:return(e=t).asyncQueue.verifyOperationInProgress(),Hr("RemoteStore","RemoteStore received new credentials"),n=Xl(e),e.Or.add(3),[4,Kl(e)];case 1:return r.sent(),n&&e.Br.set("Unknown"),[4,e.remoteSyncer.handleCredentialChange(i)];case 2:return r.sent(),e.Or.delete(3),[4,jl(e)];case 3:return r.sent(),[2]}}))}))}(i.remoteStore,t)})),t.onlineComponents=i,[2]}}))}))}function Cd(t){return l(this,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Hr("FirestoreClient","Using default OfflineComponentProvider"),[4,Dd(t,new ud)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function kd(t){return l(this,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Hr("FirestoreClient","Using default OnlineComponentProvider"),[4,Nd(t,new ld)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function Rd(t){return Cd(t).then((function(t){return t.persistence}))}function xd(t){return Cd(t).then((function(t){return t.localStore}))}function Od(t){return kd(t).then((function(t){return t.remoteStore}))}function Ld(t){return kd(t).then((function(t){return t.syncEngine}))}function Pd(t){return l(this,void 0,void 0,(function(){var e,n;return g(this,(function(r){switch(r.label){case 0:return[4,kd(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=function(s,a){return l(this,void 0,void 0,(function(){var t,e,n,i,r;return g(this,(function(o){switch(o.label){case 0:return t=td(s),(r=t.Po.get(a))?(e=r.targetId,t.sharedClientState.addLocalQueryTarget(e),n=r.view.Ro(),[3,4]):[3,1];case 1:return[4,bh(t.localStore,Bo(a))];case 2:return i=o.sent(),r=t.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,Uf(t,a,e,"current"===r)];case 3:n=o.sent(),t.isPrimaryClient&&Gl(t.remoteStore,i),o.label=4;case 4:return[2,n]}}))}))}.bind(null,e.syncEngine),n.onUnlisten=function(i,t){return l(this,void 0,void 0,(function(){var e,n,r;return g(this,(function(o){switch(o.label){case 0:return n=(e=i).Po.get(t),1<(r=e.Vo.get(n.targetId)).length?[2,(e.Vo.set(n.targetId,r.filter((function(e){return!Ko(e,t)}))),void e.Po.delete(t))]:e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)?[3,2]:[4,Eh(e.localStore,n.targetId,!1).then((function(){e.sharedClientState.clearQueryState(n.targetId),Ql(e.remoteStore,n.targetId),zf(e,n.targetId)})).catch(Nc)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return zf(e,n.targetId),[4,Eh(e.localStore,n.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}.bind(null,e.syncEngine),n)]}}))}))}function Md(t,e,i){var n=this;void 0===i&&(i={});var r=new pu;return t.asyncQueue.enqueueAndForget((function(){return l(n,void 0,void 0,(function(){var n;return g(this,(function(o){switch(o.label){case 0:return n=function(t,e,i,n,s){var r=new md({next:function(r){e.enqueueAndForget((function(){return bf(t,a)}));var o=r.docs.has(i);!o&&r.fromCache?s.reject(new jr(Br.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&r.fromCache&&n&&"server"===n.source?s.reject(new jr(Br.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(r)},error:function(t){return s.reject(t)}}),a=new Tf(Lo(i.path),r,{includeMetadataChanges:!0,so:!0});return wf(t,a)},[4,Pd(t)];case 1:return[2,n.apply(void 0,[o.sent(),t.asyncQueue,e,i,r])]}}))}))})),r.promise}function Fd(t,e,i){var n=this;void 0===i&&(i={});var r=new pu;return t.asyncQueue.enqueueAndForget((function(){return l(n,void 0,void 0,(function(){var n;return g(this,(function(o){switch(o.label){case 0:return n=function(t,e,n,r,i){var o=new md({next:function(n){e.enqueueAndForget((function(){return bf(t,s)})),n.fromCache&&"server"===r.source?i.reject(new jr(Br.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Tf(n,o,{includeMetadataChanges:!0,so:!0});return wf(t,s)},[4,Pd(t)];case 1:return[2,n.apply(void 0,[o.sent(),t.asyncQueue,e,i,r])]}}))}))})),r.promise}function Vd(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t}var Ud=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},qd=(Object.defineProperty(Jd.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Jd.prototype.isEqual=function(t){return t instanceof Jd&&t.projectId===this.projectId&&t.database===this.database},Jd),Bd=new Map,jd=($d.prototype.getToken=function(){return Promise.resolve(null)},$d.prototype.invalidateToken=function(){},$d.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable((function(){return e(Vh.UNAUTHENTICATED)}))},$d.prototype.removeChangeListener=function(){this.changeListener=null},$d),Kd=(Xd.prototype.getToken=function(){return Promise.resolve(this.token)},Xd.prototype.invalidateToken=function(){},Xd.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable((function(){return e(n.token.user)}))},Xd.prototype.removeChangeListener=function(){this.changeListener=null},Xd),Gd=(Yd.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(Hr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?($r("string"==typeof n.accessToken),new Vd(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},Yd.prototype.invalidateToken=function(){this.forceRefresh=!0},Yd.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable((function(){return l(n,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}}))}))}))},Yd.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},Yd.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return $r(null===t||"string"==typeof t),new Vh(t)},Yd),Qd=(Object.defineProperty(Wd.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),Wd),Hd=(zd.prototype.getToken=function(){return Promise.resolve(new Qd(this.hc,this.lc,this.fc))},zd.prototype.setChangeListener=function(t,e){t.enqueueRetryable((function(){return e(Vh.FIRST_PARTY)}))},zd.prototype.removeChangeListener=function(){},zd.prototype.invalidateToken=function(){},zd);function zd(t,e,n){this.hc=t,this.lc=e,this.fc=n}function Wd(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Vh.FIRST_PARTY}function Yd(t){var e=this;function n(t){Hr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)}this.currentUser=Vh.UNAUTHENTICATED,this.oc=new pu,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable((function(){return e.changeListener(e.currentUser)}))},t.onInit(n),setTimeout((function(){var r;e.auth||((r=t.getImmediate({optional:!0}))?n(r):(Hr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve()))}),0)}function Xd(t){this.token=t,this.changeListener=null}function $d(){this.changeListener=null}function Jd(t,e){this.projectId=t,this.database=e||"(default)"}function Zd(t,e,n){if(!n)throw new jr(Br.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function tp(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new jr(Br.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function ep(t,e,n,r){if(!0===e&&!0===r)throw new jr(Br.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function np(t){if(!Ri.isDocumentKey(t))throw new jr(Br.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function ip(t){if(Ri.isDocumentKey(t))throw new jr(Br.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function op(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Xr();if(t instanceof Array)return"an array";var e=function(){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}();return e?"a custom "+e+" object":"an object"}function sp(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new jr(Br.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");throw t=op(t),new jr(Br.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function rp(t,e){if(e<=0)throw new jr(Br.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var ap,up=(mp.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},mp),cp=(Object.defineProperty(gp.prototype,"app",{get:function(){if(!this._app)throw new jr(Br.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(gp.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(gp.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),gp.prototype._setSettings=function(t){if(this._settingsFrozen)throw new jr(Br.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new up(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new jd;switch(t.type){case"gapi":var e=t.client;return $r(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Hd(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new jr(Br.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},gp.prototype._getSettings=function(){return this._settings},gp.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},gp.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},gp.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},gp.prototype._terminate=function(){return(t=Bd.get(this))&&(Hr("ComponentProvider","Removing Datastore"),Bd.delete(this),t.terminate()),Promise.resolve();var t},gp),hp=(Object.defineProperty(yp.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(yp.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(yp.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(yp.prototype,"parent",{get:function(){return new fp(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),yp.prototype.withConverter=function(t){return new yp(this.firestore,t,this._key)},yp),lp=(pp.prototype.withConverter=function(t){return new pp(this.firestore,t,this._query)},pp),fp=(h(dp,ap=lp),Object.defineProperty(dp.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(dp.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(dp.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new hp(this.firestore,null,new Ri(t))},enumerable:!1,configurable:!0}),dp.prototype.withConverter=function(t){return new dp(this.firestore,t,this._path)},dp);function dp(t,e,n){var r=this;return(r=ap.call(this,t,e,Lo(n))||this)._path=n,r.type="collection",r}function pp(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}function yp(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}function gp(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new up({}),this._settingsFrozen=!1,t instanceof qd?(this._databaseId=t,this._credentials=new jd):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new jr(Br.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new qd(t.options.projectId)}(t),this._credentials=new Gd(e))}function mp(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new jr(Br.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new jr(Br.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,ep("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function vp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=_(t),Zd("collection","path",e),t instanceof cp)return ip(n=di.fromString.apply(di,s([e],r))),new fp(t,null,n);if(!(t instanceof hp||t instanceof fp))throw new jr(Br.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return ip(n=di.fromString.apply(di,s([t.path],r)).child(di.fromString(e))),new fp(t.firestore,null,n)}function wp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=_(t),Zd("doc","path",e=1===arguments.length?Jr.u():e),t instanceof cp)return np(n=di.fromString.apply(di,s([e],r))),new hp(t,null,new Ri(n));if(!(t instanceof hp||t instanceof fp))throw new jr(Br.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return np(n=t._path.child(di.fromString.apply(di,s([e],r)))),new hp(t.firestore,t instanceof fp?t.converter:null,new Ri(n))}function bp(t,e){return t=_(t),e=_(e),(t instanceof hp||t instanceof fp)&&(e instanceof hp||e instanceof fp)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Ep(t,e){return t=_(t),e=_(e),t instanceof lp&&e instanceof lp&&t.firestore===e.firestore&&Ko(t._query,e._query)&&t.converter===e.converter}var Tp=(Object.defineProperty(Ip.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),Ip.prototype.enqueueAndForget=function(t){this.enqueue(t)},Ip.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},Ip.prototype.enterRestrictedMode=function(t){this._c||(this._c=!0,this.Ec=t||!1,(t=Sl())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ic))},Ip.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise((function(){}));var n=new pu;return this.Rc((function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))},Ip.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.wc.push(t),e.bc()}))},Ip.prototype.bc=function(){return l(this,void 0,void 0,(function(){var t,e=this;return g(this,(function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Au(t=n.sent()))throw t;return Hr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:0<this.wc.length&&this.Zi.ji((function(){return e.bc()})),n.label=5;case 5:return[2]}}))}))},Ip.prototype.Rc=function(t){var e=this,n=this.dc.then((function(){return e.gc=!0,t().catch((function(t){throw e.yc=t,e.gc=!1,zr("INTERNAL UNHANDLED ERROR: ",(r=(n=t).message||"",r=n.stack?n.stack.includes(n.message)?n.stack:n.message+"\n"+n.stack:r)),t;var n,r})).then((function(t){return e.gc=!1,t}))}));return this.dc=n},Ip.prototype.enqueueAfterDelay=function(t,e,n){var r=this;return this.Ac(),-1<this.Tc.indexOf(t)&&(e=0),n=uf.createAndSchedule(this,t,e,n,(function(t){return r.vc(t)})),this.mc.push(n),n},Ip.prototype.Ac=function(){this.yc&&Xr()},Ip.prototype.verifyOperationInProgress=function(){},Ip.prototype.Pc=function(){return l(this,void 0,void 0,(function(){var t;return g(this,(function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}}))}))},Ip.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Ip.prototype.Sc=function(t){var i=this;return this.Pc().then((function(){i.mc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var e=0,n=i.mc;e<n.length;e++){var r=n[e];if(r.skipDelay(),"all"!==t&&r.timerId===t)break}return i.Pc()}))},Ip.prototype.Dc=function(t){this.Tc.push(t)},Ip.prototype.vc=function(t){t=this.mc.indexOf(t),this.mc.splice(t,1)},Ip);function Ip(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new Rl(this,"async_queue_retry"),this.Ic=function(){var e=Sl();e&&Hr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Sl();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}function _p(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Sp,Ap=(Cp.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},Cp.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},Cp.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},Cp.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},Cp.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},Cp.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},Cp),Dp=(h(Np,Sp=cp),Np.prototype._terminate=function(){return this._firestoreClient||Rp(this),this._firestoreClient.terminate()},Np);function Np(t,e){var n=this;return(n=Sp.call(this,t,e)||this).type="firestore",n._queue=new Tp,n._persistenceKey="name"in t?t.name:"[DEFAULT]",n}function Cp(){this._progressObserver={},this._taskCompletionResolver=new pu,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function kp(t){return t._firestoreClient||Rp(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Rp(t){var e,n,r,i=t._freezeSettings();e=t._databaseId,n=(null===(r=t._app)||void 0===r?void 0:r.options.appId)||"",r=t._persistenceKey,i=new Ud(e,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams),t._firestoreClient=new Ed(t._credentials,t._queue,i)}function xp(t,e,i){var n=this,r=new pu;return t.asyncQueue.enqueue((function(){return l(n,void 0,void 0,(function(){var n;return g(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Dd(t,i)];case 1:return o.sent(),[4,Nd(t,e)];case 2:return o.sent(),r.resolve(),[3,4];case 3:if(!("FirebaseError"===(n=o.sent()).name?n.code===Br.FAILED_PRECONDITION||n.code===Br.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw n;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+n),r.reject(n),[3,4];case 4:return[2]}}))}))})).then((function(){return r.promise}))}function Op(t){if(t._initialized||t._terminated)throw new jr(Br.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Lp=(Qp.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},Qp),Pp=(Gp.fromBase64String=function(t){try{return new Gp(gi.fromBase64String(t))}catch(t){throw new jr(Br.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},Gp.fromUint8Array=function(t){return new Gp(gi.fromUint8Array(t))},Gp.prototype.toBase64=function(){return this._byteString.toBase64()},Gp.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},Gp.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Gp.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},Gp),Mp=function(t){this._methodName=t},Fp=(Object.defineProperty(Kp.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(Kp.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),Kp.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},Kp.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},Kp.prototype._compareTo=function(t){return ti(this._lat,t._lat)||ti(this._long,t._long)},Kp),Vp=/^__.*__$/,Up=(jp.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Ss(t,this.data,this.fieldMask,e,this.fieldTransforms):new _s(t,this.data,e,this.fieldTransforms)},jp),qp=(Bp.prototype.toMutation=function(t,e){return new Ss(t,this.data,this.fieldMask,e,this.fieldTransforms)},Bp);function Bp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function jp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function Kp(t,e){if(!isFinite(t)||t<-90||90<t)throw new jr(Br.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new jr(Br.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}function Gp(t){this._byteString=t}function Qp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new jr(Br.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new li(t)}function Hp(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Xr()}}var zp=(Object.defineProperty(Xp.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Xp.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),Xp.prototype.xc=function(t){return new Xp(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},Xp.prototype.kc=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t);return(e=this.xc({path:e,Fc:!1})).$c(t),e},Xp.prototype.Oc=function(t){var e;return t=null===(e=this.path)||void 0===e?void 0:e.child(t),(t=this.xc({path:t,Fc:!1})).Cc(),t},Xp.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},Xp.prototype.Lc=function(t){return Sy(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},Xp.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},Xp.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},Xp.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(Hp(this.Nc)&&Vp.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},Xp),Wp=(Yp.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new zp({Nc:t,methodName:e,qc:n,path:li.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},Yp);function Yp(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Al(t)}function Xp(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}function $p(t){var e=t._freezeSettings(),n=Al(t._databaseId);return new Wp(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Jp(t,e,n,r,i,o){var a,u,s=t.Uc((o=void 0===o?{}:o).merge||o.mergeFields?2:0,e,n,i);if(Ey("Data must be an object, but it was:",s,r),r=wy(r,s),o.merge)a=new yi(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=Ty(e,l[h],n);if(!s.contains(f))throw new jr(Br.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Ay(c,f)||c.push(f)}a=new yi(c),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new Up(new Hi(r),a,u)}var Zp,ty=(h(ey,Zp=Mp),ey.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw 1===t.Nc?t.Lc(this._methodName+"() can only appear at the top level of your update data"):t.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},ey.prototype.isEqual=function(t){return t instanceof ey},ey);function ey(){return null!==Zp&&Zp.apply(this,arguments)||this}function ny(t,e,n){return new zp({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var ry,iy,oy,sy,ay=(h(py,sy=Mp),py.prototype._toFieldTransform=function(t){return new ys(t.path,new ts)},py.prototype.isEqual=function(t){return t instanceof py},py),uy=(h(dy,oy=Mp),dy.prototype._toFieldTransform=function(t){var e=ny(this,t,!0),n=this.Kc.map((function(t){return vy(t,e)}));return n=new es(n),new ys(t.path,n)},dy.prototype.isEqual=function(t){return this===t},dy),cy=(h(fy,iy=Mp),fy.prototype._toFieldTransform=function(t){var e=ny(this,t,!0),n=this.Kc.map((function(t){return vy(t,e)}));return n=new ss(n),new ys(t.path,n)},fy.prototype.isEqual=function(t){return this===t},fy),hy=(h(ly,ry=Mp),ly.prototype._toFieldTransform=function(t){var e=new hs(t.R,Xo(t.R,this.Qc));return new ys(t.path,e)},ly.prototype.isEqual=function(t){return this===t},ly);function ly(t,e){var n=this;return(n=ry.call(this,t)||this).Qc=e,n}function fy(t,e){var n=this;return(n=iy.call(this,t)||this).Kc=e,n}function dy(t,e){var n=this;return(n=oy.call(this,t)||this).Kc=e,n}function py(){return null!==sy&&sy.apply(this,arguments)||this}function yy(t,e,i,n){var r=t.Uc(1,e,i);Ey("Data must be an object, but it was:",r,n);var s=[],a=Hi.empty();return ui(n,(function(t,n){var o=_y(e,t,i);n=_(n),t=r.Oc(o),n instanceof ty?s.push(o):null!=(t=vy(n,t))&&(s.push(o),a.set(o,t))})),n=new yi(s),new qp(a,n,r.fieldTransforms)}function gy(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[Ty(e,r,n)],u=[i];if(o.length%2!=0)throw new jr(Br.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Ty(e,o[c])),u.push(o[c+1]);for(var h,l,f,d=[],p=Hi.empty(),y=a.length-1;0<=y;--y)Ay(d,a[y])||(h=a[y],l=_(l=u[y]),f=s.Oc(h),l instanceof ty?d.push(h):null!=(f=vy(l,f))&&(d.push(h),p.set(h,f)));return i=new yi(d),new qp(p,i,s.fieldTransforms)}function my(t,e,n,r){return vy(n,t.Uc((r=void 0!==r&&r)?4:3,e))}function vy(s,t){if(by(s=_(s)))return Ey("Unsupported field value:",t,s),wy(s,t);if(s instanceof Mp)return function(t,e){if(!Hp(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");(t=t._toFieldTransform(e))&&e.fieldTransforms.push(t)}(s,t),null;if(void 0===s&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),s instanceof Array){if(t.settings.Fc&&4!==t.Nc)throw t.Lc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=vy(i[r],t.Mc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===(t=_(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Xo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ri.fromDate(t);return{timestampValue:ba(e.R,n)}}if(t instanceof ri)return n=new ri(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ba(e.R,n)};if(t instanceof Fp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Pp)return{bytesValue:Ea(e.R,t._byteString)};if(t instanceof hp){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Ia(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+op(t))}(0,t)}function wy(t,e){var n={};return ci(t)?e.path&&0<e.path.length&&e.fieldMask.push(e.path):ui(t,(function(t,r){null!=(r=vy(r,e.kc(t)))&&(n[t]=r)})),{mapValue:{fields:n}}}function by(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ri||t instanceof Fp||t instanceof Pp||t instanceof hp||t instanceof Mp)}function Ey(t,e,n){if(!by(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(n=op(n))?e.Lc(t+" a custom object"):e.Lc(t+" "+n);var r}function Ty(t,e,n){if((e=_(e))instanceof Lp)return e._internalPath;if("string"==typeof e)return _y(t,e);throw Sy("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Iy=new RegExp("[~\\*/\\[\\]]");function _y(t,e,n){if(0<=e.search(Iy))throw Sy("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Lp.bind.apply(Lp,s([void 0],e.split(".")))))._internalPath}catch(r){throw Sy("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Sy(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i;return e="Function "+e+"() called with invalid data",n&&(e+=" (via `toFirestore()`)"),n="",(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new jr(Br.INVALID_ARGUMENT,(e+=". ")+t+n)}function Ay(t,e){return t.some((function(t){return t.isEqual(e)}))}var Dy,Ny=(Object.defineProperty(Ry.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Ry.prototype,"ref",{get:function(){return new hp(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),Ry.prototype.exists=function(){return null!==this._document},Ry.prototype.data=function(){if(this._document){if(this._converter){var t=new Cy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},Ry.prototype.get=function(t){if(this._document&&null!==(t=this._document.data.field(xy("DocumentSnapshot.get",t))))return this._userDataWriter.convertValue(t)},Ry),Cy=(h(ky,Dy=Ny),ky.prototype.data=function(){return Dy.prototype.data.call(this)},ky);function ky(){return null!==Dy&&Dy.apply(this,arguments)||this}function Ry(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}function xy(t,e){return"string"==typeof e?_y(t,e):(e instanceof Lp?e:e._delegate)._internalPath}var Oy,Ly,Py=(jy.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},jy),My=(h(By,Ly=Ny),By.prototype.exists=function(){return Ly.prototype.exists.call(this)},By.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Fy(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},By.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document&&null!==(t=this._document.data.field(xy("DocumentSnapshot.get",t))))return this._userDataWriter.convertValue(t,e.serverTimestamps)},By),Fy=(h(qy,Oy=My),qy.prototype.data=function(t){return Oy.prototype.data.call(this,t=void 0===t?{}:t)},qy),Vy=(Object.defineProperty(Uy.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(Uy.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(Uy.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),Uy.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new Fy(n._firestore,n._userDataWriter,r.key,r,new Py(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},Uy.prototype.docChanges=function(t){if((t=!!(t=void 0===t?{}:t).includeMetadataChanges)&&this._snapshot.excludesMetadataChanges)throw new jr(Br.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,t){if(i._snapshot.oldDocs.isEmpty()){var e=0;return i._snapshot.docChanges.map((function(t){return{type:"added",doc:new Fy(i._firestore,i._userDataWriter,t.doc.key,t.doc,new Py(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:e++}}))}var n=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((function(e){return t||3!==e.type})).map((function(t){var e=new Fy(i._firestore,i._userDataWriter,t.doc.key,t.doc,new Py(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query.converter),r=-1,o=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(o=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xr()}}(t.type),doc:e,oldIndex:r,newIndex:o}}))}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},Uy);function Uy(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Py(r.hasPendingWrites,r.fromCache),this.query=n}function qy(){return null!==Oy&&Oy.apply(this,arguments)||this}function By(t,e,n,r,i,o){var s=this;return(s=Ly.call(this,t,e,n,r,o)||this)._firestore=t,s._firestoreImpl=t,s.metadata=i,s}function jy(t,e){this.hasPendingWrites=t,this.fromCache=e}function Ky(t,e){return t instanceof My&&e instanceof My?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Vy&&e instanceof Vy&&t._firestore===e._firestore&&Ep(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Gy(t){if(Mo(t)&&0===t.explicitOrderBy.length)throw new jr(Br.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function Qy(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var Hy,zy,Wy,Yy,Xy,$y=(h(sg,Xy=L=function(){}),sg.prototype._apply=function(t){var e=$p(t.firestore);return e=function(t,e,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new jr(Br.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){cg(o,i);for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];s.push(ug(n,t,c))}h={arrayValue:{values:s}}}else h=ug(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||cg(o,i),h=my(e,"where",o,"in"===i||"not-in"===i);var h=no.create(r,i,h);return function(t,e){if(e.g()){var n=Vo(t);if(null!==n&&!n.isEqual(e.field))throw new jr(Br.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");null!==(n=Fo(t))&&hg(0,e.field,n)}if(null!==(t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}())))throw t===e.op?new jr(Br.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new jr(Br.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t._query,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc),new lp(t.firestore,t.converter,(e=(t=t._query).filters.concat([e]),new xo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},sg),Jy=(h(og,Yy=L),og.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new jr(Br.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new jr(Br.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Co(e,n);return e=r,null!==Fo(n=t)||null!==(t=Vo(n))&&hg(0,t,e.field),r}(t._query,this.jc,this.zc);return new lp(t.firestore,t.converter,(e=(t=t._query).explicitOrderBy.concat([e]),new xo(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},og),Zy=(h(ig,Wy=L),ig.prototype._apply=function(t){return new lp(t.firestore,t.converter,jo(t._query,this.Hc,this.Jc))},ig),tg=(h(rg,zy=L),rg.prototype._apply=function(t){var e=ag(t,this.type,this.Yc,this.Xc);return new lp(t.firestore,t.converter,(t=t._query,e=e,new xo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},rg),eg=(h(ng,Hy=L),ng.prototype._apply=function(t){var e=ag(t,this.type,this.Yc,this.Xc);return new lp(t.firestore,t.converter,(t=t._query,e=e,new xo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},ng);function ng(t,e,n){var r=this;return(r=Hy.call(this)||this).type=t,r.Yc=e,r.Xc=n,r}function rg(t,e,n){var r=this;return(r=zy.call(this)||this).type=t,r.Yc=e,r.Xc=n,r}function ig(t,e,n){var r=this;return(r=Wy.call(this)||this).type=t,r.Hc=e,r.Jc=n,r}function og(t,e){var n=this;return(n=Yy.call(this)||this).jc=t,n.zc=e,n.type="orderBy",n}function sg(t,e,n){var r=this;return(r=Xy.call(this)||this).jc=t,r.Wc=e,r.Gc=n,r.type="where",r}function ag(t,e,n,r){if(n[0]=_(n[0]),n[0]instanceof Ny)return function(t,n,r,o){if(!r)throw new jr(Br.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+e+"().");for(var i=[],c=0,s=qo(t);c<s.length;c++){var a=s[c];if(a.field.isKeyField())i.push(Ui(n,r.key));else{var u=r.data.field(a.field);if(Ai(u))throw new jr(Br.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u)throw a=a.field.canonicalString(),new jr(Br.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.");i.push(u)}}return new Io(i,o)}(t._query,t.firestore._databaseId,n[0]._document,r);var o=$p(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new jr(Br.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new jr(Br.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Uo(t)&&-1!==c.indexOf("/"))throw new jr(Br.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(di.fromString(c));if(!Ri.isDocumentKey(h))throw new jr(Br.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new Ri(h),a.push(Ui(e,h))}else c=my(n,r,c),a.push(c)}return new Io(a,o)}(t._query,t.firestore._databaseId,o,e,n,r)}function ug(t,e,n){if("string"==typeof(n=_(n))){if(""===n)throw new jr(Br.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Uo(e)&&-1!==n.indexOf("/"))throw new jr(Br.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");if(e=e.path.child(di.fromString(n)),!Ri.isDocumentKey(e))throw new jr(Br.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Ui(t,new Ri(e))}if(n instanceof hp)return Ui(t,n._key);throw new jr(Br.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+op(n)+".")}function cg(t,e){if(!Array.isArray(t)||0===t.length)throw new jr(Br.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new jr(Br.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function hg(t,e,n){if(!n.isEqual(e))throw new jr(Br.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function lg(){}function fg(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}lg.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Oi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return _i(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Si(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Xr()}},lg.prototype.convertObject=function(t,e){var n=this,i={};return ui(t.fields,(function(t,r){i[t]=n.convertValue(r,e)})),i},lg.prototype.convertGeoPoint=function(t){return new Fp(_i(t.latitude),_i(t.longitude))},lg.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},lg.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){return Ai(e=e.mapValue.fields.__previous_value__)?t(e):e}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Di(t));default:return null}},lg.prototype.convertTimestamp=function(t){return t=Ii(t),new ri(t.seconds,t.nanos)},lg.prototype.convertDocumentKey=function(t,e){var n=di.fromString(t);return $r(Ga(n)),t=new qd(n.get(1),n.get(3)),n=new Ri(n.popFirst(5)),t.isEqual(e)||zr("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n};var dg,pg=(h(mg,dg=C=lg),mg.prototype.convertBytes=function(t){return new Pp(t)},mg.prototype.convertReference=function(t){return t=this.convertDocumentKey(t,this.firestore._databaseId),new hp(this.firestore,null,t)},mg),yg=(gg.prototype.set=function(t,e,n){return this._verifyNotCommitted(),e=fg((t=vg(t,this._firestore)).converter,e,n),n=Jp(this._dataReader,"WriteBatch.set",t._key,e,null!==t.converter,n),this._mutations.push(n.toMutation(t._key,gs.none())),this},gg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return this._verifyNotCommitted(),t=vg(t,this._firestore),e="string"==typeof(e=_(e))||e instanceof Lp?gy(this._dataReader,"WriteBatch.update",t._key,e,n,r):yy(this._dataReader,"WriteBatch.update",t._key,e),this._mutations.push(e.toMutation(t._key,gs.exists(!0))),this},gg.prototype.delete=function(t){return this._verifyNotCommitted(),t=vg(t,this._firestore),this._mutations=this._mutations.concat(new Ps(t._key,gs.none())),this},gg.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},gg.prototype._verifyNotCommitted=function(){if(this._committed)throw new jr(Br.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},gg);function gg(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=$p(t)}function mg(t){var e=this;return(e=dg.call(this)||this).firestore=t,e}function vg(t,e){if((t=_(t)).firestore!==e)throw new jr(Br.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var wg,bg=(h(Eg,wg=C),Eg.prototype.convertBytes=function(t){return new Pp(t)},Eg.prototype.convertReference=function(t){return t=this.convertDocumentKey(t,this.firestore._databaseId),new hp(this.firestore,null,t)},Eg);function Eg(t){var e=this;return(e=wg.call(this)||this).firestore=t,e}function Tg(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=sp(t,hp);var o=sp(t.firestore,Dp),s=$p(o);return _g(o,[("string"==typeof(e=_(e))||e instanceof Lp?gy(s,"updateDoc",t._key,e,n,r):yy(s,"updateDoc",t._key,e)).toMutation(t._key,gs.exists(!0))])}function Ig(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t=_(t);var r={includeMetadataChanges:!1},i=0;"object"!=typeof e[i]||_p(e[i])||(r=e[i],i++);var o,s,a,u,c,h,f={includeMetadataChanges:r.includeMetadataChanges};return _p(e[i])&&(o=e[i],e[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),e[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),e[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),t instanceof hp?(a=sp(t.firestore,Dp),u=Lo(t._key.path),h={next:function(n){e[i]&&e[i](Sg(a,t,n))},error:e[i+1],complete:e[i+2]}):(s=sp(t,lp),a=sp(s.firestore,Dp),u=s._query,c=new bg(a),h={next:function(t){e[i]&&e[i](new Vy(a,c,s,t))},error:e[i+1],complete:e[i+2]},Gy(t._query)),function(t,e,n){var r=this,i=new md(h),o=new Tf(e,i,n);return t.asyncQueue.enqueueAndForget((function(){return l(r,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:return e=wf,[4,Pd(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))})),function(){i.Wo(),t.asyncQueue.enqueueAndForget((function(){return l(r,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:return e=bf,[4,Pd(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))}))}}(kp(a),u,f)}function _g(t,e){return function(t,e){var n=this,i=new pu;return t.asyncQueue.enqueueAndForget((function(){return l(n,void 0,void 0,(function(){var n;return g(this,(function(r){switch(r.label){case 0:return n=qf,[4,Ld(t)];case 1:return[2,n.apply(void 0,[r.sent(),e,i])]}}))}))})),i.promise}(kp(t),e)}function Sg(t,e,n){var r=n.docs.get(e._key),i=new bg(t);return new My(t,i,e._key,r,new Py(n.hasPendingWrites,n.fromCache),e.converter)}var Ag,Dg=(Cg.prototype.get=function(t){var e=this,n=vg(t,this._firestore),r=new pg(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Xr();if((t=t[0]).isFoundDocument())return new Ny(e._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new Ny(e._firestore,r,n._key,null,n.converter);throw Xr()}))},Cg.prototype.set=function(t,e,n){return e=fg((t=vg(t,this._firestore)).converter,e,n),n=Jp(this._dataReader,"Transaction.set",t._key,e,null!==t.converter,n),this._transaction.set(t._key,n),this},Cg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return t=vg(t,this._firestore),e="string"==typeof(e=_(e))||e instanceof Lp?gy(this._dataReader,"Transaction.update",t._key,e,n,r):yy(this._dataReader,"Transaction.update",t._key,e),this._transaction.update(t._key,e),this},Cg.prototype.delete=function(t){return t=vg(t,this._firestore),this._transaction.delete(t._key),this},h(Ng,Ag=Cg),Ng.prototype.get=function(t){var e=this,n=vg(t,this._firestore),r=new bg(this._firestore);return Ag.prototype.get.call(this,t).then((function(t){return new My(e._firestore,r,n._key,t._document,new Py(!1,!1),n.converter)}))},Ng);function Ng(t,e){var n=this;return(n=Ag.call(this,t,e)||this)._firestore=t,n}function Cg(t,e){this._firestore=t,this._transaction=e,this._dataReader=$p(t)}function kg(){if("undefined"==typeof Uint8Array)throw new jr(Br.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Rg(){if("undefined"==typeof atob)throw new jr(Br.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var xg,Og=(qg.fromBase64String=function(t){return Rg(),new qg(Pp.fromBase64String(t))},qg.fromUint8Array=function(t){return kg(),new qg(Pp.fromUint8Array(t))},qg.prototype.toBase64=function(){return Rg(),this._delegate.toBase64()},qg.prototype.toUint8Array=function(){return kg(),this._delegate.toUint8Array()},qg.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},qg.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},qg),Lg=(Ug.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Op(t=sp(t,Dp));var n=kp(t),r=t._freezeSettings();return xp(n,t=new ld,new cd(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},Ug.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Op(t=sp(t,Dp));var e=kp(t),n=t._freezeSettings();return xp(e,t=new ld,new hd(t,n.cacheSizeBytes))}(t._delegate)},Ug.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new jr(Br.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new pu;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return l(e,void 0,void 0,(function(){var e;return g(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return l(this,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:return mu.yt()?(e=t+"main",[4,mu.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(ih(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},Ug),Pg=(Object.defineProperty(Vg.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),Vg.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Wr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},Vg.prototype.useEmulator=function(t,e,n){!function(t,e,n,r){void 0===r&&(r={});var i,o=(t=sp(t,cp))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&Wr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),r.mockUserToken){if("string"==typeof r.mockUserToken)s=r.mockUserToken,i=Vh.MOCK_USER;else{var s=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",r=t.iat||0;if(!(e=t.sub||t.user_id))throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return t=a({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:e,user_id:e,firebase:{sign_in_provider:"custom",identities:{}}},t),[u(JSON.stringify({alg:"none",type:"JWT"})),u(JSON.stringify(t)),""].join(".")}(r.mockUserToken,null===(n=t._app)||void 0===n?void 0:n.options.projectId);if(!(r=r.mockUserToken.sub||r.mockUserToken.user_id))throw new jr(Br.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");i=new Vh(r)}t._credentials=new Kd(new Vd(s,i))}}(this._delegate,t,e,n=void 0===n?{}:n)},Vg.prototype.enableNetwork=function(){return function(i){var t=this;return i.asyncQueue.enqueue((function(){return l(t,void 0,void 0,(function(){var t,e;return g(this,(function(n){switch(n.label){case 0:return[4,Rd(i)];case 1:return t=n.sent(),[4,Od(i)];case 2:return e=n.sent(),[2,(t.setNetworkEnabled(!0),(r=e).Or.delete(0),jl(r))]}var r}))}))}))}(kp(sp(this._delegate,Dp)))},Vg.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return l(e,void 0,void 0,(function(){var e,n;return g(this,(function(r){switch(r.label){case 0:return[4,Rd(t)];case 1:return e=r.sent(),[4,Od(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return l(this,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:return(e=t).Or.add(0),[4,Kl(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(kp(sp(this._delegate,Dp)))},Vg.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&ep("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},Vg.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},Vg.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},Vg.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new pu;return t.asyncQueue.enqueueAndForget((function(){return l(e,void 0,void 0,(function(){var e;return g(this,(function(r){switch(r.label){case 0:return e=Gf,[4,Ld(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(kp(sp(this._delegate,Dp)))},Vg.prototype.onSnapshotsInSync=function(t){return t=t,function(t,e){var n=this,r=new md(e);return t.asyncQueue.enqueueAndForget((function(){return l(n,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:return e=function(t,e){t.Gr.add(e),e.next()},[4,Pd(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return l(n,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:return e=function(t,e){t.Gr.delete(e)},[4,Pd(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(kp(sp(this._delegate,Dp)),_p(t)?t:{next:t})},Object.defineProperty(Vg.prototype,"app",{get:function(){if(!this.tu)throw new jr(Br.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),Vg.prototype.collection=function(t){try{return new om(this,vp(this._delegate,t))}catch(t){throw Yg(t,"collection()","Firestore.collection()")}},Vg.prototype.doc=function(t){try{return new zg(this,wp(this._delegate,t))}catch(t){throw Yg(t,"doc()","Firestore.doc()")}},Vg.prototype.collectionGroup=function(t){try{return new rm(this,function(t,e){if(t=sp(t,cp),Zd("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new jr(Br.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new lp(t,null,(e=e,new xo(di.emptyPath(),e)))}(this._delegate,t))}catch(t){throw Yg(t,"collectionGroup()","Firestore.collectionGroup()")}},Vg.prototype.runTransaction=function(t){var e,n=this;return function(t,e){var n=this,i=new pu;return t.asyncQueue.enqueueAndForget((function(){return l(n,void 0,void 0,(function(){var n;return g(this,(function(r){switch(r.label){case 0:return[4,kd(t).then((function(t){return t.datastore}))];case 1:return n=r.sent(),new bd(t.asyncQueue,n,e,i).run(),[2]}}))}))})),i.promise}(kp(e=this._delegate),(function(r){return r=new Dg(e,r),t(new Bg(n,r))}))},Vg.prototype.batch=function(){var t=this;return kp(this._delegate),new jg(new yg(this._delegate,(function(e){return _g(t._delegate,e)})))},Vg.prototype.loadBundle=function(t){throw new jr(Br.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},Vg.prototype.namedQuery=function(t){throw new jr(Br.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},Vg),Mg=(h(Fg,xg=C),Fg.prototype.convertBytes=function(t){return new Og(new Pp(t))},Fg.prototype.convertReference=function(t){return t=this.convertDocumentKey(t,this.firestore._databaseId),zg.eu(t,this.firestore,null)},Fg);function Fg(t){var e=this;return(e=xg.call(this)||this).firestore=t,e}function Vg(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof qd||(this.tu=t)}function Ug(){}function qg(t){this._delegate=t}var Bg=(Hg.prototype.get=function(t){var e=this,n=fm(t);return this._delegate.get(n).then((function(t){return new tm(e._firestore,new My(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},Hg.prototype.set=function(t,e,n){return t=fm(t),n?(tp("Transaction.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Hg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=fm(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},Hg.prototype.delete=function(t){return t=fm(t),this._delegate.delete(t),this},Hg),jg=(Qg.prototype.set=function(t,e,n){return t=fm(t),n?(tp("WriteBatch.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Qg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=fm(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},Qg.prototype.delete=function(t){return t=fm(t),this._delegate.delete(t),this},Qg.prototype.commit=function(){return this._delegate.commit()},Qg),Kg=(Gg.prototype.fromFirestore=function(t,e){return t=new Fy(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null),this._delegate.fromFirestore(new nm(this._firestore,t),null!=e?e:{})},Gg.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},Gg.nu=function(t,e){var n=Gg.su,r=n.get(t);return r||(r=new WeakMap,n.set(t,r)),(n=r.get(e))||(n=new Gg(t,new Mg(t),e),r.set(e,n)),n},Gg);function Gg(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}function Qg(t){this._delegate=t}function Hg(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Mg(t)}Kg.su=new WeakMap;var zg=(Wg.iu=function(t,e,n){if(t.length%2!=0)throw new jr(Br.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new Wg(e,new hp(e._delegate,n,new Ri(t)))},Wg.eu=function(t,e,n){return new Wg(e,new hp(e._delegate,n,t))},Object.defineProperty(Wg.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Wg.prototype,"parent",{get:function(){return new om(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(Wg.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Wg.prototype.collection=function(t){try{return new om(this.firestore,vp(this._delegate,t))}catch(t){throw Yg(t,"collection()","DocumentReference.collection()")}},Wg.prototype.isEqual=function(t){return(t=_(t))instanceof hp&&bp(this._delegate,t)},Wg.prototype.set=function(t,e){e=tp("DocumentReference.set",e);try{return function(t,e,n){t=sp(t,hp);var r=sp(t.firestore,Dp);return e=fg(t.converter,e,n),_g(r,[Jp($p(r),"setDoc",t._key,e,null!==t.converter,n).toMutation(t._key,gs.none())])}(this._delegate,t,e)}catch(t){throw Yg(t,"setDoc()","DocumentReference.set()")}},Wg.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Tg(this._delegate,t):Tg.apply(void 0,s([this._delegate,t,e],n))}catch(t){throw Yg(t,"updateDoc()","DocumentReference.update()")}},Wg.prototype.delete=function(){return _g(sp((t=this._delegate).firestore,Dp),[new Ps(t._key,gs.none())]);var t},Wg.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Xg(e),i=$g(e,(function(e){return new tm(t.firestore,new My(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return Ig(this._delegate,r,i)},Wg.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=sp(t,hp);var e=sp(t.firestore,Dp),n=kp(e),r=new bg(e);return function(t,e){var n=this,i=new pu;return t.asyncQueue.enqueueAndForget((function(){return l(n,void 0,void 0,(function(){var n;return g(this,(function(r){switch(r.label){case 0:return n=function(t,s,a){return l(this,void 0,void 0,(function(){var e,i;return g(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,(r=s,(o=t).persistence.runTransaction("read document","readonly",(function(t){return o.Mn.mn(t,r)})))];case 1:return(i=n.sent()).isFoundDocument()?a.resolve(i):i.isNoDocument()?a.resolve(null):a.reject(new jr(Br.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return e=n.sent(),i=hf(e,"Failed to get document '"+s+" from cache"),a.reject(i),[3,3];case 3:return[2]}var r,o}))}))},[4,xd(t)];case 1:return[2,n.apply(void 0,[r.sent(),e,i])]}}))}))})),i.promise}(n,t._key).then((function(n){return new My(e,r,t._key,n,new Py(null!==n&&n.hasLocalMutations,!0),t.converter)}))}:"server"===(null==t?void 0:t.source)?function(t){t=sp(t,hp);var e=sp(t.firestore,Dp);return Md(kp(e),t._key,{source:"server"}).then((function(n){return Sg(e,t,n)}))}:function(t){t=sp(t,hp);var e=sp(t.firestore,Dp);return Md(kp(e),t._key).then((function(n){return Sg(e,t,n)}))})(this._delegate).then((function(t){return new tm(e.firestore,new My(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},Wg.prototype.withConverter=function(t){return new Wg(this.firestore,t?this._delegate.withConverter(Kg.nu(this.firestore,t)):this._delegate.withConverter(null))},Wg);function Wg(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Mg(t)}function Yg(t,e,n){return t.message=t.message.replace(e,n),t}function Xg(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!_p(r))return r}return{}}function $g(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=_p(t[0])?t[0]:_p(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var Jg,Zg,tm=(Object.defineProperty(lm.prototype,"ref",{get:function(){return new zg(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(lm.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(lm.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(lm.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),lm.prototype.data=function(t){return this._delegate.data(t)},lm.prototype.get=function(t,e){return this._delegate.get(t,e)},lm.prototype.isEqual=function(t){return Ky(this._delegate,t._delegate)},lm),nm=(h(hm,Zg=tm),hm.prototype.data=function(t){return this._delegate.data(t)},hm),rm=(cm.prototype.where=function(t,e,n){try{return new cm(this.firestore,Qy(this._delegate,(r=n,i=e,o=xy("where",t),new $y(o,i,r))))}catch(t){throw Yg(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},cm.prototype.orderBy=function(t,e){try{return new cm(this.firestore,Qy(this._delegate,(n=void 0===e?"asc":e,r=xy("orderBy",t),new Jy(r,n))))}catch(t){throw Yg(t,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},cm.prototype.limit=function(t){try{return new cm(this.firestore,Qy(this._delegate,(rp("limit",e=t),new Zy("limit",e,"F"))))}catch(t){throw Yg(t,"limit()","Query.limit()")}var e},cm.prototype.limitToLast=function(t){try{return new cm(this.firestore,Qy(this._delegate,(rp("limitToLast",e=t),new Zy("limitToLast",e,"L"))))}catch(t){throw Yg(t,"limitToLast()","Query.limitToLast()")}var e},cm.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new cm(this.firestore,Qy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new tg("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw Yg(t,"startAt()","Query.startAt()")}},cm.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new cm(this.firestore,Qy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new tg("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw Yg(t,"startAfter()","Query.startAfter()")}},cm.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new cm(this.firestore,Qy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new eg("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw Yg(t,"endBefore()","Query.endBefore()")}},cm.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new cm(this.firestore,Qy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new eg("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw Yg(t,"endAt()","Query.endAt()")}},cm.prototype.isEqual=function(t){return Ep(this._delegate,t._delegate)},cm.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=sp(t,lp);var e=sp(t.firestore,Dp),n=kp(e),r=new bg(e);return function(t,e){var n=this,i=new pu;return t.asyncQueue.enqueueAndForget((function(){return l(n,void 0,void 0,(function(){var n;return g(this,(function(r){switch(r.label){case 0:return n=function(i,t,s){return l(this,void 0,void 0,(function(){var e,n,r;return g(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,Th(i,t,!0)];case 1:return r=o.sent(),e=new Of(t,r.Bn),n=e._o(r.documents),n=e.applyChanges(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=o.sent(),r=hf(n,"Failed to execute query '"+t+" against cache"),s.reject(r),[3,3];case 3:return[2]}}))}))},[4,xd(t)];case 1:return[2,n.apply(void 0,[r.sent(),e,i])]}}))}))})),i.promise}(n,t._query).then((function(n){return new Vy(e,r,t,n)}))}:"server"===(null==t?void 0:t.source)?function(t){t=sp(t,lp);var e=sp(t.firestore,Dp),n=kp(e),r=new bg(e);return Fd(n,t._query,{source:"server"}).then((function(n){return new Vy(e,r,t,n)}))}:function(t){t=sp(t,lp);var e=sp(t.firestore,Dp),n=kp(e),r=new bg(e);return Gy(t._query),Fd(n,t._query).then((function(n){return new Vy(e,r,t,n)}))})(this._delegate).then((function(t){return new em(e.firestore,new Vy(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},cm.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Xg(e),i=$g(e,(function(e){return new em(t.firestore,new Vy(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return Ig(this._delegate,r,i)},cm.prototype.withConverter=function(t){return new cm(this.firestore,t?this._delegate.withConverter(Kg.nu(this.firestore,t)):this._delegate.withConverter(null))},cm),im=(Object.defineProperty(um.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(um.prototype,"doc",{get:function(){return new nm(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(um.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(um.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),um),em=(Object.defineProperty(am.prototype,"query",{get:function(){return new rm(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(am.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(am.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(am.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(am.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new nm(t._firestore,e)}))},enumerable:!1,configurable:!0}),am.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new im(e._firestore,t)}))},am.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new nm(n._firestore,r))}))},am.prototype.isEqual=function(t){return Ky(this._delegate,t._delegate)},am),om=(h(sm,Jg=rm),Object.defineProperty(sm.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(sm.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(sm.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new zg(this.firestore,t):null},enumerable:!1,configurable:!0}),sm.prototype.doc=function(t){try{return new zg(this.firestore,void 0===t?wp(this._delegate):wp(this._delegate,t))}catch(t){throw Yg(t,"doc()","CollectionReference.doc()")}},sm.prototype.add=function(t){var e,n,r,i=this;return n=t,t=sp((e=this._delegate).firestore,Dp),r=wp(e),n=fg(e.converter,n),_g(t,[Jp($p(e.firestore),"addDoc",r._key,n,null!==e.converter,{}).toMutation(r._key,gs.exists(!1))]).then((function(){return r})).then((function(t){return new zg(i.firestore,t)}))},sm.prototype.isEqual=function(t){return bp(this._delegate,t._delegate)},sm.prototype.withConverter=function(t){return new sm(this.firestore,t?this._delegate.withConverter(Kg.nu(this.firestore,t)):this._delegate.withConverter(null))},sm);function sm(t,e){var n=this;return(n=Jg.call(this,t,e)||this).firestore=t,n._delegate=e,n}function am(t,e){this._firestore=t,this._delegate=e}function um(t,e){this._firestore=t,this._delegate=e}function cm(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Mg(t)}function hm(){return null!==Zg&&Zg.apply(this,arguments)||this}function lm(t,e){this._firestore=t,this._delegate=e}function fm(t){return sp(t,hp)}function dm(t){this._delegate=t}function pm(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Lp.bind.apply(Lp,s([void 0],t)))}function ym(t){return e=this._delegate,s=t,n=kp(e=sp(e,Dp)),t=new Ap,function(t,e,n){var r,i=this,o=(r=s,e=Al(e),r=function(t){if(t instanceof Uint8Array)return dd(t,void 0);if(t instanceof ArrayBuffer)return dd(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?(new TextEncoder).encode(r):r),new vd(r,e));t.asyncQueue.enqueueAndForget((function(){return l(i,void 0,void 0,(function(){var e;return g(this,(function(r){switch(r.label){case 0:return e=od,[4,Ld(t)];case 1:return e.apply(void 0,[r.sent(),o,n]),[2]}}))}))}))}(n,e._databaseId,t),t;var e,s,n}function gm(t){var e=this,n=this._delegate;return t=t,function(t,e){var n=this;return t.asyncQueue.enqueue((function(){return l(n,void 0,void 0,(function(){var n;return g(this,(function(r){switch(r.label){case 0:return n=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",(function(t){return n.Ke.getNamedQuery(t,e)}))},[4,xd(t)];case 1:return[2,n.apply(void 0,[r.sent(),e])]}}))}))}))}(kp(n=sp(n,Dp)),t).then((function(t){return t?new lp(n,null,t.query):null})).then((function(t){return t?new rm(e,t):null}))}pm.documentId=function(){return new pm(li.keyField().canonicalString())},pm.prototype.isEqual=function(t){return(t=_(t))instanceof Lp&&this._delegate._internalPath.isEqual(t._internalPath)},L=pm,dm.serverTimestamp=function(){var t=new ay("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new dm(t)},dm.delete=function(){var t=new ty("deleteField");return t._methodName="FieldValue.delete",new dm(t)},dm.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new uy("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new dm(n)},dm.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new cy("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new dm(n)},dm.increment=function(t){return(t=new hy("increment",t))._methodName="FieldValue.increment",new dm(t)},dm.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},C=dm;var mm=(vm.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},vm.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},vm.prototype.setServiceProps=function(t){return this.serviceProps=t,this},vm.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},vm);function vm(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}var wm,bm,Em={Firestore:Pg,GeoPoint:Fp,Timestamp:ri,Blob:Og,Transaction:Bg,WriteBatch:jg,DocumentReference:zg,DocumentSnapshot:tm,Query:rm,QueryDocumentSnapshot:nm,QuerySnapshot:em,CollectionReference:om,FieldPath:L,FieldValue:C,setLogLevel:function(t){Kr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(wm=o.default).INTERNAL.registerComponent(new mm("firestore",(function(t){var e=t.getProvider("app").getImmediate();return e=e,t=t.getProvider("auth-internal"),new Pg(e,new Dp(e,t),new Lg)}),"PUBLIC").setServiceProps(Object.assign({},Em))),wm.registerVersion("@firebase/firestore","2.4.0"),(bm=Pg).prototype.loadBundle=ym,bm.prototype.namedQuery=gm}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}}(n(385))}).call(this,n(32),n(115))}}]);